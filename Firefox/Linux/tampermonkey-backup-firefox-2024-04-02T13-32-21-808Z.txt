{"created_by":"Tampermonkey","version":"1","scripts":[{"name":"Simple YouTube Age Restriction Bypass","options":{"check_for_updates":true,"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_powerful_this":null,"sandbox":null,"noframes":null,"unwrap":null,"run_at":null,"tab_types":null,"override":{"use_includes":[],"orig_includes":[],"merge_includes":true,"use_matches":[],"orig_matches":["https://www.youtube.com/*","https://www.youtube-nocookie.com/*","https://m.youtube.com/*","https://music.youtube.com/*"],"merge_matches":true,"use_excludes":[],"orig_excludes":[],"merge_excludes":true,"use_connects":[],"orig_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-start","orig_noframes":null},"user_modified":null},"storage":{"ts":1700650339223,"data":{}},"enabled":true,"position":1,"file_url":"https://github.com/zerodytrash/Simple-YouTube-Age-Restriction-Bypass/raw/main/dist/Simple-YouTube-Age-Restriction-Bypass.user.js","uuid":"2e20630b-41cd-41fe-94ae-fe0185658870","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICAgICBTaW1wbGUgWW91VHViZSBBZ2UgUmVzdHJpY3Rpb24gQnlwYXNzCi8vIEBkZXNjcmlwdGlvbiAgICAgV2F0Y2ggYWdlIHJlc3RyaWN0ZWQgdmlkZW9zIG9uIFlvdVR1YmUgd2l0aG91dCBsb2dpbiBhbmQgd2l0aG91dCBhZ2UgdmVyaWZpY2F0aW9uIPCfmI4KLy8gQGRlc2NyaXB0aW9uOmRlICBTY2hhdWUgWW91VHViZSBWaWRlb3MgbWl0IEFsdGVyc2Jlc2NocsOkbmt1bmdlbiBvaG5lIEFubWVsZHVuZyB1bmQgb2huZSBkZWluIEFsdGVyIHp1IGJlc3TDpHRpZ2VuIPCfmI4KLy8gQGRlc2NyaXB0aW9uOmZyICBSZWdhcmRleiBkZXMgdmlkw6lvcyBZb3VUdWJlIGF2ZWMgZGVzIHJlc3RyaWN0aW9ucyBkJ8OiZ2Ugc2FucyB2b3VzIGluc2NyaXJlIGV0IHNhbnMgY29uZmlybWVyIHZvdHJlIMOiZ2Ug8J+YjgovLyBAZGVzY3JpcHRpb246aXQgIEd1YXJkYSBpIHZpZGVvIGNvbiByZXN0cml6aW9uaSBkaSBldMOgIHN1IFlvdVR1YmUgc2VuemEgbG9naW4gZSBzZW56YSB2ZXJpZmljYSBkZWxsJ2V0w6Ag8J+YjgovLyBAaWNvbiAgICAgICAgICAgIGh0dHBzOi8vZ2l0aHViLmNvbS96ZXJvZHl0cmFzaC9TaW1wbGUtWW91VHViZS1BZ2UtUmVzdHJpY3Rpb24tQnlwYXNzL3Jhdy92Mi41LjQvc3JjL2V4dGVuc2lvbi9pY29uL2ljb25fNjQucG5nCi8vIEB2ZXJzaW9uICAgICAgICAgMi41LjkKLy8gQGF1dGhvciAgICAgICAgICBaZXJvZHkgKGh0dHBzOi8vZ2l0aHViLmNvbS96ZXJvZHl0cmFzaCkKLy8gQG5hbWVzcGFjZSAgICAgICBodHRwczovL2dpdGh1Yi5jb20vemVyb2R5dHJhc2gvU2ltcGxlLVlvdVR1YmUtQWdlLVJlc3RyaWN0aW9uLUJ5cGFzcy8KLy8gQHN1cHBvcnRVUkwgICAgICBodHRwczovL2dpdGh1Yi5jb20vemVyb2R5dHJhc2gvU2ltcGxlLVlvdVR1YmUtQWdlLVJlc3RyaWN0aW9uLUJ5cGFzcy9pc3N1ZXMKLy8gQHVwZGF0ZVVSTCAgICAgICBodHRwczovL2dpdGh1Yi5jb20vemVyb2R5dHJhc2gvU2ltcGxlLVlvdVR1YmUtQWdlLVJlc3RyaWN0aW9uLUJ5cGFzcy9yYXcvbWFpbi9kaXN0L1NpbXBsZS1Zb3VUdWJlLUFnZS1SZXN0cmljdGlvbi1CeXBhc3MudXNlci5qcwovLyBAbGljZW5zZSAgICAgICAgIE1JVAovLyBAbWF0Y2ggICAgICAgICAgIGh0dHBzOi8vd3d3LnlvdXR1YmUuY29tLyoKLy8gQG1hdGNoICAgICAgICAgICBodHRwczovL3d3dy55b3V0dWJlLW5vY29va2llLmNvbS8qCi8vIEBtYXRjaCAgICAgICAgICAgaHR0cHM6Ly9tLnlvdXR1YmUuY29tLyoKLy8gQG1hdGNoICAgICAgICAgICBodHRwczovL211c2ljLnlvdXR1YmUuY29tLyoKLy8gQGdyYW50ICAgICAgICAgICBub25lCi8vIEBydW4tYXQgICAgICAgICAgZG9jdW1lbnQtc3RhcnQKLy8gQGNvbXBhdGlibGUgICAgICBjaHJvbWUKLy8gQGNvbXBhdGlibGUgICAgICBmaXJlZm94Ci8vIEBjb21wYXRpYmxlICAgICAgb3BlcmEKLy8gQGNvbXBhdGlibGUgICAgICBlZGdlCi8vIEBjb21wYXRpYmxlICAgICAgc2FmYXJpCi8vID09L1VzZXJTY3JpcHQ9PQoKLyoKICAgIFRoaXMgaXMgYSB0cmFuc3BpbGVkIHZlcnNpb24gdG8gYWNoaWV2ZSBhIGNsZWFuIGNvZGUgYmFzZSBhbmQgYmV0dGVyIGJyb3dzZXIgY29tcGF0aWJpbGl0eS4KICAgIFlvdSBjYW4gZmluZCB0aGUgbmljZWx5IHJlYWRhYmxlIHNvdXJjZSBjb2RlIGF0IGh0dHBzOi8vZ2l0aHViLmNvbS96ZXJvZHl0cmFzaC9TaW1wbGUtWW91VHViZS1BZ2UtUmVzdHJpY3Rpb24tQnlwYXNzCiovCgooZnVuY3Rpb24gaWlmZShyYW5PbmNlKSB7CiAgICAvLyBUcmljayB0byBnZXQgYXJvdW5kIHRoZSBzYW5kYm94IHJlc3RyaWN0aW9ucyBpbiBHcmVhc2Vtb25rZXkgKEZpcmVmb3gpCiAgICAvLyBJbmplY3QgY29kZSBpbnRvIHRoZSBtYWluIHdpbmRvdyBpZiBjcml0ZXJpYSBtYXRjaAogICAgaWYgKHRoaXMgIT09IHdpbmRvdyAmJiAhcmFuT25jZSkgewogICAgICAgIHdpbmRvdy5ldmFsKCcoJyArIGlpZmUudG9TdHJpbmcoKSArICcpKHRydWUpOycpOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyBTY3JpcHQgY29uZmlndXJhdGlvbiB2YXJpYWJsZXMKICAgIGNvbnN0IFVOTE9DS0FCTEVfUExBWUFCSUxJVFlfU1RBVFVTRVMgPSBbJ0FHRV9WRVJJRklDQVRJT05fUkVRVUlSRUQnLCAnQUdFX0NIRUNLX1JFUVVJUkVEJywgJ0NPTlRFTlRfQ0hFQ0tfUkVRVUlSRUQnLCAnTE9HSU5fUkVRVUlSRUQnXTsKICAgIGNvbnN0IFZBTElEX1BMQVlBQklMSVRZX1NUQVRVU0VTID0gWydPSycsICdMSVZFX1NUUkVBTV9PRkZMSU5FJ107CgogICAgLy8gVGhlc2UgYXJlIHRoZSBwcm94eSBzZXJ2ZXJzIHRoYXQgYXJlIHNvbWV0aW1lcyByZXF1aXJlZCB0byB1bmxvY2sgdmlkZW9zIHdpdGggYWdlIHJlc3RyaWN0aW9ucy4KICAgIC8vIFlvdSBjYW4gaG9zdCB5b3VyIG93biBhY2NvdW50IHByb3h5IGluc3RhbmNlLiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL3plcm9keXRyYXNoL1NpbXBsZS1Zb3VUdWJlLUFnZS1SZXN0cmljdGlvbi1CeXBhc3MvdHJlZS9tYWluL2FjY291bnQtcHJveHkKICAgIC8vIFRvIGxlYXJuIHdoYXQgaW5mb3JtYXRpb24gaXMgdHJhbnNmZXJyZWQsIHBsZWFzZSByZWFkOiBodHRwczovL2dpdGh1Yi5jb20vemVyb2R5dHJhc2gvU2ltcGxlLVlvdVR1YmUtQWdlLVJlc3RyaWN0aW9uLUJ5cGFzcyNwcml2YWN5CiAgICBjb25zdCBBQ0NPVU5UX1BST1hZX1NFUlZFUl9IT1NUID0gJ2h0dHBzOi8veW91dHViZS1wcm94eS56ZXJvZHkub25lJzsKICAgIGNvbnN0IFZJREVPX1BST1hZX1NFUlZFUl9IT1NUID0gJ2h0dHBzOi8vbnkuNGV2ZXJwcm94eS5jb20nOwoKICAgIC8vIFVzZXIgbmVlZHMgdG8gY29uZmlybSB0aGUgdW5sb2NrIHByb2Nlc3Mgb24gZW1iZWRkZWQgcGxheWVyPwogICAgbGV0IEVOQUJMRV9VTkxPQ0tfQ09ORklSTUFUSU9OX0VNQkVEID0gdHJ1ZTsKCiAgICAvLyBTaG93IG5vdGlmaWNhdGlvbj8KICAgIGxldCBFTkFCTEVfVU5MT0NLX05PVElGSUNBVElPTiA9IHRydWU7CgogICAgLy8gRGlzYWJsZSBjb250ZW50IHdhcm5pbmdzPwogICAgbGV0IFNLSVBfQ09OVEVOVF9XQVJOSU5HUyA9IHRydWU7CgogICAgLy8gU29tZSBJbm5lcnR1YmUgYnlwYXNzIG1ldGhvZHMgcmVxdWlyZSB0aGUgZm9sbG93aW5nIGF1dGhlbnRpY2F0aW9uIGhlYWRlcnMgb2YgdGhlIGN1cnJlbnRseSBsb2dnZWQgaW4gdXNlci4KICAgIGNvbnN0IEdPT0dMRV9BVVRIX0hFQURFUl9OQU1FUyA9IFsnQXV0aG9yaXphdGlvbicsICdYLUdvb2ctQXV0aFVzZXInLCAnWC1PcmlnaW4nXTsKCiAgICAvKioKICAgICAqIFRoZSBTUVAgcGFyYW1ldGVyIGxlbmd0aCBpcyBkaWZmZXJlbnQgZm9yIGJsdXJyZWQgdGh1bWJuYWlscy4KICAgICAqIFRoZXkgY29udGFpbiBtdWNoIGxlc3MgaW5mb3JtYXRpb24sIHRoYW4gbm9ybWFsIHRodW1ibmFpbHMuCiAgICAgKiBUaGUgdGh1bWJuYWlsIFNRUHMgdGVuZCB0byBoYXZlIGEgbG9uZyBhbmQgYSBzaG9ydCB2ZXJzaW9uLgogICAgICovCiAgICBjb25zdCBCTFVSUkVEX1RIVU1CTkFJTF9TUVBfTEVOR1RIUyA9IFsKICAgICAgICAzMiwgLy8gTW9iaWxlIChTSE9SVCkKICAgICAgICA0OCwgLy8gRGVza3RvcCBQbGF5bGlzdCAoU0hPUlQpCiAgICAgICAgNTYsIC8vIERlc2t0b3AgKFNIT1JUKQogICAgICAgIDY4LCAvLyBNb2JpbGUgKExPTkcpCiAgICAgICAgNzIsIC8vIE1vYmlsZSBTaG9ydHMKICAgICAgICA4NCwgLy8gRGVza3RvcCBQbGF5bGlzdCAoTE9ORykKICAgICAgICA4OCwgLy8gRGVza3RvcCAoTE9ORykKICAgIF07CgogICAgLy8gc21hbGwgaGFjayB0byBwcmV2ZW50IHRyZWUgc2hha2luZyBvbiB0aGVzZSBleHBvcnRzCiAgICB2YXIgQ29uZmlnID0gd2luZG93W1N5bWJvbCgpXSA9IHsKICAgICAgICBVTkxPQ0tBQkxFX1BMQVlBQklMSVRZX1NUQVRVU0VTLAogICAgICAgIFZBTElEX1BMQVlBQklMSVRZX1NUQVRVU0VTLAogICAgICAgIEFDQ09VTlRfUFJPWFlfU0VSVkVSX0hPU1QsCiAgICAgICAgVklERU9fUFJPWFlfU0VSVkVSX0hPU1QsCiAgICAgICAgRU5BQkxFX1VOTE9DS19DT05GSVJNQVRJT05fRU1CRUQsCiAgICAgICAgRU5BQkxFX1VOTE9DS19OT1RJRklDQVRJT04sCiAgICAgICAgU0tJUF9DT05URU5UX1dBUk5JTkdTLAogICAgICAgIEdPT0dMRV9BVVRIX0hFQURFUl9OQU1FUywKICAgICAgICBCTFVSUkVEX1RIVU1CTkFJTF9TUVBfTEVOR1RIUywKICAgIH07CgogICAgZnVuY3Rpb24gaXNHb29nbGVWaWRlb1VybCh1cmwpIHsKICAgICAgICByZXR1cm4gdXJsLmhvc3QuaW5jbHVkZXMoJy5nb29nbGV2aWRlby5jb20nKTsKICAgIH0KCiAgICBmdW5jdGlvbiBpc0dvb2dsZVZpZGVvVW5sb2NrUmVxdWlyZWQoZ29vZ2xlVmlkZW9VcmwsIGxhc3RQcm94aWVkR29vZ2xlVmlkZW9JZCkgewogICAgICAgIGNvbnN0IHVybFBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMoZ29vZ2xlVmlkZW9Vcmwuc2VhcmNoKTsKICAgICAgICBjb25zdCBoYXNHY3JGbGFnID0gdXJsUGFyYW1zLmdldCgnZ2NyJyk7CiAgICAgICAgY29uc3Qgd2FzVW5sb2NrZWRCeUFjY291bnRQcm94eSA9IHVybFBhcmFtcy5nZXQoJ2lkJykgPT09IGxhc3RQcm94aWVkR29vZ2xlVmlkZW9JZDsKCiAgICAgICAgcmV0dXJuIGhhc0djckZsYWcgJiYgd2FzVW5sb2NrZWRCeUFjY291bnRQcm94eTsKICAgIH0KCiAgICBjb25zdCBuYXRpdmVKU09OUGFyc2UgPSB3aW5kb3cuSlNPTi5wYXJzZTsKICAgIGNvbnN0IG5hdGl2ZVhNTEh0dHBSZXF1ZXN0T3BlbiA9IHdpbmRvdy5YTUxIdHRwUmVxdWVzdC5wcm90b3R5cGUub3BlbjsKCiAgICBjb25zdCBpc0Rlc2t0b3AgPSB3aW5kb3cubG9jYXRpb24uaG9zdCAhPT0gJ20ueW91dHViZS5jb20nOwogICAgY29uc3QgaXNNdXNpYyA9IHdpbmRvdy5sb2NhdGlvbi5ob3N0ID09PSAnbXVzaWMueW91dHViZS5jb20nOwogICAgY29uc3QgaXNFbWJlZCA9IHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZS5pbmRleE9mKCcvZW1iZWQvJykgPT09IDA7CiAgICBjb25zdCBpc0NvbmZpcm1lZCA9IHdpbmRvdy5sb2NhdGlvbi5zZWFyY2guaW5jbHVkZXMoJ3VubG9ja19jb25maXJtZWQnKTsKCiAgICBjbGFzcyBEZWZlcnJlZCB7CiAgICAgICAgY29uc3RydWN0b3IoKSB7CiAgICAgICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKAogICAgICAgICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgICAgICAgICAgICAgICAgIHRoaXMucmVzb2x2ZSA9IHJlc29sdmU7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWplY3QgPSByZWplY3Q7CiAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIHRoaXMsCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGNyZWF0ZUVsZW1lbnQodGFnTmFtZSwgb3B0aW9ucykgewogICAgICAgIGNvbnN0IG5vZGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZ05hbWUpOwogICAgICAgIG9wdGlvbnMgJiYgT2JqZWN0LmFzc2lnbihub2RlLCBvcHRpb25zKTsKICAgICAgICByZXR1cm4gbm9kZTsKICAgIH0KCiAgICBmdW5jdGlvbiBpc09iamVjdChvYmopIHsKICAgICAgICByZXR1cm4gb2JqICE9PSBudWxsICYmIHR5cGVvZiBvYmogPT09ICdvYmplY3QnOwogICAgfQoKICAgIGZ1bmN0aW9uIGZpbmROZXN0ZWRPYmplY3RzQnlBdHRyaWJ1dGVOYW1lcyhvYmplY3QsIGF0dHJpYnV0ZU5hbWVzKSB7CiAgICAgICAgdmFyIHJlc3VsdHMgPSBbXTsKCiAgICAgICAgLy8gRG9lcyB0aGUgY3VycmVudCBvYmplY3QgbWF0Y2ggdGhlIGF0dHJpYnV0ZSBjb25kaXRpb25zPwogICAgICAgIGlmIChhdHRyaWJ1dGVOYW1lcy5ldmVyeSgoa2V5KSA9PiB0eXBlb2Ygb2JqZWN0W2tleV0gIT09ICd1bmRlZmluZWQnKSkgewogICAgICAgICAgICByZXN1bHRzLnB1c2gob2JqZWN0KTsKICAgICAgICB9CgogICAgICAgIC8vIERpZ2dpbicgZGVlcGVyIGZvciBlYWNoIG5lc3RlZCBvYmplY3QgKHJlY3Vyc2l2ZSkKICAgICAgICBPYmplY3Qua2V5cyhvYmplY3QpLmZvckVhY2goKGtleSkgPT4gewogICAgICAgICAgICBpZiAob2JqZWN0W2tleV0gJiYgdHlwZW9mIG9iamVjdFtrZXldID09PSAnb2JqZWN0JykgewogICAgICAgICAgICAgICAgcmVzdWx0cy5wdXNoKC4uLmZpbmROZXN0ZWRPYmplY3RzQnlBdHRyaWJ1dGVOYW1lcyhvYmplY3Rba2V5XSwgYXR0cmlidXRlTmFtZXMpKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICByZXR1cm4gcmVzdWx0czsKICAgIH0KCiAgICBmdW5jdGlvbiBwYWdlTG9hZGVkKCkgewogICAgICAgIGlmIChkb2N1bWVudC5yZWFkeVN0YXRlID09PSAnY29tcGxldGUnKSByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7CgogICAgICAgIGNvbnN0IGRlZmVycmVkID0gbmV3IERlZmVycmVkKCk7CgogICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgZGVmZXJyZWQucmVzb2x2ZSwgeyBvbmNlOiB0cnVlIH0pOwoKICAgICAgICByZXR1cm4gZGVmZXJyZWQ7CiAgICB9CgogICAgZnVuY3Rpb24gY3JlYXRlRGVlcENvcHkob2JqKSB7CiAgICAgICAgcmV0dXJuIG5hdGl2ZUpTT05QYXJzZShKU09OLnN0cmluZ2lmeShvYmopKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRZdGNmZ1ZhbHVlKG5hbWUpIHsKICAgICAgICB2YXIgX3dpbmRvdyR5dGNmZzsKICAgICAgICByZXR1cm4gKF93aW5kb3ckeXRjZmcgPSB3aW5kb3cueXRjZmcpID09PSBudWxsIHx8IF93aW5kb3ckeXRjZmcgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF93aW5kb3ckeXRjZmcuZ2V0KG5hbWUpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldFNpZ25hdHVyZVRpbWVzdGFtcCgpIHsKICAgICAgICByZXR1cm4gKAogICAgICAgICAgICBnZXRZdGNmZ1ZhbHVlKCdTVFMnKQogICAgICAgICAgICB8fCAoKCkgPT4gewogICAgICAgICAgICAgICAgdmFyIF9kb2N1bWVudCRxdWVyeVNlbGVjdDsKICAgICAgICAgICAgICAgIC8vIFNUUyBpcyBtaXNzaW5nIG9uIGVtYmVkZGVkIHBsYXllci4gUmV0cmlldmUgZnJvbSBwbGF5ZXIgYmFzZSBzY3JpcHQgYXMgZmFsbGJhY2suLi4KICAgICAgICAgICAgICAgIGNvbnN0IHBsYXllckJhc2VKc1BhdGggPSAoX2RvY3VtZW50JHF1ZXJ5U2VsZWN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcignc2NyaXB0W3NyYyo9Ii9iYXNlLmpzIl0nKSkgPT09IG51bGwgfHwgX2RvY3VtZW50JHF1ZXJ5U2VsZWN0ID09PSB2b2lkIDAKICAgICAgICAgICAgICAgICAgICA/IHZvaWQgMAogICAgICAgICAgICAgICAgICAgIDogX2RvY3VtZW50JHF1ZXJ5U2VsZWN0LnNyYzsKCiAgICAgICAgICAgICAgICBpZiAoIXBsYXllckJhc2VKc1BhdGgpIHJldHVybjsKCiAgICAgICAgICAgICAgICBjb25zdCB4bWxodHRwID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7CiAgICAgICAgICAgICAgICB4bWxodHRwLm9wZW4oJ0dFVCcsIHBsYXllckJhc2VKc1BhdGgsIGZhbHNlKTsKICAgICAgICAgICAgICAgIHhtbGh0dHAuc2VuZChudWxsKTsKCiAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VJbnQoeG1saHR0cC5yZXNwb25zZVRleHQubWF0Y2goL3NpZ25hdHVyZVRpbWVzdGFtcDooWzAtOV0qKS8pWzFdKTsKICAgICAgICAgICAgfSkoKQogICAgICAgICk7CiAgICB9CgogICAgZnVuY3Rpb24gaXNVc2VyTG9nZ2VkSW4oKSB7CiAgICAgICAgLy8gTE9HR0VEX0lOIGRvZXNuJ3QgZXhpc3Qgb24gZW1iZWRkZWQgcGFnZSwgdXNlIERFTEVHQVRFRF9TRVNTSU9OX0lEIG9yIFNFU1NJT05fSU5ERVggYXMgZmFsbGJhY2sKICAgICAgICBpZiAodHlwZW9mIGdldFl0Y2ZnVmFsdWUoJ0xPR0dFRF9JTicpID09PSAnYm9vbGVhbicpIHJldHVybiBnZXRZdGNmZ1ZhbHVlKCdMT0dHRURfSU4nKTsKICAgICAgICBpZiAodHlwZW9mIGdldFl0Y2ZnVmFsdWUoJ0RFTEVHQVRFRF9TRVNTSU9OX0lEJykgPT09ICdzdHJpbmcnKSByZXR1cm4gdHJ1ZTsKICAgICAgICBpZiAocGFyc2VJbnQoZ2V0WXRjZmdWYWx1ZSgnU0VTU0lPTl9JTkRFWCcpKSA+PSAwKSByZXR1cm4gdHJ1ZTsKCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEN1cnJlbnRWaWRlb1N0YXJ0VGltZShjdXJyZW50VmlkZW9JZCkgewogICAgICAgIC8vIENoZWNrIGlmIHRoZSBVUkwgY29ycmVzcG9uZHMgdG8gdGhlIHJlcXVlc3RlZCB2aWRlbwogICAgICAgIC8vIFRoaXMgaXMgbm90IHRoZSBjYXNlIHdoZW4gdGhlIHBsYXllciBnZXRzIHByZWxvYWRlZCBmb3IgdGhlIG5leHQgdmlkZW8gaW4gYSBwbGF5bGlzdC4KICAgICAgICBpZiAod2luZG93LmxvY2F0aW9uLmhyZWYuaW5jbHVkZXMoY3VycmVudFZpZGVvSWQpKSB7CiAgICAgICAgICAgIHZhciBfcmVmOwogICAgICAgICAgICAvLyAidCItcGFyYW0gb24geW91dHUuYmUgdXJscwogICAgICAgICAgICAvLyAic3RhcnQiLXBhcmFtIG9uIGVtYmVkIHBsYXllcgogICAgICAgICAgICAvLyAidGltZV9jb250aW51ZSIgd2hlbiBjbGlja2luZyAid2F0Y2ggb24geW91dHViZSIgb24gZW1iZWRkZWQgcGxheWVyCiAgICAgICAgICAgIGNvbnN0IHVybFBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMod2luZG93LmxvY2F0aW9uLnNlYXJjaCk7CiAgICAgICAgICAgIGNvbnN0IHN0YXJ0VGltZVN0cmluZyA9IChfcmVmID0gdXJsUGFyYW1zLmdldCgndCcpIHx8IHVybFBhcmFtcy5nZXQoJ3N0YXJ0JykgfHwgdXJsUGFyYW1zLmdldCgndGltZV9jb250aW51ZScpKSA9PT0gbnVsbCB8fCBfcmVmID09PSB2b2lkIDAKICAgICAgICAgICAgICAgID8gdm9pZCAwCiAgICAgICAgICAgICAgICA6IF9yZWYucmVwbGFjZSgncycsICcnKTsKCiAgICAgICAgICAgIGlmIChzdGFydFRpbWVTdHJpbmcgJiYgIWlzTmFOKHN0YXJ0VGltZVN0cmluZykpIHsKICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZUludChzdGFydFRpbWVTdHJpbmcpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRVcmxQYXJhbXMocGFyYW1zKSB7CiAgICAgICAgY29uc3QgdXJsUGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcyh3aW5kb3cubG9jYXRpb24uc2VhcmNoKTsKICAgICAgICBmb3IgKGNvbnN0IHBhcmFtTmFtZSBpbiBwYXJhbXMpIHsKICAgICAgICAgICAgdXJsUGFyYW1zLnNldChwYXJhbU5hbWUsIHBhcmFtc1twYXJhbU5hbWVdKTsKICAgICAgICB9CiAgICAgICAgd2luZG93LmxvY2F0aW9uLnNlYXJjaCA9IHVybFBhcmFtczsKICAgIH0KCiAgICBmdW5jdGlvbiB3YWl0Rm9yRWxlbWVudChlbGVtZW50U2VsZWN0b3IsIHRpbWVvdXQpIHsKICAgICAgICBjb25zdCBkZWZlcnJlZCA9IG5ldyBEZWZlcnJlZCgpOwoKICAgICAgICBjb25zdCBjaGVja0RvbUludGVydmFsID0gc2V0SW50ZXJ2YWwoKCkgPT4gewogICAgICAgICAgICBjb25zdCBlbGVtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihlbGVtZW50U2VsZWN0b3IpOwogICAgICAgICAgICBpZiAoZWxlbSkgewogICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChjaGVja0RvbUludGVydmFsKTsKICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoZWxlbSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCAxMDApOwoKICAgICAgICBpZiAodGltZW91dCkgewogICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoY2hlY2tEb21JbnRlcnZhbCk7CiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoKTsKICAgICAgICAgICAgfSwgdGltZW91dCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZGVmZXJyZWQ7CiAgICB9CgogICAgZnVuY3Rpb24gcGFyc2VSZWxhdGl2ZVVybCh1cmwpIHsKICAgICAgICBpZiAodHlwZW9mIHVybCAhPT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQoKICAgICAgICBpZiAodXJsLmluZGV4T2YoJy8nKSA9PT0gMCkgewogICAgICAgICAgICB1cmwgPSB3aW5kb3cubG9jYXRpb24ub3JpZ2luICsgdXJsOwogICAgICAgIH0KCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIHVybC5pbmRleE9mKCdodHRwczovLycpID09PSAwID8gbmV3IHdpbmRvdy5VUkwodXJsKSA6IG51bGw7CiAgICAgICAgfSBjYXRjaCB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBpc1dhdGNoTmV4dE9iamVjdChwYXJzZWREYXRhKSB7CiAgICAgICAgdmFyIF9wYXJzZWREYXRhJGN1cnJlbnRWaTsKICAgICAgICBpZiAoCiAgICAgICAgICAgICEocGFyc2VkRGF0YSAhPT0gbnVsbCAmJiBwYXJzZWREYXRhICE9PSB2b2lkIDAgJiYgcGFyc2VkRGF0YS5jb250ZW50cykKICAgICAgICAgICAgfHwgIShwYXJzZWREYXRhICE9PSBudWxsICYmIHBhcnNlZERhdGEgIT09IHZvaWQgMCAmJiAoX3BhcnNlZERhdGEkY3VycmVudFZpID0gcGFyc2VkRGF0YS5jdXJyZW50VmlkZW9FbmRwb2ludCkgIT09IG51bGwgJiYgX3BhcnNlZERhdGEkY3VycmVudFZpICE9PSB2b2lkIDAKICAgICAgICAgICAgICAgICYmIChfcGFyc2VkRGF0YSRjdXJyZW50VmkgPSBfcGFyc2VkRGF0YSRjdXJyZW50Vmkud2F0Y2hFbmRwb2ludCkgIT09IG51bGwgJiYgX3BhcnNlZERhdGEkY3VycmVudFZpICE9PSB2b2lkIDAgJiYgX3BhcnNlZERhdGEkY3VycmVudFZpLnZpZGVvSWQpCiAgICAgICAgKSByZXR1cm4gZmFsc2U7CiAgICAgICAgcmV0dXJuICEhcGFyc2VkRGF0YS5jb250ZW50cy50d29Db2x1bW5XYXRjaE5leHRSZXN1bHRzIHx8ICEhcGFyc2VkRGF0YS5jb250ZW50cy5zaW5nbGVDb2x1bW5XYXRjaE5leHRSZXN1bHRzOwogICAgfQoKICAgIGZ1bmN0aW9uIGlzV2F0Y2hOZXh0U2lkZWJhckVtcHR5KHBhcnNlZERhdGEpIHsKICAgICAgICB2YXIgX3BhcnNlZERhdGEkY29udGVudHMyLCBfY29udGVudCRmaW5kOwogICAgICAgIGlmIChpc0Rlc2t0b3ApIHsKICAgICAgICAgICAgdmFyIF9wYXJzZWREYXRhJGNvbnRlbnRzOwogICAgICAgICAgICAvLyBXRUIgcmVzcG9uc2UgbGF5b3V0CiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IChfcGFyc2VkRGF0YSRjb250ZW50cyA9IHBhcnNlZERhdGEuY29udGVudHMpID09PSBudWxsIHx8IF9wYXJzZWREYXRhJGNvbnRlbnRzID09PSB2b2lkIDAKICAgICAgICAgICAgICAgICAgICB8fCAoX3BhcnNlZERhdGEkY29udGVudHMgPSBfcGFyc2VkRGF0YSRjb250ZW50cy50d29Db2x1bW5XYXRjaE5leHRSZXN1bHRzKSA9PT0gbnVsbCB8fCBfcGFyc2VkRGF0YSRjb250ZW50cyA9PT0gdm9pZCAwCiAgICAgICAgICAgICAgICAgICAgfHwgKF9wYXJzZWREYXRhJGNvbnRlbnRzID0gX3BhcnNlZERhdGEkY29udGVudHMuc2Vjb25kYXJ5UmVzdWx0cykgPT09IG51bGwgfHwgX3BhcnNlZERhdGEkY29udGVudHMgPT09IHZvaWQgMAogICAgICAgICAgICAgICAgICAgIHx8IChfcGFyc2VkRGF0YSRjb250ZW50cyA9IF9wYXJzZWREYXRhJGNvbnRlbnRzLnNlY29uZGFyeVJlc3VsdHMpID09PSBudWxsIHx8IF9wYXJzZWREYXRhJGNvbnRlbnRzID09PSB2b2lkIDAKICAgICAgICAgICAgICAgID8gdm9pZCAwCiAgICAgICAgICAgICAgICA6IF9wYXJzZWREYXRhJGNvbnRlbnRzLnJlc3VsdHM7CiAgICAgICAgICAgIHJldHVybiAhcmVzdWx0OwogICAgICAgIH0KCiAgICAgICAgLy8gTVdFQiByZXNwb25zZSBsYXlvdXQKICAgICAgICBjb25zdCBjb250ZW50ID0gKF9wYXJzZWREYXRhJGNvbnRlbnRzMiA9IHBhcnNlZERhdGEuY29udGVudHMpID09PSBudWxsIHx8IF9wYXJzZWREYXRhJGNvbnRlbnRzMiA9PT0gdm9pZCAwCiAgICAgICAgICAgICAgICB8fCAoX3BhcnNlZERhdGEkY29udGVudHMyID0gX3BhcnNlZERhdGEkY29udGVudHMyLnNpbmdsZUNvbHVtbldhdGNoTmV4dFJlc3VsdHMpID09PSBudWxsIHx8IF9wYXJzZWREYXRhJGNvbnRlbnRzMiA9PT0gdm9pZCAwCiAgICAgICAgICAgICAgICB8fCAoX3BhcnNlZERhdGEkY29udGVudHMyID0gX3BhcnNlZERhdGEkY29udGVudHMyLnJlc3VsdHMpID09PSBudWxsIHx8IF9wYXJzZWREYXRhJGNvbnRlbnRzMiA9PT0gdm9pZCAwCiAgICAgICAgICAgICAgICB8fCAoX3BhcnNlZERhdGEkY29udGVudHMyID0gX3BhcnNlZERhdGEkY29udGVudHMyLnJlc3VsdHMpID09PSBudWxsIHx8IF9wYXJzZWREYXRhJGNvbnRlbnRzMiA9PT0gdm9pZCAwCiAgICAgICAgICAgID8gdm9pZCAwCiAgICAgICAgICAgIDogX3BhcnNlZERhdGEkY29udGVudHMyLmNvbnRlbnRzOwogICAgICAgIGNvbnN0IHJlc3VsdCA9IGNvbnRlbnQgPT09IG51bGwgfHwgY29udGVudCA9PT0gdm9pZCAwIHx8IChfY29udGVudCRmaW5kID0gY29udGVudC5maW5kKChlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgdmFyIF9lJGl0ZW1TZWN0aW9uUmVuZGVyZTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gKChfZSRpdGVtU2VjdGlvblJlbmRlcmUgPSBlLml0ZW1TZWN0aW9uUmVuZGVyZXIpID09PSBudWxsIHx8IF9lJGl0ZW1TZWN0aW9uUmVuZGVyZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2UkaXRlbVNlY3Rpb25SZW5kZXJlLnRhcmdldElkKQogICAgICAgICAgICAgICAgICAgICAgICA9PT0gJ3dhdGNoLW5leHQtZmVlZCc7CiAgICAgICAgICAgICAgICB9KSkgPT09IG51bGwKICAgICAgICAgICAgICAgIHx8IF9jb250ZW50JGZpbmQgPT09IHZvaWQgMAogICAgICAgICAgICA/IHZvaWQgMAogICAgICAgICAgICA6IF9jb250ZW50JGZpbmQuaXRlbVNlY3Rpb25SZW5kZXJlcjsKICAgICAgICByZXR1cm4gdHlwZW9mIHJlc3VsdCAhPT0gJ29iamVjdCc7CiAgICB9CgogICAgZnVuY3Rpb24gaXNQbGF5ZXJPYmplY3QocGFyc2VkRGF0YSkgewogICAgICAgIHJldHVybiAocGFyc2VkRGF0YSA9PT0gbnVsbCB8fCBwYXJzZWREYXRhID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwYXJzZWREYXRhLnZpZGVvRGV0YWlscykKICAgICAgICAgICAgJiYgKHBhcnNlZERhdGEgPT09IG51bGwgfHwgcGFyc2VkRGF0YSA9PT0gdm9pZCAwID8gdm9pZCAwIDogcGFyc2VkRGF0YS5wbGF5YWJpbGl0eVN0YXR1cyk7CiAgICB9CgogICAgZnVuY3Rpb24gaXNFbWJlZGRlZFBsYXllck9iamVjdChwYXJzZWREYXRhKSB7CiAgICAgICAgcmV0dXJuIHR5cGVvZiAocGFyc2VkRGF0YSA9PT0gbnVsbCB8fCBwYXJzZWREYXRhID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwYXJzZWREYXRhLnByZXZpZXdQbGF5YWJpbGl0eVN0YXR1cykgPT09ICdvYmplY3QnOwogICAgfQoKICAgIGZ1bmN0aW9uIGlzQWdlUmVzdHJpY3RlZChwbGF5YWJpbGl0eVN0YXR1cykgewogICAgICAgIHZhciBfcGxheWFiaWxpdHlTdGF0dXMkZXI7CiAgICAgICAgaWYgKCEocGxheWFiaWxpdHlTdGF0dXMgIT09IG51bGwgJiYgcGxheWFiaWxpdHlTdGF0dXMgIT09IHZvaWQgMCAmJiBwbGF5YWJpbGl0eVN0YXR1cy5zdGF0dXMpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYgKHBsYXlhYmlsaXR5U3RhdHVzLmRlc2t0b3BMZWdhY3lBZ2VHYXRlUmVhc29uKSByZXR1cm4gdHJ1ZTsKICAgICAgICBpZiAoQ29uZmlnLlVOTE9DS0FCTEVfUExBWUFCSUxJVFlfU1RBVFVTRVMuaW5jbHVkZXMocGxheWFiaWxpdHlTdGF0dXMuc3RhdHVzKSkgcmV0dXJuIHRydWU7CgogICAgICAgIC8vIEZpeCB0byBkZXRlY3QgYWdlIHJlc3RyaWN0aW9ucyBvbiBlbWJlZCBwbGF5ZXIKICAgICAgICAvLyBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3plcm9keXRyYXNoL1NpbXBsZS1Zb3VUdWJlLUFnZS1SZXN0cmljdGlvbi1CeXBhc3MvaXNzdWVzLzg1I2lzc3VlY29tbWVudC05NDY4NTM1NTMKICAgICAgICByZXR1cm4gKAogICAgICAgICAgICBpc0VtYmVkCiAgICAgICAgICAgICYmICgoX3BsYXlhYmlsaXR5U3RhdHVzJGVyID0gcGxheWFiaWxpdHlTdGF0dXMuZXJyb3JTY3JlZW4pID09PSBudWxsIHx8IF9wbGF5YWJpbGl0eVN0YXR1cyRlciA9PT0gdm9pZCAwCiAgICAgICAgICAgICAgICAgICAgfHwgKF9wbGF5YWJpbGl0eVN0YXR1cyRlciA9IF9wbGF5YWJpbGl0eVN0YXR1cyRlci5wbGF5ZXJFcnJvck1lc3NhZ2VSZW5kZXJlcikgPT09IG51bGwgfHwgX3BsYXlhYmlsaXR5U3RhdHVzJGVyID09PSB2b2lkIDAKICAgICAgICAgICAgICAgICAgICB8fCAoX3BsYXlhYmlsaXR5U3RhdHVzJGVyID0gX3BsYXlhYmlsaXR5U3RhdHVzJGVyLnJlYXNvbikgPT09IG51bGwgfHwgX3BsYXlhYmlsaXR5U3RhdHVzJGVyID09PSB2b2lkIDAKICAgICAgICAgICAgICAgICAgICB8fCAoX3BsYXlhYmlsaXR5U3RhdHVzJGVyID0gX3BsYXlhYmlsaXR5U3RhdHVzJGVyLnJ1bnMpID09PSBudWxsIHx8IF9wbGF5YWJpbGl0eVN0YXR1cyRlciA9PT0gdm9pZCAwCiAgICAgICAgICAgICAgICAgICAgfHwgKF9wbGF5YWJpbGl0eVN0YXR1cyRlciA9IF9wbGF5YWJpbGl0eVN0YXR1cyRlci5maW5kKCh4KSA9PiB4Lm5hdmlnYXRpb25FbmRwb2ludCkpID09PSBudWxsIHx8IF9wbGF5YWJpbGl0eVN0YXR1cyRlciA9PT0gdm9pZCAwCiAgICAgICAgICAgICAgICAgICAgfHwgKF9wbGF5YWJpbGl0eVN0YXR1cyRlciA9IF9wbGF5YWJpbGl0eVN0YXR1cyRlci5uYXZpZ2F0aW9uRW5kcG9pbnQpID09PSBudWxsIHx8IF9wbGF5YWJpbGl0eVN0YXR1cyRlciA9PT0gdm9pZCAwCiAgICAgICAgICAgICAgICAgICAgfHwgKF9wbGF5YWJpbGl0eVN0YXR1cyRlciA9IF9wbGF5YWJpbGl0eVN0YXR1cyRlci51cmxFbmRwb2ludCkgPT09IG51bGwgfHwgX3BsYXlhYmlsaXR5U3RhdHVzJGVyID09PSB2b2lkIDAKICAgICAgICAgICAgICAgICAgICB8fCAoX3BsYXlhYmlsaXR5U3RhdHVzJGVyID0gX3BsYXlhYmlsaXR5U3RhdHVzJGVyLnVybCkgPT09IG51bGwgfHwgX3BsYXlhYmlsaXR5U3RhdHVzJGVyID09PSB2b2lkIDAKICAgICAgICAgICAgICAgID8gdm9pZCAwCiAgICAgICAgICAgICAgICA6IF9wbGF5YWJpbGl0eVN0YXR1cyRlci5pbmNsdWRlcygnLzI4MDIxNjcnKSkKICAgICAgICApOwogICAgfQoKICAgIGZ1bmN0aW9uIGlzU2VhcmNoUmVzdWx0KHBhcnNlZERhdGEpIHsKICAgICAgICB2YXIgX3BhcnNlZERhdGEkY29udGVudHMzLCBfcGFyc2VkRGF0YSRjb250ZW50czQsIF9wYXJzZWREYXRhJG9uUmVzcG9uczsKICAgICAgICByZXR1cm4gKAogICAgICAgICAgICB0eXBlb2YgKHBhcnNlZERhdGEgPT09IG51bGwgfHwgcGFyc2VkRGF0YSA9PT0gdm9pZCAwIHx8IChfcGFyc2VkRGF0YSRjb250ZW50czMgPSBwYXJzZWREYXRhLmNvbnRlbnRzKSA9PT0gbnVsbCB8fCBfcGFyc2VkRGF0YSRjb250ZW50czMgPT09IHZvaWQgMAogICAgICAgICAgICAgICAgICAgID8gdm9pZCAwCiAgICAgICAgICAgICAgICAgICAgOiBfcGFyc2VkRGF0YSRjb250ZW50czMudHdvQ29sdW1uU2VhcmNoUmVzdWx0c1JlbmRlcmVyKSA9PT0gJ29iamVjdCcgLy8gRGVza3RvcCBpbml0aWFsIHJlc3VsdHMKICAgICAgICAgICAgfHwgKHBhcnNlZERhdGEgPT09IG51bGwgfHwgcGFyc2VkRGF0YSA9PT0gdm9pZCAwIHx8IChfcGFyc2VkRGF0YSRjb250ZW50czQgPSBwYXJzZWREYXRhLmNvbnRlbnRzKSA9PT0gbnVsbCB8fCBfcGFyc2VkRGF0YSRjb250ZW50czQgPT09IHZvaWQgMAogICAgICAgICAgICAgICAgICAgICAgICB8fCAoX3BhcnNlZERhdGEkY29udGVudHM0ID0gX3BhcnNlZERhdGEkY29udGVudHM0LnNlY3Rpb25MaXN0UmVuZGVyZXIpID09PSBudWxsIHx8IF9wYXJzZWREYXRhJGNvbnRlbnRzNCA9PT0gdm9pZCAwCiAgICAgICAgICAgICAgICAgICAgPyB2b2lkIDAKICAgICAgICAgICAgICAgICAgICA6IF9wYXJzZWREYXRhJGNvbnRlbnRzNC50YXJnZXRJZCkgPT09ICdzZWFyY2gtZmVlZCcgLy8gTW9iaWxlIGluaXRpYWwgcmVzdWx0cwogICAgICAgICAgICB8fCAocGFyc2VkRGF0YSA9PT0gbnVsbCB8fCBwYXJzZWREYXRhID09PSB2b2lkIDAgfHwgKF9wYXJzZWREYXRhJG9uUmVzcG9ucyA9IHBhcnNlZERhdGEub25SZXNwb25zZVJlY2VpdmVkQ29tbWFuZHMpID09PSBudWxsIHx8IF9wYXJzZWREYXRhJG9uUmVzcG9ucyA9PT0gdm9pZCAwCiAgICAgICAgICAgICAgICAgICAgICAgIHx8IChfcGFyc2VkRGF0YSRvblJlc3BvbnMgPSBfcGFyc2VkRGF0YSRvblJlc3BvbnMuZmluZCgoeCkgPT4geC5hcHBlbmRDb250aW51YXRpb25JdGVtc0FjdGlvbikpID09PSBudWxsIHx8IF9wYXJzZWREYXRhJG9uUmVzcG9ucyA9PT0gdm9pZCAwCiAgICAgICAgICAgICAgICAgICAgICAgIHx8IChfcGFyc2VkRGF0YSRvblJlc3BvbnMgPSBfcGFyc2VkRGF0YSRvblJlc3BvbnMuYXBwZW5kQ29udGludWF0aW9uSXRlbXNBY3Rpb24pID09PSBudWxsIHx8IF9wYXJzZWREYXRhJG9uUmVzcG9ucyA9PT0gdm9pZCAwCiAgICAgICAgICAgICAgICAgICAgPyB2b2lkIDAKICAgICAgICAgICAgICAgICAgICA6IF9wYXJzZWREYXRhJG9uUmVzcG9ucy50YXJnZXRJZCkgPT09ICdzZWFyY2gtZmVlZCcgLy8gRGVza3RvcCAmIE1vYmlsZSBzY3JvbGwgY29udGludWF0aW9uCiAgICAgICAgKTsKICAgIH0KCiAgICBmdW5jdGlvbiBhdHRhY2gkNChvYmosIHByb3AsIG9uQ2FsbCkgewogICAgICAgIGlmICghb2JqIHx8IHR5cGVvZiBvYmpbcHJvcF0gIT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgbGV0IG9yaWdpbmFsID0gb2JqW3Byb3BdOwoKICAgICAgICBvYmpbcHJvcF0gPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIG9uQ2FsbChhcmd1bWVudHMpOwogICAgICAgICAgICB9IGNhdGNoIHt9CiAgICAgICAgICAgIG9yaWdpbmFsLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgfTsKICAgIH0KCiAgICBjb25zdCBsb2dQcmVmaXggPSAnJWNTaW1wbGUtWW91VHViZS1BZ2UtUmVzdHJpY3Rpb24tQnlwYXNzOic7CiAgICBjb25zdCBsb2dQcmVmaXhTdHlsZSA9ICdiYWNrZ3JvdW5kLWNvbG9yOiAjMWU1Yzg1OyBjb2xvcjogI2ZmZjsgZm9udC1zaXplOiAxLjJlbTsnOwogICAgY29uc3QgbG9nU3VmZml4ID0gJ1x1RDgzRFx1REMxRSBZb3UgY2FuIHJlcG9ydCBidWdzIGF0OiBodHRwczovL2dpdGh1Yi5jb20vemVyb2R5dHJhc2gvU2ltcGxlLVlvdVR1YmUtQWdlLVJlc3RyaWN0aW9uLUJ5cGFzcy9pc3N1ZXMnOwoKICAgIGZ1bmN0aW9uIGVycm9yKGVyciwgbXNnKSB7CiAgICAgICAgY29uc29sZS5lcnJvcihsb2dQcmVmaXgsIGxvZ1ByZWZpeFN0eWxlLCBtc2csIGVyciwgZ2V0WXRjZmdEZWJ1Z1N0cmluZygpLCAnXG5cbicsIGxvZ1N1ZmZpeCk7CiAgICAgICAgaWYgKHdpbmRvdy5TWUFSQl9DT05GSUcpIHsKICAgICAgICAgICAgd2luZG93LmRpc3BhdGNoRXZlbnQoCiAgICAgICAgICAgICAgICBuZXcgQ3VzdG9tRXZlbnQoJ1NZQVJCX0xPR19FUlJPUicsIHsKICAgICAgICAgICAgICAgICAgICBkZXRhaWw6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogKG1zZyA/IG1zZyArICc7ICcgOiAnJykgKyAoZXJyICYmIGVyci5tZXNzYWdlID8gZXJyLm1lc3NhZ2UgOiAnJyksCiAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrOiBlcnIgJiYgZXJyLnN0YWNrID8gZXJyLnN0YWNrIDogbnVsbCwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGluZm8obXNnKSB7CiAgICAgICAgY29uc29sZS5pbmZvKGxvZ1ByZWZpeCwgbG9nUHJlZml4U3R5bGUsIG1zZyk7CiAgICAgICAgaWYgKHdpbmRvdy5TWUFSQl9DT05GSUcpIHsKICAgICAgICAgICAgd2luZG93LmRpc3BhdGNoRXZlbnQoCiAgICAgICAgICAgICAgICBuZXcgQ3VzdG9tRXZlbnQoJ1NZQVJCX0xPR19JTkZPJywgewogICAgICAgICAgICAgICAgICAgIGRldGFpbDogewogICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBtc2csCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBnZXRZdGNmZ0RlYnVnU3RyaW5nKCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICBgSW5uZXJ0dWJlQ29uZmlnOiBgCiAgICAgICAgICAgICAgICArIGBpbm5lcnR1YmVBcGlLZXk6ICR7Z2V0WXRjZmdWYWx1ZSgnSU5ORVJUVUJFX0FQSV9LRVknKX0gYAogICAgICAgICAgICAgICAgKyBgaW5uZXJ0dWJlQ2xpZW50TmFtZTogJHtnZXRZdGNmZ1ZhbHVlKCdJTk5FUlRVQkVfQ0xJRU5UX05BTUUnKX0gYAogICAgICAgICAgICAgICAgKyBgaW5uZXJ0dWJlQ2xpZW50VmVyc2lvbjogJHtnZXRZdGNmZ1ZhbHVlKCdJTk5FUlRVQkVfQ0xJRU5UX1ZFUlNJT04nKX0gYAogICAgICAgICAgICAgICAgKyBgbG9nZ2VkSW46ICR7Z2V0WXRjZmdWYWx1ZSgnTE9HR0VEX0lOJyl9IGAKICAgICAgICAgICAgKTsKICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgcmV0dXJuIGBGYWlsZWQgdG8gYWNjZXNzIGNvbmZpZzogJHtlcnJ9YDsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBbmQgaGVyZSB3ZSBkZWFsIHdpdGggWW91VHViZSdzIGNyYXBweSBpbml0aWFsIGRhdGEgKHByZXNlbnQgaW4gcGFnZSBzb3VyY2UpIGFuZCB0aGUgcHJvYmxlbXMgdGhhdCBvY2N1ciB3aGVuIGludGVyY2VwdGluZyB0aGF0IGRhdGEuCiAgICAgKiBZb3VUdWJlIGhhcyBzb21lIHByb3RlY3Rpb25zIGluIHBsYWNlIHRoYXQgbWFrZSBpdCBkaWZmaWN1bHQgdG8gaW50ZXJjZXB0IGFuZCBtb2RpZnkgdGhlIGdsb2JhbCB5dEluaXRpYWxQbGF5ZXJSZXNwb25zZSB2YXJpYWJsZS4KICAgICAqIFRoZSBlYXNpZXN0IHdheSB3b3VsZCBiZSB0byBzZXQgYSBkZXNjcmlwdG9yIG9uIHRoYXQgdmFyaWFibGUgdG8gY2hhbmdlIHRoZSB2YWx1ZSBkaXJlY3RseSBvbiBkZWNsYXJhdGlvbi4KICAgICAqIEJ1dCBzb21lIGFkYmxvY2tlcnMgZGVmaW5lIHRoZWlyIG93biBkZXNjcmlwdG9ycyBvbiB0aGUgeXRJbml0aWFsUGxheWVyUmVzcG9uc2UgdmFyaWFibGUsIHdoaWNoIG1ha2VzIGl0IGhhcmQgdG8gcmVnaXN0ZXIgYW5vdGhlciBkZXNjcmlwdG9yIG9uIGl0LgogICAgICogQXMgYSB3b3JrYXJvdW5kIG9ubHkgdGhlIHJlbGV2YW50IHBsYXllclJlc3BvbnNlIHByb3BlcnR5IG9mIHRoZSB5dEluaXRpYWxQbGF5ZXJSZXNwb25zZSB2YXJpYWJsZSB3aWxsIGJlIGludGVyY2VwdGVkLgogICAgICogVGhpcyBpcyBhY2hpZXZlZCBieSBkZWZpbmluZyBhIGRlc2NyaXB0b3Igb24gdGhlIG9iamVjdCBwcm90b3R5cGUgZm9yIHRoYXQgcHJvcGVydHksIHdoaWNoIGFmZmVjdHMgYW55IG9iamVjdCB3aXRoIGEgYHBsYXllclJlc3BvbnNlYCBwcm9wZXJ0eS4KICAgICAqLwogICAgZnVuY3Rpb24gYXR0YWNoJDMob25Jbml0aWFsRGF0YSkgewogICAgICAgIGludGVyY2VwdE9iamVjdFByb3BlcnR5KCdwbGF5ZXJSZXNwb25zZScsIChvYmosIHBsYXllclJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgIGluZm8oYHBsYXllclJlc3BvbnNlIHByb3BlcnR5IHNldCwgY29udGFpbnMgc2lkZWJhcjogJHshIW9iai5yZXNwb25zZX1gKTsKCiAgICAgICAgICAgIC8vIFRoZSBzYW1lIG9iamVjdCBhbHNvIGNvbnRhaW5zIHRoZSBzaWRlYmFyIGRhdGEgYW5kIHZpZGVvIGRlc2NyaXB0aW9uCiAgICAgICAgICAgIGlmIChpc09iamVjdChvYmoucmVzcG9uc2UpKSBvbkluaXRpYWxEYXRhKG9iai5yZXNwb25zZSk7CgogICAgICAgICAgICAvLyBJZiB0aGUgc2NyaXB0IGlzIGV4ZWN1dGVkIHRvbyBsYXRlIGFuZCB0aGUgYm9vdHN0cmFwIGRhdGEgaGFzIGFscmVhZHkgYmVlbiBwcm9jZXNzZWQsCiAgICAgICAgICAgIC8vIGEgcmVsb2FkIG9mIHRoZSBwbGF5ZXIgY2FuIGJlIGZvcmNlZCBieSBjcmVhdGluZyBhIGRlZXAgY29weSBvZiB0aGUgb2JqZWN0LgogICAgICAgICAgICAvLyBUaGlzIGlzIGVzcGVjaWFsbHkgcmVsZXZhbnQgaWYgdGhlIHVzZXJzY3JpcHQgbWFuYWdlciBkb2VzIG5vdCBoYW5kbGUgdGhlIGBAcnVuLWF0IGRvY3VtZW50LXN0YXJ0YCBjb3JyZWN0bHkuCiAgICAgICAgICAgIHBsYXllclJlc3BvbnNlLnVubG9ja2VkID0gZmFsc2U7CiAgICAgICAgICAgIG9uSW5pdGlhbERhdGEocGxheWVyUmVzcG9uc2UpOwogICAgICAgICAgICByZXR1cm4gcGxheWVyUmVzcG9uc2UudW5sb2NrZWQgPyBjcmVhdGVEZWVwQ29weShwbGF5ZXJSZXNwb25zZSkgOiBwbGF5ZXJSZXNwb25zZTsKICAgICAgICB9KTsKCiAgICAgICAgLy8gVGhlIGdsb2JhbCBgeXRJbml0aWFsRGF0YWAgdmFyaWFibGUgY2FuIGJlIG1vZGlmaWVkIG9uIHRoZSBmbHkuCiAgICAgICAgLy8gSXQgY29udGFpbnMgc2VhcmNoIHJlc3VsdHMsIHNpZGViYXIgZGF0YSBhbmQgbWV0YSBpbmZvcm1hdGlvbgogICAgICAgIC8vIE5vdCByZWFsbHkgaW1wb3J0YW50IGJ1dCBmaXhlcyBodHRwczovL2dpdGh1Yi5jb20vemVyb2R5dHJhc2gvU2ltcGxlLVlvdVR1YmUtQWdlLVJlc3RyaWN0aW9uLUJ5cGFzcy9pc3N1ZXMvMTI3CiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCAoKSA9PiB7CiAgICAgICAgICAgIGlmIChpc09iamVjdCh3aW5kb3cueXRJbml0aWFsRGF0YSkpIHsKICAgICAgICAgICAgICAgIG9uSW5pdGlhbERhdGEod2luZG93Lnl0SW5pdGlhbERhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9CgogICAgZnVuY3Rpb24gaW50ZXJjZXB0T2JqZWN0UHJvcGVydHkocHJvcCwgb25TZXQpIHsKICAgICAgICB2YXIgX09iamVjdCRnZXRPd25Qcm9wZXJ0OwogICAgICAgIC8vIEFsbG93IG90aGVyIHVzZXJzY3JpcHRzIHRvIGRlY29yYXRlIHRoaXMgZGVzY3JpcHRvciwgaWYgdGhleSBkbyBzb21ldGhpbmcgc2ltaWxhcgogICAgICAgIGNvbnN0IGRhdGFLZXkgPSAnX19TWUFSQl8nICsgcHJvcDsKICAgICAgICBjb25zdCB7IGdldDogZ2V0dGVyLCBzZXQ6IHNldHRlciB9ID0gKF9PYmplY3QkZ2V0T3duUHJvcGVydCA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoT2JqZWN0LnByb3RvdHlwZSwgcHJvcCkpICE9PSBudWxsICYmIF9PYmplY3QkZ2V0T3duUHJvcGVydCAhPT0gdm9pZCAwCiAgICAgICAgICAgID8gX09iamVjdCRnZXRPd25Qcm9wZXJ0CiAgICAgICAgICAgIDogewogICAgICAgICAgICAgICAgc2V0KHZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpc1tkYXRhS2V5XSA9IHZhbHVlOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGdldCgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpc1tkYXRhS2V5XTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH07CgogICAgICAgIC8vIEludGVyY2VwdCB0aGUgZ2l2ZW4gcHJvcGVydHkgb24gYW55IG9iamVjdAogICAgICAgIC8vIFRoZSBhc3NpZ25lZCBhdHRyaWJ1dGUgdmFsdWUgYW5kIHRoZSBjb250ZXh0IChlbmNsb3Npbmcgb2JqZWN0KSBhcmUgcGFzc2VkIHRvIHRoZSBvblNldCBmdW5jdGlvbi4KICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoT2JqZWN0LnByb3RvdHlwZSwgcHJvcCwgewogICAgICAgICAgICBzZXQodmFsdWUpIHsKICAgICAgICAgICAgICAgIHNldHRlci5jYWxsKHRoaXMsIGlzT2JqZWN0KHZhbHVlKSA/IG9uU2V0KHRoaXMsIHZhbHVlKSA6IHZhbHVlKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZ2V0KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGdldHRlci5jYWxsKHRoaXMpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgICAgfSk7CiAgICB9CgogICAgLy8gSW50ZXJjZXB0LCBpbnNwZWN0IGFuZCBtb2RpZnkgSlNPTi1iYXNlZCBjb21tdW5pY2F0aW9uIHRvIHVubG9jayBwbGF5ZXIgcmVzcG9uc2VzIGJ5IGhpamFja2luZyB0aGUgSlNPTi5wYXJzZSBmdW5jdGlvbgogICAgZnVuY3Rpb24gYXR0YWNoJDIob25Kc29uRGF0YVJlY2VpdmVkKSB7CiAgICAgICAgd2luZG93LkpTT04ucGFyc2UgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgY29uc3QgZGF0YSA9IG5hdGl2ZUpTT05QYXJzZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICByZXR1cm4gaXNPYmplY3QoZGF0YSkgPyBvbkpzb25EYXRhUmVjZWl2ZWQoZGF0YSkgOiBkYXRhOwogICAgICAgIH07CiAgICB9CgogICAgZnVuY3Rpb24gYXR0YWNoJDEob25SZXF1ZXN0Q3JlYXRlKSB7CiAgICAgICAgaWYgKHR5cGVvZiB3aW5kb3cuUmVxdWVzdCAhPT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB3aW5kb3cuUmVxdWVzdCA9IG5ldyBQcm94eSh3aW5kb3cuUmVxdWVzdCwgewogICAgICAgICAgICBjb25zdHJ1Y3QodGFyZ2V0LCBhcmdzKSB7CiAgICAgICAgICAgICAgICBjb25zdCBbdXJsLCBvcHRpb25zXSA9IGFyZ3M7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhcnNlZFVybCA9IHBhcnNlUmVsYXRpdmVVcmwodXJsKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBtb2RpZmllZFVybCA9IG9uUmVxdWVzdENyZWF0ZShwYXJzZWRVcmwsIG9wdGlvbnMpOwoKICAgICAgICAgICAgICAgICAgICBpZiAobW9kaWZpZWRVcmwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYXJnc1swXSA9IG1vZGlmaWVkVXJsLnRvU3RyaW5nKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgICAgICAgZXJyb3IoZXJyLCBgRmFpbGVkIHRvIGludGVyY2VwdCBSZXF1ZXN0KClgKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gUmVmbGVjdC5jb25zdHJ1Y3QoLi4uYXJndW1lbnRzKTsKICAgICAgICAgICAgfSwKICAgICAgICB9KTsKICAgIH0KCiAgICBmdW5jdGlvbiBhdHRhY2gob25YaHJPcGVuQ2FsbGVkKSB7CiAgICAgICAgWE1MSHR0cFJlcXVlc3QucHJvdG90eXBlLm9wZW4gPSBmdW5jdGlvbihtZXRob2QsIHVybCkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgbGV0IHBhcnNlZFVybCA9IHBhcnNlUmVsYXRpdmVVcmwodXJsKTsKCiAgICAgICAgICAgICAgICBpZiAocGFyc2VkVXJsKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbW9kaWZpZWRVcmwgPSBvblhock9wZW5DYWxsZWQobWV0aG9kLCBwYXJzZWRVcmwsIHRoaXMpOwoKICAgICAgICAgICAgICAgICAgICBpZiAobW9kaWZpZWRVcmwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYXJndW1lbnRzWzFdID0gbW9kaWZpZWRVcmwudG9TdHJpbmcoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgZXJyb3IoZXJyLCBgRmFpbGVkIHRvIGludGVyY2VwdCBYTUxIdHRwUmVxdWVzdC5vcGVuKClgKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbmF0aXZlWE1MSHR0cFJlcXVlc3RPcGVuLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgfTsKICAgIH0KCiAgICBjb25zdCBsb2NhbFN0b3JhZ2VQcmVmaXggPSAnU1lBUkJfJzsKCiAgICBmdW5jdGlvbiBzZXQoa2V5LCB2YWx1ZSkgewogICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGxvY2FsU3RvcmFnZVByZWZpeCArIGtleSwgSlNPTi5zdHJpbmdpZnkodmFsdWUpKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXQoa2V5KSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0obG9jYWxTdG9yYWdlUHJlZml4ICsga2V5KSk7CiAgICAgICAgfSBjYXRjaCB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBnZXRQbGF5ZXIkMShwYXlsb2FkLCB1c2VBdXRoKSB7CiAgICAgICAgcmV0dXJuIHNlbmRJbm5lcnR1YmVSZXF1ZXN0KCd2MS9wbGF5ZXInLCBwYXlsb2FkLCB1c2VBdXRoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXROZXh0JDEocGF5bG9hZCwgdXNlQXV0aCkgewogICAgICAgIHJldHVybiBzZW5kSW5uZXJ0dWJlUmVxdWVzdCgndjEvbmV4dCcsIHBheWxvYWQsIHVzZUF1dGgpOwogICAgfQoKICAgIGZ1bmN0aW9uIHNlbmRJbm5lcnR1YmVSZXF1ZXN0KGVuZHBvaW50LCBwYXlsb2FkLCB1c2VBdXRoKSB7CiAgICAgICAgY29uc3QgeG1saHR0cCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOwogICAgICAgIHhtbGh0dHAub3BlbignUE9TVCcsIGAveW91dHViZWkvJHtlbmRwb2ludH0/a2V5PSR7Z2V0WXRjZmdWYWx1ZSgnSU5ORVJUVUJFX0FQSV9LRVknKX0mcHJldHR5UHJpbnQ9ZmFsc2VgLCBmYWxzZSk7CgogICAgICAgIGlmICh1c2VBdXRoICYmIGlzVXNlckxvZ2dlZEluKCkpIHsKICAgICAgICAgICAgeG1saHR0cC53aXRoQ3JlZGVudGlhbHMgPSB0cnVlOwogICAgICAgICAgICBDb25maWcuR09PR0xFX0FVVEhfSEVBREVSX05BTUVTLmZvckVhY2goKGhlYWRlck5hbWUpID0+IHsKICAgICAgICAgICAgICAgIHhtbGh0dHAuc2V0UmVxdWVzdEhlYWRlcihoZWFkZXJOYW1lLCBnZXQoaGVhZGVyTmFtZSkpOwogICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIHhtbGh0dHAuc2VuZChKU09OLnN0cmluZ2lmeShwYXlsb2FkKSk7CiAgICAgICAgcmV0dXJuIG5hdGl2ZUpTT05QYXJzZSh4bWxodHRwLnJlc3BvbnNlVGV4dCk7CiAgICB9CgogICAgdmFyIGlubmVydHViZSA9IHsKICAgICAgICBnZXRQbGF5ZXI6IGdldFBsYXllciQxLAogICAgICAgIGdldE5leHQ6IGdldE5leHQkMSwKICAgIH07CgogICAgbGV0IG5leHRSZXNwb25zZUNhY2hlID0ge307CgogICAgZnVuY3Rpb24gZ2V0R29vZ2xlVmlkZW9Vcmwob3JpZ2luYWxVcmwpIHsKICAgICAgICByZXR1cm4gQ29uZmlnLlZJREVPX1BST1hZX1NFUlZFUl9IT1NUICsgJy9kaXJlY3QvJyArIGJ0b2Eob3JpZ2luYWxVcmwudG9TdHJpbmcoKSk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0UGxheWVyKHBheWxvYWQpIHsKICAgICAgICAvLyBBbHNvIHJlcXVlc3QgdGhlIC9uZXh0IHJlc3BvbnNlIGlmIGEgbGF0ZXIgL25leHQgcmVxdWVzdCBpcyBsaWtlbHkuCiAgICAgICAgaWYgKCFuZXh0UmVzcG9uc2VDYWNoZVtwYXlsb2FkLnZpZGVvSWRdICYmICFpc011c2ljICYmICFpc0VtYmVkKSB7CiAgICAgICAgICAgIHBheWxvYWQuaW5jbHVkZU5leHQgPSAxOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHNlbmRSZXF1ZXN0KCdnZXRQbGF5ZXInLCBwYXlsb2FkKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXROZXh0KHBheWxvYWQpIHsKICAgICAgICAvLyBOZXh0IHJlc3BvbnNlIGFscmVhZHkgY2FjaGVkPyA9PiBSZXR1cm4gY2FjaGVkIGNvbnRlbnQKICAgICAgICBpZiAobmV4dFJlc3BvbnNlQ2FjaGVbcGF5bG9hZC52aWRlb0lkXSkgewogICAgICAgICAgICByZXR1cm4gbmV4dFJlc3BvbnNlQ2FjaGVbcGF5bG9hZC52aWRlb0lkXTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBzZW5kUmVxdWVzdCgnZ2V0TmV4dCcsIHBheWxvYWQpOwogICAgfQoKICAgIGZ1bmN0aW9uIHNlbmRSZXF1ZXN0KGVuZHBvaW50LCBwYXlsb2FkKSB7CiAgICAgICAgY29uc3QgcXVlcnlQYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKHBheWxvYWQpOwogICAgICAgIGNvbnN0IHByb3h5VXJsID0gYCR7Q29uZmlnLkFDQ09VTlRfUFJPWFlfU0VSVkVSX0hPU1R9LyR7ZW5kcG9pbnR9PyR7cXVlcnlQYXJhbXN9JmNsaWVudD1qc2A7CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGNvbnN0IHhtbGh0dHAgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKICAgICAgICAgICAgeG1saHR0cC5vcGVuKCdHRVQnLCBwcm94eVVybCwgZmFsc2UpOwogICAgICAgICAgICB4bWxodHRwLnNlbmQobnVsbCk7CgogICAgICAgICAgICBjb25zdCBwcm94eVJlc3BvbnNlID0gbmF0aXZlSlNPTlBhcnNlKHhtbGh0dHAucmVzcG9uc2VUZXh0KTsKCiAgICAgICAgICAgIC8vIE1hcmsgcmVxdWVzdCBhcyAncHJveGllZCcKICAgICAgICAgICAgcHJveHlSZXNwb25zZS5wcm94aWVkID0gdHJ1ZTsKCiAgICAgICAgICAgIC8vIFB1dCBpbmNsdWRlZCAvbmV4dCByZXNwb25zZSBpbiB0aGUgY2FjaGUKICAgICAgICAgICAgaWYgKHByb3h5UmVzcG9uc2UubmV4dFJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICBuZXh0UmVzcG9uc2VDYWNoZVtwYXlsb2FkLnZpZGVvSWRdID0gcHJveHlSZXNwb25zZS5uZXh0UmVzcG9uc2U7CiAgICAgICAgICAgICAgICBkZWxldGUgcHJveHlSZXNwb25zZS5uZXh0UmVzcG9uc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBwcm94eVJlc3BvbnNlOwogICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICBlcnJvcihlcnIsICdQcm94eSBBUEkgRXJyb3InKTsKICAgICAgICAgICAgcmV0dXJuIHsgZXJyb3JNZXNzYWdlOiAnUHJveHkgQ29ubmVjdGlvbiBmYWlsZWQnIH07CiAgICAgICAgfQogICAgfQoKICAgIHZhciBwcm94eSA9IHsKICAgICAgICBnZXRQbGF5ZXIsCiAgICAgICAgZ2V0TmV4dCwKICAgICAgICBnZXRHb29nbGVWaWRlb1VybCwKICAgIH07CgogICAgZnVuY3Rpb24gZ2V0VW5sb2NrU3RyYXRlZ2llcyQxKHZpZGVvSWQsIGxhc3RQbGF5ZXJVbmxvY2tSZWFzb24pIHsKICAgICAgICB2YXIgX2dldFl0Y2ZnVmFsdWUkY2xpZW50OwogICAgICAgIGNvbnN0IGNsaWVudE5hbWUgPSBnZXRZdGNmZ1ZhbHVlKCdJTk5FUlRVQkVfQ0xJRU5UX05BTUUnKSB8fCAnV0VCJzsKICAgICAgICBjb25zdCBjbGllbnRWZXJzaW9uID0gZ2V0WXRjZmdWYWx1ZSgnSU5ORVJUVUJFX0NMSUVOVF9WRVJTSU9OJykgfHwgJzIuMjAyMjAyMDMuMDQuMDAnOwogICAgICAgIGNvbnN0IGhsID0gZ2V0WXRjZmdWYWx1ZSgnSEwnKTsKICAgICAgICBjb25zdCB1c2VySW50ZXJmYWNlVGhlbWUgPSAoX2dldFl0Y2ZnVmFsdWUkY2xpZW50ID0gZ2V0WXRjZmdWYWx1ZSgnSU5ORVJUVUJFX0NPTlRFWFQnKS5jbGllbnQudXNlckludGVyZmFjZVRoZW1lKSAhPT0gbnVsbCAmJiBfZ2V0WXRjZmdWYWx1ZSRjbGllbnQgIT09IHZvaWQgMAogICAgICAgICAgICA/IF9nZXRZdGNmZ1ZhbHVlJGNsaWVudAogICAgICAgICAgICA6IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5oYXNBdHRyaWJ1dGUoJ2RhcmsnKQogICAgICAgICAgICA/ICdVU0VSX0lOVEVSRkFDRV9USEVNRV9EQVJLJwogICAgICAgICAgICA6ICdVU0VSX0lOVEVSRkFDRV9USEVNRV9MSUdIVCc7CgogICAgICAgIHJldHVybiBbCiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBSZXRyaWV2ZSB0aGUgc2lkZWJhciBhbmQgdmlkZW8gZGVzY3JpcHRpb24gYnkganVzdCBhZGRpbmcgYHJhY3lDaGVja09rYCBhbmQgYGNvbnRlbnRDaGVja09rYCBwYXJhbXMKICAgICAgICAgICAgICogVGhpcyBzdHJhdGVneSBjYW4gYmUgdXNlZCB0byBieXBhc3MgY29udGVudCB3YXJuaW5ncwogICAgICAgICAgICAgKi8KICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbmFtZTogJ0NvbnRlbnQgV2FybmluZyBCeXBhc3MnLAogICAgICAgICAgICAgICAgc2tpcDogIWxhc3RQbGF5ZXJVbmxvY2tSZWFzb24gfHwgIWxhc3RQbGF5ZXJVbmxvY2tSZWFzb24uaW5jbHVkZXMoJ0NIRUNLX1JFUVVJUkVEJyksCiAgICAgICAgICAgICAgICBvcHRpb25hbEF1dGg6IHRydWUsCiAgICAgICAgICAgICAgICBwYXlsb2FkOiB7CiAgICAgICAgICAgICAgICAgICAgY29udGV4dDogewogICAgICAgICAgICAgICAgICAgICAgICBjbGllbnQ6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsaWVudE5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGllbnRWZXJzaW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VySW50ZXJmYWNlVGhlbWUsCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB2aWRlb0lkLAogICAgICAgICAgICAgICAgICAgIHJhY3lDaGVja09rOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIGNvbnRlbnRDaGVja09rOiB0cnVlLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGVuZHBvaW50OiBpbm5lcnR1YmUsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBSZXRyaWV2ZSB0aGUgc2lkZWJhciBhbmQgdmlkZW8gZGVzY3JpcHRpb24gZnJvbSBhbiBhY2NvdW50IHByb3h5IHNlcnZlci4KICAgICAgICAgICAgICogU2Vzc2lvbiBjb29raWVzIG9mIGFuIGFnZS12ZXJpZmllZCBHb29nbGUgYWNjb3VudCBhcmUgc3RvcmVkIG9uIHNlcnZlciBzaWRlLgogICAgICAgICAgICAgKiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL3plcm9keXRyYXNoL1NpbXBsZS1Zb3VUdWJlLUFnZS1SZXN0cmljdGlvbi1CeXBhc3MvdHJlZS9tYWluL2FjY291bnQtcHJveHkKICAgICAgICAgICAgICovCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIG5hbWU6ICdBY2NvdW50IFByb3h5JywKICAgICAgICAgICAgICAgIHBheWxvYWQ6IHsKICAgICAgICAgICAgICAgICAgICB2aWRlb0lkLAogICAgICAgICAgICAgICAgICAgIGNsaWVudE5hbWUsCiAgICAgICAgICAgICAgICAgICAgY2xpZW50VmVyc2lvbiwKICAgICAgICAgICAgICAgICAgICBobCwKICAgICAgICAgICAgICAgICAgICB1c2VySW50ZXJmYWNlVGhlbWUsCiAgICAgICAgICAgICAgICAgICAgaXNFbWJlZDogK2lzRW1iZWQsCiAgICAgICAgICAgICAgICAgICAgaXNDb25maXJtZWQ6ICtpc0NvbmZpcm1lZCwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlbmRwb2ludDogcHJveHksCiAgICAgICAgICAgIH0sCiAgICAgICAgXTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRVbmxvY2tTdHJhdGVnaWVzKHZpZGVvSWQsIHJlYXNvbikgewogICAgICAgIGNvbnN0IGNsaWVudE5hbWUgPSBnZXRZdGNmZ1ZhbHVlKCdJTk5FUlRVQkVfQ0xJRU5UX05BTUUnKSB8fCAnV0VCJzsKICAgICAgICBjb25zdCBjbGllbnRWZXJzaW9uID0gZ2V0WXRjZmdWYWx1ZSgnSU5ORVJUVUJFX0NMSUVOVF9WRVJTSU9OJykgfHwgJzIuMjAyMjAyMDMuMDQuMDAnOwogICAgICAgIGNvbnN0IHNpZ25hdHVyZVRpbWVzdGFtcCA9IGdldFNpZ25hdHVyZVRpbWVzdGFtcCgpOwogICAgICAgIGNvbnN0IHN0YXJ0VGltZVNlY3MgPSBnZXRDdXJyZW50VmlkZW9TdGFydFRpbWUodmlkZW9JZCk7CiAgICAgICAgY29uc3QgaGwgPSBnZXRZdGNmZ1ZhbHVlKCdITCcpOwoKICAgICAgICByZXR1cm4gWwogICAgICAgICAgICAvKioKICAgICAgICAgICAgICogUmV0cmlldmUgdGhlIHZpZGVvIGluZm8gYnkganVzdCBhZGRpbmcgYHJhY3lDaGVja09rYCBhbmQgYGNvbnRlbnRDaGVja09rYCBwYXJhbXMKICAgICAgICAgICAgICogVGhpcyBzdHJhdGVneSBjYW4gYmUgdXNlZCB0byBieXBhc3MgY29udGVudCB3YXJuaW5ncwogICAgICAgICAgICAgKi8KICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbmFtZTogJ0NvbnRlbnQgV2FybmluZyBCeXBhc3MnLAogICAgICAgICAgICAgICAgc2tpcDogIXJlYXNvbiB8fCAhcmVhc29uLmluY2x1ZGVzKCdDSEVDS19SRVFVSVJFRCcpLAogICAgICAgICAgICAgICAgb3B0aW9uYWxBdXRoOiB0cnVlLAogICAgICAgICAgICAgICAgcGF5bG9hZDogewogICAgICAgICAgICAgICAgICAgIGNvbnRleHQ6IHsKICAgICAgICAgICAgICAgICAgICAgICAgY2xpZW50OiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGllbnROYW1lOiBjbGllbnROYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xpZW50VmVyc2lvbjogY2xpZW50VmVyc2lvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhsLAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgcGxheWJhY2tDb250ZXh0OiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRQbGF5YmFja0NvbnRleHQ6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpZ25hdHVyZVRpbWVzdGFtcCwKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHZpZGVvSWQsCiAgICAgICAgICAgICAgICAgICAgc3RhcnRUaW1lU2VjcywKICAgICAgICAgICAgICAgICAgICByYWN5Q2hlY2tPazogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBjb250ZW50Q2hlY2tPazogdHJ1ZSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlbmRwb2ludDogaW5uZXJ0dWJlLAogICAgICAgICAgICB9LAogICAgICAgICAgICAvKioKICAgICAgICAgICAgICogUmV0cmlldmUgdGhlIHZpZGVvIGluZm8gYnkgdXNpbmcgdGhlIFRWSFRNTDUgRW1iZWRkZWQgY2xpZW50CiAgICAgICAgICAgICAqIFRoaXMgY2xpZW50IGhhcyBubyBhZ2UgcmVzdHJpY3Rpb25zIGluIHBsYWNlICgyMDIyLTAzLTI4KQogICAgICAgICAgICAgKiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL3plcm9keXRyYXNoL1lvdVR1YmUtSW50ZXJuYWwtQ2xpZW50cwogICAgICAgICAgICAgKi8KICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbmFtZTogJ1RWIEVtYmVkZGVkIFBsYXllcicsCiAgICAgICAgICAgICAgICByZXF1aXJlc0F1dGg6IGZhbHNlLAogICAgICAgICAgICAgICAgcGF5bG9hZDogewogICAgICAgICAgICAgICAgICAgIGNvbnRleHQ6IHsKICAgICAgICAgICAgICAgICAgICAgICAgY2xpZW50OiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGllbnROYW1lOiAnVFZIVE1MNV9TSU1QTFlfRU1CRURERURfUExBWUVSJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsaWVudFZlcnNpb246ICcyLjAnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xpZW50U2NyZWVuOiAnV0FUQ0gnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGwsCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXJkUGFydHk6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtYmVkVXJsOiAnaHR0cHM6Ly93d3cueW91dHViZS5jb20vJywKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHBsYXliYWNrQ29udGV4dDogewogICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50UGxheWJhY2tDb250ZXh0OiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaWduYXR1cmVUaW1lc3RhbXAsCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB2aWRlb0lkLAogICAgICAgICAgICAgICAgICAgIHN0YXJ0VGltZVNlY3MsCiAgICAgICAgICAgICAgICAgICAgcmFjeUNoZWNrT2s6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgY29udGVudENoZWNrT2s6IHRydWUsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZW5kcG9pbnQ6IGlubmVydHViZSwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIFJldHJpZXZlIHRoZSB2aWRlbyBpbmZvIGJ5IHVzaW5nIHRoZSBXRUJfQ1JFQVRPUiBjbGllbnQgaW4gY29tYmluYXRpb24gd2l0aCB1c2VyIGF1dGhlbnRpY2F0aW9uCiAgICAgICAgICAgICAqIFJlcXVpcmVzIHRoYXQgdGhlIHVzZXIgaXMgbG9nZ2VkIGluLiBDYW4gYnlwYXNzIHRoZSB0aWdodGVuZWQgYWdlIHZlcmlmaWNhdGlvbiBpbiB0aGUgRVUuCiAgICAgICAgICAgICAqIFNlZSBodHRwczovL2dpdGh1Yi5jb20veXQtZGxwL3l0LWRscC9wdWxsLzYwMAogICAgICAgICAgICAgKi8KICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbmFtZTogJ0NyZWF0b3IgKyBBdXRoJywKICAgICAgICAgICAgICAgIHJlcXVpcmVzQXV0aDogdHJ1ZSwKICAgICAgICAgICAgICAgIHBheWxvYWQ6IHsKICAgICAgICAgICAgICAgICAgICBjb250ZXh0OiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNsaWVudDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xpZW50TmFtZTogJ1dFQl9DUkVBVE9SJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsaWVudFZlcnNpb246ICcxLjIwMjEwOTA5LjA3LjAwJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhsLAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgcGxheWJhY2tDb250ZXh0OiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRQbGF5YmFja0NvbnRleHQ6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpZ25hdHVyZVRpbWVzdGFtcCwKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHZpZGVvSWQsCiAgICAgICAgICAgICAgICAgICAgc3RhcnRUaW1lU2VjcywKICAgICAgICAgICAgICAgICAgICByYWN5Q2hlY2tPazogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBjb250ZW50Q2hlY2tPazogdHJ1ZSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlbmRwb2ludDogaW5uZXJ0dWJlLAogICAgICAgICAgICB9LAogICAgICAgICAgICAvKioKICAgICAgICAgICAgICogUmV0cmlldmUgdGhlIHZpZGVvIGluZm8gZnJvbSBhbiBhY2NvdW50IHByb3h5IHNlcnZlci4KICAgICAgICAgICAgICogU2Vzc2lvbiBjb29raWVzIG9mIGFuIGFnZS12ZXJpZmllZCBHb29nbGUgYWNjb3VudCBhcmUgc3RvcmVkIG9uIHNlcnZlciBzaWRlLgogICAgICAgICAgICAgKiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL3plcm9keXRyYXNoL1NpbXBsZS1Zb3VUdWJlLUFnZS1SZXN0cmljdGlvbi1CeXBhc3MvdHJlZS9tYWluL2FjY291bnQtcHJveHkKICAgICAgICAgICAgICovCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIG5hbWU6ICdBY2NvdW50IFByb3h5JywKICAgICAgICAgICAgICAgIHBheWxvYWQ6IHsKICAgICAgICAgICAgICAgICAgICB2aWRlb0lkLAogICAgICAgICAgICAgICAgICAgIHJlYXNvbiwKICAgICAgICAgICAgICAgICAgICBjbGllbnROYW1lLAogICAgICAgICAgICAgICAgICAgIGNsaWVudFZlcnNpb24sCiAgICAgICAgICAgICAgICAgICAgc2lnbmF0dXJlVGltZXN0YW1wLAogICAgICAgICAgICAgICAgICAgIHN0YXJ0VGltZVNlY3MsCiAgICAgICAgICAgICAgICAgICAgaGwsCiAgICAgICAgICAgICAgICAgICAgaXNFbWJlZDogK2lzRW1iZWQsCiAgICAgICAgICAgICAgICAgICAgaXNDb25maXJtZWQ6ICtpc0NvbmZpcm1lZCwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlbmRwb2ludDogcHJveHksCiAgICAgICAgICAgIH0sCiAgICAgICAgXTsKICAgIH0KCiAgICB2YXIgYnV0dG9uVGVtcGxhdGUgPQogICAgICAgICc8ZGl2IHN0eWxlPSJtYXJnaW4tdG9wOiAxNXB4ICFpbXBvcnRhbnQ7IHBhZGRpbmc6IDNweCAxMHB4IDNweCAxMHB4OyBtYXJnaW46IDBweCBhdXRvOyBiYWNrZ3JvdW5kLWNvbG9yOiAjNGQ0ZDRkOyB3aWR0aDogZml0LWNvbnRlbnQ7IGZvbnQtc2l6ZTogMS4yZW07IHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7IGJvcmRlci1yYWRpdXM6IDNweDsgY3Vyc29yOiBwb2ludGVyOyI+XG4gICAgPGRpdiBjbGFzcz0iYnV0dG9uLXRleHQiPjwvZGl2PlxuPC9kaXY+JzsKCiAgICBsZXQgYnV0dG9ucyA9IHt9OwoKICAgIGFzeW5jIGZ1bmN0aW9uIGFkZEJ1dHRvbihpZCwgdGV4dCwgYmFja2dyb3VuZENvbG9yLCBvbkNsaWNrKSB7CiAgICAgICAgY29uc3QgZXJyb3JTY3JlZW5FbGVtZW50ID0gYXdhaXQgd2FpdEZvckVsZW1lbnQoJy55dHAtZXJyb3InLCAyMDAwKTsKICAgICAgICBjb25zdCBidXR0b25FbGVtZW50ID0gY3JlYXRlRWxlbWVudCgnZGl2JywgeyBjbGFzczogJ2J1dHRvbi1jb250YWluZXInLCBpbm5lckhUTUw6IGJ1dHRvblRlbXBsYXRlIH0pOwogICAgICAgIGJ1dHRvbkVsZW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnYnV0dG9uLXRleHQnKVswXS5pbm5lclRleHQgPSB0ZXh0OwoKICAgICAgICBpZiAoYmFja2dyb3VuZENvbG9yKSB7CiAgICAgICAgICAgIGJ1dHRvbkVsZW1lbnQucXVlcnlTZWxlY3RvcignOnNjb3BlID4gZGl2Jykuc3R5bGVbJ2JhY2tncm91bmQtY29sb3InXSA9IGJhY2tncm91bmRDb2xvcjsKICAgICAgICB9CgogICAgICAgIGlmICh0eXBlb2Ygb25DbGljayA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICBidXR0b25FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25DbGljayk7CiAgICAgICAgfQoKICAgICAgICAvLyBCdXR0b24gYWxyZWFkeSBhdHRhY2hlZD8KICAgICAgICBpZiAoYnV0dG9uc1tpZF0gJiYgYnV0dG9uc1tpZF0uaXNDb25uZWN0ZWQpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgYnV0dG9uc1tpZF0gPSBidXR0b25FbGVtZW50OwogICAgICAgIGVycm9yU2NyZWVuRWxlbWVudC5hcHBlbmQoYnV0dG9uRWxlbWVudCk7CiAgICB9CgogICAgZnVuY3Rpb24gcmVtb3ZlQnV0dG9uKGlkKSB7CiAgICAgICAgaWYgKGJ1dHRvbnNbaWRdICYmIGJ1dHRvbnNbaWRdLmlzQ29ubmVjdGVkKSB7CiAgICAgICAgICAgIGJ1dHRvbnNbaWRdLnJlbW92ZSgpOwogICAgICAgIH0KICAgIH0KCiAgICBjb25zdCBjb25maXJtYXRpb25CdXR0b25JZCA9ICdjb25maXJtQnV0dG9uJzsKICAgIGNvbnN0IGNvbmZpcm1hdGlvbkJ1dHRvblRleHQgPSAnQ2xpY2sgdG8gdW5sb2NrJzsKCiAgICBmdW5jdGlvbiBpc0NvbmZpcm1hdGlvblJlcXVpcmVkKCkgewogICAgICAgIHJldHVybiAhaXNDb25maXJtZWQgJiYgaXNFbWJlZCAmJiBDb25maWcuRU5BQkxFX1VOTE9DS19DT05GSVJNQVRJT05fRU1CRUQ7CiAgICB9CgogICAgZnVuY3Rpb24gcmVxdWVzdENvbmZpcm1hdGlvbigpIHsKICAgICAgICBhZGRCdXR0b24oY29uZmlybWF0aW9uQnV0dG9uSWQsIGNvbmZpcm1hdGlvbkJ1dHRvblRleHQsIG51bGwsICgpID0+IHsKICAgICAgICAgICAgcmVtb3ZlQnV0dG9uKGNvbmZpcm1hdGlvbkJ1dHRvbklkKTsKICAgICAgICAgICAgY29uZmlybSgpOwogICAgICAgIH0pOwogICAgfQoKICAgIGZ1bmN0aW9uIGNvbmZpcm0oKSB7CiAgICAgICAgc2V0VXJsUGFyYW1zKHsKICAgICAgICAgICAgdW5sb2NrX2NvbmZpcm1lZDogMSwKICAgICAgICAgICAgYXV0b3BsYXk6IDEsCiAgICAgICAgfSk7CiAgICB9CgogICAgdmFyIHREZXNrdG9wID0gJzx0cC15dC1wYXBlci10b2FzdD48L3RwLXl0LXBhcGVyLXRvYXN0PlxuJzsKCiAgICB2YXIgdE1vYmlsZSA9CiAgICAgICAgJzxjMy10b2FzdD5cbiAgICA8eXRtLW5vdGlmaWNhdGlvbi1hY3Rpb24tcmVuZGVyZXI+XG4gICAgICAgIDxkaXYgY2xhc3M9Im5vdGlmaWNhdGlvbi1hY3Rpb24tcmVzcG9uc2UtdGV4dCI+PC9kaXY+XG4gICAgPC95dG0tbm90aWZpY2F0aW9uLWFjdGlvbi1yZW5kZXJlcj5cbjwvYzMtdG9hc3Q+XG4nOwoKICAgIGNvbnN0IHRlbXBsYXRlID0gaXNEZXNrdG9wID8gdERlc2t0b3AgOiB0TW9iaWxlOwoKICAgIGNvbnN0IG5Ub2FzdENvbnRhaW5lciA9IGNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsgaWQ6ICd0b2FzdC1jb250YWluZXInLCBpbm5lckhUTUw6IHRlbXBsYXRlIH0pOwogICAgY29uc3QgblRvYXN0ID0gblRvYXN0Q29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJzpzY29wZSA+IConKTsKCiAgICAvLyBPbiBZVCBNdXNpYyBzaG93IHRoZSB0b2FzdCBhYm92ZSB0aGUgcGxheWVyIGNvbnRyb2xzCiAgICBpZiAoaXNNdXNpYykgewogICAgICAgIG5Ub2FzdC5zdHlsZVsnbWFyZ2luLWJvdHRvbSddID0gJzg1cHgnOwogICAgfQoKICAgIGlmICghaXNEZXNrdG9wKSB7CiAgICAgICAgblRvYXN0Lm5NZXNzYWdlID0gblRvYXN0LnF1ZXJ5U2VsZWN0b3IoJy5ub3RpZmljYXRpb24tYWN0aW9uLXJlc3BvbnNlLXRleHQnKTsKICAgICAgICBuVG9hc3Quc2hvdyA9IChtZXNzYWdlKSA9PiB7CiAgICAgICAgICAgIG5Ub2FzdC5uTWVzc2FnZS5pbm5lclRleHQgPSBtZXNzYWdlOwogICAgICAgICAgICBuVG9hc3Quc2V0QXR0cmlidXRlKCdkaXInLCAnaW4nKTsKICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICBuVG9hc3Quc2V0QXR0cmlidXRlKCdkaXInLCAnb3V0Jyk7CiAgICAgICAgICAgIH0sIG5Ub2FzdC5kdXJhdGlvbiArIDIyNSk7CiAgICAgICAgfTsKICAgIH0KCiAgICBhc3luYyBmdW5jdGlvbiBzaG93KG1lc3NhZ2UsIGR1cmF0aW9uID0gNSkgewogICAgICAgIGlmICghQ29uZmlnLkVOQUJMRV9VTkxPQ0tfTk9USUZJQ0FUSU9OKSByZXR1cm47CiAgICAgICAgaWYgKGlzRW1iZWQpIHJldHVybjsKCiAgICAgICAgYXdhaXQgcGFnZUxvYWRlZCgpOwoKICAgICAgICAvLyBEbyBub3Qgc2hvdyBub3RpZmljYXRpb24gd2hlbiB0YWIgaXMgaW4gYmFja2dyb3VuZAogICAgICAgIGlmIChkb2N1bWVudC52aXNpYmlsaXR5U3RhdGUgPT09ICdoaWRkZW4nKSByZXR1cm47CgogICAgICAgIC8vIEFwcGVuZCB0b2FzdCBjb250YWluZXIgdG8gRE9NLCBpZiBub3QgYWxyZWFkeSBkb25lCiAgICAgICAgaWYgKCFuVG9hc3RDb250YWluZXIuaXNDb25uZWN0ZWQpIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5hcHBlbmQoblRvYXN0Q29udGFpbmVyKTsKCiAgICAgICAgblRvYXN0LmR1cmF0aW9uID0gZHVyYXRpb24gKiAxMDAwOwogICAgICAgIG5Ub2FzdC5zaG93KG1lc3NhZ2UpOwogICAgfQoKICAgIHZhciBUb2FzdCA9IHsgc2hvdyB9OwoKICAgIGNvbnN0IG1lc3NhZ2VzTWFwID0gewogICAgICAgIHN1Y2Nlc3M6ICdBZ2UtcmVzdHJpY3RlZCB2aWRlbyBzdWNjZXNzZnVsbHkgdW5sb2NrZWQhJywKICAgICAgICBmYWlsOiAnVW5hYmxlIHRvIHVubG9jayB0aGlzIHZpZGVvIPCfmYEgLSBNb3JlIGluZm9ybWF0aW9uIGluIHRoZSBkZXZlbG9wZXIgY29uc29sZScsCiAgICB9OwoKICAgIGxldCBsYXN0UGxheWVyVW5sb2NrVmlkZW9JZCA9IG51bGw7CiAgICBsZXQgbGFzdFBsYXllclVubG9ja1JlYXNvbiA9IG51bGw7CgogICAgbGV0IGxhc3RQcm94aWVkR29vZ2xlVmlkZW9VcmxQYXJhbXM7CiAgICBsZXQgY2FjaGVkUGxheWVyUmVzcG9uc2UgPSB7fTsKCiAgICBmdW5jdGlvbiBnZXRMYXN0UHJveGllZEdvb2dsZVZpZGVvSWQoKSB7CiAgICAgICAgdmFyIF9sYXN0UHJveGllZEdvb2dsZVZpZDsKICAgICAgICByZXR1cm4gKF9sYXN0UHJveGllZEdvb2dsZVZpZCA9IGxhc3RQcm94aWVkR29vZ2xlVmlkZW9VcmxQYXJhbXMpID09PSBudWxsIHx8IF9sYXN0UHJveGllZEdvb2dsZVZpZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2xhc3RQcm94aWVkR29vZ2xlVmlkLmdldCgnaWQnKTsKICAgIH0KCiAgICBmdW5jdGlvbiB1bmxvY2tSZXNwb25zZSQxKHBsYXllclJlc3BvbnNlKSB7CiAgICAgICAgdmFyIF9wbGF5ZXJSZXNwb25zZSR2aWRlbywgX3BsYXllclJlc3BvbnNlJHBsYXlhLCBfcGxheWVyUmVzcG9uc2UkcHJldmksIF91bmxvY2tlZFBsYXllclJlc3BvbiwgX3VubG9ja2VkUGxheWVyUmVzcG9uMzsKICAgICAgICAvLyBDaGVjayBpZiB0aGUgdXNlciBoYXMgdG8gY29uZmlybSB0aGUgdW5sb2NrIGZpcnN0CiAgICAgICAgaWYgKGlzQ29uZmlybWF0aW9uUmVxdWlyZWQoKSkgewogICAgICAgICAgICBpbmZvKCdVbmxvY2sgY29uZmlybWF0aW9uIHJlcXVpcmVkLicpOwogICAgICAgICAgICByZXF1ZXN0Q29uZmlybWF0aW9uKCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHZpZGVvSWQgPSAoKF9wbGF5ZXJSZXNwb25zZSR2aWRlbyA9IHBsYXllclJlc3BvbnNlLnZpZGVvRGV0YWlscykgPT09IG51bGwgfHwgX3BsYXllclJlc3BvbnNlJHZpZGVvID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfcGxheWVyUmVzcG9uc2UkdmlkZW8udmlkZW9JZCkKICAgICAgICAgICAgfHwgZ2V0WXRjZmdWYWx1ZSgnUExBWUVSX1ZBUlMnKS52aWRlb19pZDsKICAgICAgICBjb25zdCByZWFzb24gPSAoKF9wbGF5ZXJSZXNwb25zZSRwbGF5YSA9IHBsYXllclJlc3BvbnNlLnBsYXlhYmlsaXR5U3RhdHVzKSA9PT0gbnVsbCB8fCBfcGxheWVyUmVzcG9uc2UkcGxheWEgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9wbGF5ZXJSZXNwb25zZSRwbGF5YS5zdGF0dXMpCiAgICAgICAgICAgIHx8ICgoX3BsYXllclJlc3BvbnNlJHByZXZpID0gcGxheWVyUmVzcG9uc2UucHJldmlld1BsYXlhYmlsaXR5U3RhdHVzKSA9PT0gbnVsbCB8fCBfcGxheWVyUmVzcG9uc2UkcHJldmkgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9wbGF5ZXJSZXNwb25zZSRwcmV2aS5zdGF0dXMpOwoKICAgICAgICBpZiAoIUNvbmZpZy5TS0lQX0NPTlRFTlRfV0FSTklOR1MgJiYgcmVhc29uLmluY2x1ZGVzKCdDSEVDS19SRVFVSVJFRCcpKSB7CiAgICAgICAgICAgIGluZm8oYFNLSVBfQ09OVEVOVF9XQVJOSU5HUyBkaXNhYmxlZCBhbmQgJHtyZWFzb259IHN0YXR1cyBkZXRlY3RlZC5gKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgbGFzdFBsYXllclVubG9ja1ZpZGVvSWQgPSB2aWRlb0lkOwogICAgICAgIGxhc3RQbGF5ZXJVbmxvY2tSZWFzb24gPSByZWFzb247CgogICAgICAgIGNvbnN0IHVubG9ja2VkUGxheWVyUmVzcG9uc2UgPSBnZXRVbmxvY2tlZFBsYXllclJlc3BvbnNlKHZpZGVvSWQsIHJlYXNvbik7CgogICAgICAgIC8vIGFjY291bnQgcHJveHkgZXJyb3I/CiAgICAgICAgaWYgKHVubG9ja2VkUGxheWVyUmVzcG9uc2UuZXJyb3JNZXNzYWdlKSB7CiAgICAgICAgICAgIFRvYXN0LnNob3coYCR7bWVzc2FnZXNNYXAuZmFpbH0gKFByb3h5RXJyb3IpYCwgMTApOwogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFBsYXllciBVbmxvY2sgRmFpbGVkLCBQcm94eSBFcnJvciBNZXNzYWdlOiAke3VubG9ja2VkUGxheWVyUmVzcG9uc2UuZXJyb3JNZXNzYWdlfWApOwogICAgICAgIH0KCiAgICAgICAgLy8gY2hlY2sgaWYgdGhlIHVubG9ja2VkIHJlc3BvbnNlIGlzbid0IHBsYXlhYmxlCiAgICAgICAgaWYgKAogICAgICAgICAgICAhQ29uZmlnLlZBTElEX1BMQVlBQklMSVRZX1NUQVRVU0VTLmluY2x1ZGVzKAogICAgICAgICAgICAgICAgKF91bmxvY2tlZFBsYXllclJlc3BvbiA9IHVubG9ja2VkUGxheWVyUmVzcG9uc2UucGxheWFiaWxpdHlTdGF0dXMpID09PSBudWxsIHx8IF91bmxvY2tlZFBsYXllclJlc3BvbiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3VubG9ja2VkUGxheWVyUmVzcG9uLnN0YXR1cywKICAgICAgICAgICAgKQogICAgICAgICkgewogICAgICAgICAgICB2YXIgX3VubG9ja2VkUGxheWVyUmVzcG9uMjsKICAgICAgICAgICAgVG9hc3Quc2hvdyhgJHttZXNzYWdlc01hcC5mYWlsfSAoUGxheWFiaWxpdHlFcnJvcilgLCAxMCk7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigKICAgICAgICAgICAgICAgIGBQbGF5ZXIgVW5sb2NrIEZhaWxlZCwgcGxheWFiaWxpdHlTdGF0dXM6ICR7CiAgICAgICAgICAgICAgICAgICAgKF91bmxvY2tlZFBsYXllclJlc3BvbjIgPSB1bmxvY2tlZFBsYXllclJlc3BvbnNlLnBsYXlhYmlsaXR5U3RhdHVzKSA9PT0gbnVsbCB8fCBfdW5sb2NrZWRQbGF5ZXJSZXNwb24yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfdW5sb2NrZWRQbGF5ZXJSZXNwb24yLnN0YXR1cwogICAgICAgICAgICAgICAgfWAsCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICAvLyBpZiB0aGUgdmlkZW8gaW5mbyB3YXMgcmV0cmlldmVkIHZpYSBwcm94eSwgc3RvcmUgdGhlIFVSTCBwYXJhbXMgZnJvbSB0aGUgdXJsLWF0dHJpYnV0ZSB0byBkZXRlY3QgbGF0ZXIgaWYgdGhlIHJlcXVlc3RlZCB2aWRlbyBmaWxlIChnb29nbGV2aWRlby5jb20pIG5lZWQgYSBwcm94eS4KICAgICAgICBpZiAoCiAgICAgICAgICAgIHVubG9ja2VkUGxheWVyUmVzcG9uc2UucHJveGllZCAmJiAoX3VubG9ja2VkUGxheWVyUmVzcG9uMyA9IHVubG9ja2VkUGxheWVyUmVzcG9uc2Uuc3RyZWFtaW5nRGF0YSkgIT09IG51bGwgJiYgX3VubG9ja2VkUGxheWVyUmVzcG9uMyAhPT0gdm9pZCAwCiAgICAgICAgICAgICYmIF91bmxvY2tlZFBsYXllclJlc3BvbjMuYWRhcHRpdmVGb3JtYXRzCiAgICAgICAgKSB7CiAgICAgICAgICAgIHZhciBfdW5sb2NrZWRQbGF5ZXJSZXNwb240LCBfdW5sb2NrZWRQbGF5ZXJSZXNwb241OwogICAgICAgICAgICBjb25zdCBjaXBoZXJUZXh0ID0gKF91bmxvY2tlZFBsYXllclJlc3BvbjQgPSB1bmxvY2tlZFBsYXllclJlc3BvbnNlLnN0cmVhbWluZ0RhdGEuYWRhcHRpdmVGb3JtYXRzLmZpbmQoKHgpID0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4LnNpZ25hdHVyZUNpcGhlcgogICAgICAgICAgICAgICAgICAgICAgICApKSA9PT0gbnVsbCB8fCBfdW5sb2NrZWRQbGF5ZXJSZXNwb240ID09PSB2b2lkIDAKICAgICAgICAgICAgICAgID8gdm9pZCAwCiAgICAgICAgICAgICAgICA6IF91bmxvY2tlZFBsYXllclJlc3BvbjQuc2lnbmF0dXJlQ2lwaGVyOwogICAgICAgICAgICBjb25zdCB2aWRlb1VybCA9IGNpcGhlclRleHQKICAgICAgICAgICAgICAgID8gbmV3IFVSTFNlYXJjaFBhcmFtcyhjaXBoZXJUZXh0KS5nZXQoJ3VybCcpCiAgICAgICAgICAgICAgICA6IChfdW5sb2NrZWRQbGF5ZXJSZXNwb241ID0gdW5sb2NrZWRQbGF5ZXJSZXNwb25zZS5zdHJlYW1pbmdEYXRhLmFkYXB0aXZlRm9ybWF0cy5maW5kKCh4KSA9PiB4LnVybCkpID09PSBudWxsIHx8IF91bmxvY2tlZFBsYXllclJlc3BvbjUgPT09IHZvaWQgMAogICAgICAgICAgICAgICAgPyB2b2lkIDAKICAgICAgICAgICAgICAgIDogX3VubG9ja2VkUGxheWVyUmVzcG9uNS51cmw7CgogICAgICAgICAgICBsYXN0UHJveGllZEdvb2dsZVZpZGVvVXJsUGFyYW1zID0gdmlkZW9VcmwgPyBuZXcgVVJMU2VhcmNoUGFyYW1zKG5ldyB3aW5kb3cuVVJMKHZpZGVvVXJsKS5zZWFyY2gpIDogbnVsbDsKICAgICAgICB9CgogICAgICAgIC8vIE92ZXJ3cml0ZSB0aGUgZW1iZWRkZWQgKHByZXZpZXcpIHBsYXlhYmlsaXR5U3RhdHVzIHdpdGggdGhlIHVubG9ja2VkIG9uZQogICAgICAgIGlmIChwbGF5ZXJSZXNwb25zZS5wcmV2aWV3UGxheWFiaWxpdHlTdGF0dXMpIHsKICAgICAgICAgICAgcGxheWVyUmVzcG9uc2UucHJldmlld1BsYXlhYmlsaXR5U3RhdHVzID0gdW5sb2NrZWRQbGF5ZXJSZXNwb25zZS5wbGF5YWJpbGl0eVN0YXR1czsKICAgICAgICB9CgogICAgICAgIC8vIFRyYW5zZmVyIGFsbCB1bmxvY2tlZCBwcm9wZXJ0aWVzIHRvIHRoZSBvcmlnaW5hbCBwbGF5ZXIgcmVzcG9uc2UKICAgICAgICBPYmplY3QuYXNzaWduKHBsYXllclJlc3BvbnNlLCB1bmxvY2tlZFBsYXllclJlc3BvbnNlKTsKCiAgICAgICAgcGxheWVyUmVzcG9uc2UudW5sb2NrZWQgPSB0cnVlOwoKICAgICAgICBUb2FzdC5zaG93KG1lc3NhZ2VzTWFwLnN1Y2Nlc3MpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldFVubG9ja2VkUGxheWVyUmVzcG9uc2UodmlkZW9JZCwgcmVhc29uKSB7CiAgICAgICAgLy8gQ2hlY2sgaWYgcmVzcG9uc2UgaXMgY2FjaGVkCiAgICAgICAgaWYgKGNhY2hlZFBsYXllclJlc3BvbnNlLnZpZGVvSWQgPT09IHZpZGVvSWQpIHJldHVybiBjcmVhdGVEZWVwQ29weShjYWNoZWRQbGF5ZXJSZXNwb25zZSk7CgogICAgICAgIGNvbnN0IHVubG9ja1N0cmF0ZWdpZXMgPSBnZXRVbmxvY2tTdHJhdGVnaWVzKHZpZGVvSWQsIHJlYXNvbik7CgogICAgICAgIGxldCB1bmxvY2tlZFBsYXllclJlc3BvbnNlID0ge307CgogICAgICAgIC8vIFRyeSBldmVyeSBzdHJhdGVneSB1bnRpbCBvbmUgb2YgdGhlbSB3b3JrcwogICAgICAgIHVubG9ja1N0cmF0ZWdpZXMuZXZlcnkoKHN0cmF0ZWd5LCBpbmRleCkgPT4gewogICAgICAgICAgICB2YXIgX3VubG9ja2VkUGxheWVyUmVzcG9uNjsKICAgICAgICAgICAgLy8gU2tpcCBzdHJhdGVneSBpZiBhdXRoZW50aWNhdGlvbiBpcyByZXF1aXJlZCBhbmQgdGhlIHVzZXIgaXMgbm90IGxvZ2dlZCBpbgogICAgICAgICAgICBpZiAoc3RyYXRlZ3kuc2tpcCB8fCBzdHJhdGVneS5yZXF1aXJlc0F1dGggJiYgIWlzVXNlckxvZ2dlZEluKCkpIHJldHVybiB0cnVlOwoKICAgICAgICAgICAgaW5mbyhgVHJ5aW5nIFBsYXllciBVbmxvY2sgTWV0aG9kICMke2luZGV4ICsgMX0gKCR7c3RyYXRlZ3kubmFtZX0pYCk7CgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgdW5sb2NrZWRQbGF5ZXJSZXNwb25zZSA9IHN0cmF0ZWd5LmVuZHBvaW50LmdldFBsYXllcihzdHJhdGVneS5wYXlsb2FkLCBzdHJhdGVneS5yZXF1aXJlc0F1dGggfHwgc3RyYXRlZ3kub3B0aW9uYWxBdXRoKTsKICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgICBlcnJvcihlcnIsIGBQbGF5ZXIgVW5sb2NrIE1ldGhvZCAke2luZGV4ICsgMX0gZmFpbGVkIHdpdGggZXhjZXB0aW9uYCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbnN0IGlzU3RhdHVzVmFsaWQgPSBDb25maWcuVkFMSURfUExBWUFCSUxJVFlfU1RBVFVTRVMuaW5jbHVkZXMoCiAgICAgICAgICAgICAgICAoX3VubG9ja2VkUGxheWVyUmVzcG9uNiA9IHVubG9ja2VkUGxheWVyUmVzcG9uc2UpID09PSBudWxsIHx8IF91bmxvY2tlZFBsYXllclJlc3BvbjYgPT09IHZvaWQgMAogICAgICAgICAgICAgICAgICAgIHx8IChfdW5sb2NrZWRQbGF5ZXJSZXNwb242ID0gX3VubG9ja2VkUGxheWVyUmVzcG9uNi5wbGF5YWJpbGl0eVN0YXR1cykgPT09IG51bGwgfHwgX3VubG9ja2VkUGxheWVyUmVzcG9uNiA9PT0gdm9pZCAwCiAgICAgICAgICAgICAgICAgICAgPyB2b2lkIDAKICAgICAgICAgICAgICAgICAgICA6IF91bmxvY2tlZFBsYXllclJlc3BvbjYuc3RhdHVzLAogICAgICAgICAgICApOwoKICAgICAgICAgICAgaWYgKGlzU3RhdHVzVmFsaWQpIHsKICAgICAgICAgICAgICAgIHZhciBfdW5sb2NrZWRQbGF5ZXJSZXNwb243OwogICAgICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAgICAgKiBXb3JrYXJvdW5kOiBodHRwczovL2dpdGh1Yi5jb20vemVyb2R5dHJhc2gvU2ltcGxlLVlvdVR1YmUtQWdlLVJlc3RyaWN0aW9uLUJ5cGFzcy9pc3N1ZXMvMTkxCiAgICAgICAgICAgICAgICAgKgogICAgICAgICAgICAgICAgICogWW91VHViZSBjaGVja3MgaWYgdGhlIGB0cmFja2luZ1BhcmFtc2AgaW4gdGhlIHJlc3BvbnNlIG1hdGNoZXMgdGhlIGRlY29kZWQgYHRyYWNraW5nUGFyYW1gIGluIGByZXNwb25zZUNvbnRleHQubWFpbkFwcFdlYlJlc3BvbnNlQ29udGV4dGAuCiAgICAgICAgICAgICAgICAgKiBIb3dldmVyLCBzb21ldGltZXMgdGhlIHJlc3BvbnNlIGRvZXMgbm90IGluY2x1ZGUgdGhlIGB0cmFja2luZ1BhcmFtYCBpbiB0aGUgYHJlc3BvbnNlQ29udGV4dGAsIGNhdXNpbmcgdGhlIGNoZWNrIHRvIGZhaWwuCiAgICAgICAgICAgICAgICAgKgogICAgICAgICAgICAgICAgICogVGhpcyB3b3JrYXJvdW5kIGFkZHJlc3NlcyB0aGUgaXNzdWUgYnkgaGFyZGNvZGluZyB0aGUgYHRyYWNraW5nUGFyYW1zYCBpbiB0aGUgcmVzcG9uc2UgY29udGV4dC4KICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAgICF1bmxvY2tlZFBsYXllclJlc3BvbnNlLnRyYWNraW5nUGFyYW1zCiAgICAgICAgICAgICAgICAgICAgfHwgISgoX3VubG9ja2VkUGxheWVyUmVzcG9uNyA9IHVubG9ja2VkUGxheWVyUmVzcG9uc2UucmVzcG9uc2VDb250ZXh0KSAhPT0gbnVsbCAmJiBfdW5sb2NrZWRQbGF5ZXJSZXNwb243ICE9PSB2b2lkIDAKICAgICAgICAgICAgICAgICAgICAgICAgJiYgKF91bmxvY2tlZFBsYXllclJlc3BvbjcgPSBfdW5sb2NrZWRQbGF5ZXJSZXNwb243Lm1haW5BcHBXZWJSZXNwb25zZUNvbnRleHQpICE9PSBudWxsICYmIF91bmxvY2tlZFBsYXllclJlc3BvbjcgIT09IHZvaWQgMAogICAgICAgICAgICAgICAgICAgICAgICAmJiBfdW5sb2NrZWRQbGF5ZXJSZXNwb243LnRyYWNraW5nUGFyYW0pCiAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgICB1bmxvY2tlZFBsYXllclJlc3BvbnNlLnRyYWNraW5nUGFyYW1zID0gJ0NBQVF1MmtpRXdqb3I4dUh5T0xfQWhXT3ZkNEtIYXZYQ0t3PSc7CiAgICAgICAgICAgICAgICAgICAgdW5sb2NrZWRQbGF5ZXJSZXNwb25zZS5yZXNwb25zZUNvbnRleHQgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG1haW5BcHBXZWJSZXNwb25zZUNvbnRleHQ6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYWNraW5nUGFyYW06ICdreF9mbVB4aG9QWlJ6Z0w4a3pPd0FOVWRRaDhad0hUUkVrdzJVcW1CQXdwQllyelJna3VNc05MQndPY0NFNTlURHRzbExLUFEtU1MnLAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAgICAgKiBXb3JrYXJvdW5kOiBBY2NvdW50IHByb3h5IHJlc3BvbnNlIGN1cnJlbnRseSBkb2VzIG5vdCBpbmNsdWRlIGBwbGF5ZXJDb25maWdgCiAgICAgICAgICAgICAgICAgKgogICAgICAgICAgICAgICAgICogU3RheXMgaGVyZSB1bnRpbCB3ZSByZXdyaXRlIHRoZSBhY2NvdW50IHByb3h5IHRvIG9ubHkgaW5jbHVkZSB0aGUgbmVjZXNzYXJ5IGFuZCBiYXJlIG1pbmltdW0gcmVzcG9uc2UKICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgaWYgKHN0cmF0ZWd5LnBheWxvYWQuc3RhcnRUaW1lU2VjcyAmJiBzdHJhdGVneS5uYW1lID09PSAnQWNjb3VudCBQcm94eScpIHsKICAgICAgICAgICAgICAgICAgICB1bmxvY2tlZFBsYXllclJlc3BvbnNlLnBsYXllckNvbmZpZyA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgcGxheWJhY2tTdGFydENvbmZpZzogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRTZWNvbmRzOiBzdHJhdGVneS5wYXlsb2FkLnN0YXJ0VGltZVNlY3MsCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuICFpc1N0YXR1c1ZhbGlkOwogICAgICAgIH0pOwoKICAgICAgICAvLyBDYWNoZSByZXNwb25zZSB0byBwcmV2ZW50IGEgZmxvb2Qgb2YgcmVxdWVzdHMgaW4gY2FzZSB5b3V0dWJlIHByb2Nlc3NlcyBhIGJsb2NrZWQgcmVzcG9uc2UgbXV0aXBsZSB0aW1lcy4KICAgICAgICBjYWNoZWRQbGF5ZXJSZXNwb25zZSA9IHsgdmlkZW9JZCwgLi4uY3JlYXRlRGVlcENvcHkodW5sb2NrZWRQbGF5ZXJSZXNwb25zZSkgfTsKCiAgICAgICAgcmV0dXJuIHVubG9ja2VkUGxheWVyUmVzcG9uc2U7CiAgICB9CgogICAgbGV0IGNhY2hlZE5leHRSZXNwb25zZSA9IHt9OwoKICAgIGZ1bmN0aW9uIHVubG9ja1Jlc3BvbnNlKG9yaWdpbmFsTmV4dFJlc3BvbnNlKSB7CiAgICAgICAgY29uc3QgdmlkZW9JZCA9IG9yaWdpbmFsTmV4dFJlc3BvbnNlLmN1cnJlbnRWaWRlb0VuZHBvaW50LndhdGNoRW5kcG9pbnQudmlkZW9JZDsKCiAgICAgICAgaWYgKCF2aWRlb0lkKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgTWlzc2luZyB2aWRlb0lkIGluIG5leHRSZXNwb25zZWApOwogICAgICAgIH0KCiAgICAgICAgLy8gT25seSB1bmxvY2sgdGhlIC9uZXh0IHJlc3BvbnNlIHdoZW4gdGhlIHBsYXllciBoYXMgYmVlbiB1bmxvY2tlZCBhcyB3ZWxsCiAgICAgICAgaWYgKHZpZGVvSWQgIT09IGxhc3RQbGF5ZXJVbmxvY2tWaWRlb0lkKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHVubG9ja2VkTmV4dFJlc3BvbnNlID0gZ2V0VW5sb2NrZWROZXh0UmVzcG9uc2UodmlkZW9JZCk7CgogICAgICAgIC8vIGNoZWNrIGlmIHRoZSBzaWRlYmFyIG9mIHRoZSB1bmxvY2tlZCByZXNwb25zZSBpcyBzdGlsbCBlbXB0eQogICAgICAgIGlmIChpc1dhdGNoTmV4dFNpZGViYXJFbXB0eSh1bmxvY2tlZE5leHRSZXNwb25zZSkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBTaWRlYmFyIFVubG9jayBGYWlsZWRgKTsKICAgICAgICB9CgogICAgICAgIC8vIFRyYW5zZmVyIHNvbWUgcGFydHMgb2YgdGhlIHVubG9ja2VkIHJlc3BvbnNlIHRvIHRoZSBvcmlnaW5hbCByZXNwb25zZQogICAgICAgIG1lcmdlTmV4dFJlc3BvbnNlKG9yaWdpbmFsTmV4dFJlc3BvbnNlLCB1bmxvY2tlZE5leHRSZXNwb25zZSk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0VW5sb2NrZWROZXh0UmVzcG9uc2UodmlkZW9JZCkgewogICAgICAgIC8vIENoZWNrIGlmIHJlc3BvbnNlIGlzIGNhY2hlZAogICAgICAgIGlmIChjYWNoZWROZXh0UmVzcG9uc2UudmlkZW9JZCA9PT0gdmlkZW9JZCkgcmV0dXJuIGNyZWF0ZURlZXBDb3B5KGNhY2hlZE5leHRSZXNwb25zZSk7CgogICAgICAgIGNvbnN0IHVubG9ja1N0cmF0ZWdpZXMgPSBnZXRVbmxvY2tTdHJhdGVnaWVzJDEodmlkZW9JZCwgbGFzdFBsYXllclVubG9ja1JlYXNvbik7CgogICAgICAgIGxldCB1bmxvY2tlZE5leHRSZXNwb25zZSA9IHt9OwoKICAgICAgICAvLyBUcnkgZXZlcnkgc3RyYXRlZ3kgdW50aWwgb25lIG9mIHRoZW0gd29ya3MKICAgICAgICB1bmxvY2tTdHJhdGVnaWVzLmV2ZXJ5KChzdHJhdGVneSwgaW5kZXgpID0+IHsKICAgICAgICAgICAgaWYgKHN0cmF0ZWd5LnNraXApIHJldHVybiB0cnVlOwoKICAgICAgICAgICAgaW5mbyhgVHJ5aW5nIE5leHQgVW5sb2NrIE1ldGhvZCAjJHtpbmRleCArIDF9ICgke3N0cmF0ZWd5Lm5hbWV9KWApOwoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHVubG9ja2VkTmV4dFJlc3BvbnNlID0gc3RyYXRlZ3kuZW5kcG9pbnQuZ2V0TmV4dChzdHJhdGVneS5wYXlsb2FkLCBzdHJhdGVneS5vcHRpb25hbEF1dGgpOwogICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICAgIGVycm9yKGVyciwgYE5leHQgVW5sb2NrIE1ldGhvZCAke2luZGV4ICsgMX0gZmFpbGVkIHdpdGggZXhjZXB0aW9uYCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBpc1dhdGNoTmV4dFNpZGViYXJFbXB0eSh1bmxvY2tlZE5leHRSZXNwb25zZSk7CiAgICAgICAgfSk7CgogICAgICAgIC8vIENhY2hlIHJlc3BvbnNlIHRvIHByZXZlbnQgYSBmbG9vZCBvZiByZXF1ZXN0cyBpbiBjYXNlIHlvdXR1YmUgcHJvY2Vzc2VzIGEgYmxvY2tlZCByZXNwb25zZSBtdXRpcGxlIHRpbWVzLgogICAgICAgIGNhY2hlZE5leHRSZXNwb25zZSA9IHsgdmlkZW9JZCwgLi4uY3JlYXRlRGVlcENvcHkodW5sb2NrZWROZXh0UmVzcG9uc2UpIH07CgogICAgICAgIHJldHVybiB1bmxvY2tlZE5leHRSZXNwb25zZTsKICAgIH0KCiAgICBmdW5jdGlvbiBtZXJnZU5leHRSZXNwb25zZShvcmlnaW5hbE5leHRSZXNwb25zZSwgdW5sb2NrZWROZXh0UmVzcG9uc2UpIHsKICAgICAgICB2YXIgX3VubG9ja2VkTmV4dFJlc3BvbnNlOwogICAgICAgIGlmIChpc0Rlc2t0b3ApIHsKICAgICAgICAgICAgLy8gVHJhbnNmZXIgV2F0Y2hOZXh0UmVzdWx0cyB0byBvcmlnaW5hbCByZXNwb25zZQogICAgICAgICAgICBvcmlnaW5hbE5leHRSZXNwb25zZS5jb250ZW50cy50d29Db2x1bW5XYXRjaE5leHRSZXN1bHRzLnNlY29uZGFyeVJlc3VsdHMgPSB1bmxvY2tlZE5leHRSZXNwb25zZS5jb250ZW50cy50d29Db2x1bW5XYXRjaE5leHRSZXN1bHRzLnNlY29uZGFyeVJlc3VsdHM7CgogICAgICAgICAgICAvLyBUcmFuc2ZlciB2aWRlbyBkZXNjcmlwdGlvbiB0byBvcmlnaW5hbCByZXNwb25zZQogICAgICAgICAgICBjb25zdCBvcmlnaW5hbFZpZGVvU2Vjb25kYXJ5SW5mb1JlbmRlcmVyID0gb3JpZ2luYWxOZXh0UmVzcG9uc2UuY29udGVudHMudHdvQ29sdW1uV2F0Y2hOZXh0UmVzdWx0cy5yZXN1bHRzLnJlc3VsdHMuY29udGVudHMuZmluZCgKICAgICAgICAgICAgICAgICh4KSA9PiB4LnZpZGVvU2Vjb25kYXJ5SW5mb1JlbmRlcmVyLAogICAgICAgICAgICApLnZpZGVvU2Vjb25kYXJ5SW5mb1JlbmRlcmVyOwogICAgICAgICAgICBjb25zdCB1bmxvY2tlZFZpZGVvU2Vjb25kYXJ5SW5mb1JlbmRlcmVyID0gdW5sb2NrZWROZXh0UmVzcG9uc2UuY29udGVudHMudHdvQ29sdW1uV2F0Y2hOZXh0UmVzdWx0cy5yZXN1bHRzLnJlc3VsdHMuY29udGVudHMuZmluZCgKICAgICAgICAgICAgICAgICh4KSA9PiB4LnZpZGVvU2Vjb25kYXJ5SW5mb1JlbmRlcmVyLAogICAgICAgICAgICApLnZpZGVvU2Vjb25kYXJ5SW5mb1JlbmRlcmVyOwoKICAgICAgICAgICAgLy8gVE9ETzogVGhyb3cgaWYgZGVzY3JpcHRpb24gbm90IGZvdW5kPwogICAgICAgICAgICBpZiAodW5sb2NrZWRWaWRlb1NlY29uZGFyeUluZm9SZW5kZXJlci5kZXNjcmlwdGlvbikgewogICAgICAgICAgICAgICAgb3JpZ2luYWxWaWRlb1NlY29uZGFyeUluZm9SZW5kZXJlci5kZXNjcmlwdGlvbiA9IHVubG9ja2VkVmlkZW9TZWNvbmRhcnlJbmZvUmVuZGVyZXIuZGVzY3JpcHRpb247CiAgICAgICAgICAgIH0gZWxzZSBpZiAodW5sb2NrZWRWaWRlb1NlY29uZGFyeUluZm9SZW5kZXJlci5hdHRyaWJ1dGVkRGVzY3JpcHRpb24pIHsKICAgICAgICAgICAgICAgIG9yaWdpbmFsVmlkZW9TZWNvbmRhcnlJbmZvUmVuZGVyZXIuYXR0cmlidXRlZERlc2NyaXB0aW9uID0gdW5sb2NrZWRWaWRlb1NlY29uZGFyeUluZm9SZW5kZXJlci5hdHRyaWJ1dGVkRGVzY3JpcHRpb247CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIFRyYW5zZmVyIFdhdGNoTmV4dFJlc3VsdHMgdG8gb3JpZ2luYWwgcmVzcG9uc2UKICAgICAgICBjb25zdCB1bmxvY2tlZFdhdGNoTmV4dEZlZWQgPSAoX3VubG9ja2VkTmV4dFJlc3BvbnNlID0gdW5sb2NrZWROZXh0UmVzcG9uc2UuY29udGVudHMpID09PSBudWxsIHx8IF91bmxvY2tlZE5leHRSZXNwb25zZSA9PT0gdm9pZCAwCiAgICAgICAgICAgICAgICB8fCAoX3VubG9ja2VkTmV4dFJlc3BvbnNlID0gX3VubG9ja2VkTmV4dFJlc3BvbnNlLnNpbmdsZUNvbHVtbldhdGNoTmV4dFJlc3VsdHMpID09PSBudWxsIHx8IF91bmxvY2tlZE5leHRSZXNwb25zZSA9PT0gdm9pZCAwCiAgICAgICAgICAgICAgICB8fCAoX3VubG9ja2VkTmV4dFJlc3BvbnNlID0gX3VubG9ja2VkTmV4dFJlc3BvbnNlLnJlc3VsdHMpID09PSBudWxsIHx8IF91bmxvY2tlZE5leHRSZXNwb25zZSA9PT0gdm9pZCAwCiAgICAgICAgICAgICAgICB8fCAoX3VubG9ja2VkTmV4dFJlc3BvbnNlID0gX3VubG9ja2VkTmV4dFJlc3BvbnNlLnJlc3VsdHMpID09PSBudWxsIHx8IF91bmxvY2tlZE5leHRSZXNwb25zZSA9PT0gdm9pZCAwCiAgICAgICAgICAgICAgICB8fCAoX3VubG9ja2VkTmV4dFJlc3BvbnNlID0gX3VubG9ja2VkTmV4dFJlc3BvbnNlLmNvbnRlbnRzKSA9PT0gbnVsbCB8fCBfdW5sb2NrZWROZXh0UmVzcG9uc2UgPT09IHZvaWQgMAogICAgICAgICAgICA/IHZvaWQgMAogICAgICAgICAgICA6IF91bmxvY2tlZE5leHRSZXNwb25zZS5maW5kKAogICAgICAgICAgICAgICAgKHgpID0+IHsKICAgICAgICAgICAgICAgICAgICB2YXIgX3gkaXRlbVNlY3Rpb25SZW5kZXJlOwogICAgICAgICAgICAgICAgICAgIHJldHVybiAoKF94JGl0ZW1TZWN0aW9uUmVuZGVyZSA9IHguaXRlbVNlY3Rpb25SZW5kZXJlcikgPT09IG51bGwgfHwgX3gkaXRlbVNlY3Rpb25SZW5kZXJlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfeCRpdGVtU2VjdGlvblJlbmRlcmUudGFyZ2V0SWQpCiAgICAgICAgICAgICAgICAgICAgICAgID09PSAnd2F0Y2gtbmV4dC1mZWVkJzsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICk7CgogICAgICAgIGlmICh1bmxvY2tlZFdhdGNoTmV4dEZlZWQpIG9yaWdpbmFsTmV4dFJlc3BvbnNlLmNvbnRlbnRzLnNpbmdsZUNvbHVtbldhdGNoTmV4dFJlc3VsdHMucmVzdWx0cy5yZXN1bHRzLmNvbnRlbnRzLnB1c2godW5sb2NrZWRXYXRjaE5leHRGZWVkKTsKCiAgICAgICAgLy8gVHJhbnNmZXIgdmlkZW8gZGVzY3JpcHRpb24gdG8gb3JpZ2luYWwgcmVzcG9uc2UKICAgICAgICBjb25zdCBvcmlnaW5hbFN0cnVjdHVyZWREZXNjcmlwdGlvbkNvbnRlbnRSZW5kZXJlciA9IG9yaWdpbmFsTmV4dFJlc3BvbnNlLmVuZ2FnZW1lbnRQYW5lbHMKICAgICAgICAgICAgLmZpbmQoKHgpID0+IHguZW5nYWdlbWVudFBhbmVsU2VjdGlvbkxpc3RSZW5kZXJlcikKICAgICAgICAgICAgLmVuZ2FnZW1lbnRQYW5lbFNlY3Rpb25MaXN0UmVuZGVyZXIuY29udGVudC5zdHJ1Y3R1cmVkRGVzY3JpcHRpb25Db250ZW50UmVuZGVyZXIuaXRlbXMuZmluZCgoeCkgPT4geC5leHBhbmRhYmxlVmlkZW9EZXNjcmlwdGlvbkJvZHlSZW5kZXJlcik7CiAgICAgICAgY29uc3QgdW5sb2NrZWRTdHJ1Y3R1cmVkRGVzY3JpcHRpb25Db250ZW50UmVuZGVyZXIgPSB1bmxvY2tlZE5leHRSZXNwb25zZS5lbmdhZ2VtZW50UGFuZWxzCiAgICAgICAgICAgIC5maW5kKCh4KSA9PiB4LmVuZ2FnZW1lbnRQYW5lbFNlY3Rpb25MaXN0UmVuZGVyZXIpCiAgICAgICAgICAgIC5lbmdhZ2VtZW50UGFuZWxTZWN0aW9uTGlzdFJlbmRlcmVyLmNvbnRlbnQuc3RydWN0dXJlZERlc2NyaXB0aW9uQ29udGVudFJlbmRlcmVyLml0ZW1zLmZpbmQoKHgpID0+IHguZXhwYW5kYWJsZVZpZGVvRGVzY3JpcHRpb25Cb2R5UmVuZGVyZXIpOwoKICAgICAgICBpZiAodW5sb2NrZWRTdHJ1Y3R1cmVkRGVzY3JpcHRpb25Db250ZW50UmVuZGVyZXIuZXhwYW5kYWJsZVZpZGVvRGVzY3JpcHRpb25Cb2R5UmVuZGVyZXIpIHsKICAgICAgICAgICAgb3JpZ2luYWxTdHJ1Y3R1cmVkRGVzY3JpcHRpb25Db250ZW50UmVuZGVyZXIuZXhwYW5kYWJsZVZpZGVvRGVzY3JpcHRpb25Cb2R5UmVuZGVyZXIgPQogICAgICAgICAgICAgICAgdW5sb2NrZWRTdHJ1Y3R1cmVkRGVzY3JpcHRpb25Db250ZW50UmVuZGVyZXIuZXhwYW5kYWJsZVZpZGVvRGVzY3JpcHRpb25Cb2R5UmVuZGVyZXI7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogIEhhbmRsZXMgWE1MSHR0cFJlcXVlc3RzIGFuZAogICAgICogLSBSZXdyaXRlIEdvb2dsZXZpZGVvIFVSTHMgdG8gUHJveHkgVVJMcyAoaWYgbmVjZXNzYXJ5KQogICAgICogLSBTdG9yZSBhdXRoIGhlYWRlcnMgZm9yIHRoZSBhdXRoZW50aWNhdGlvbiBvZiBmdXJ0aGVyIHVubG9jayByZXF1ZXN0cy4KICAgICAqIC0gQWRkICJjb250ZW50IGNoZWNrIG9rIiBmbGFncyB0byByZXF1ZXN0IGJvZHlzCiAgICAgKi8KICAgIGZ1bmN0aW9uIGhhbmRsZVhock9wZW4obWV0aG9kLCB1cmwsIHhocikgewogICAgICAgIGxldCBwcm94eVVybCA9IHVubG9ja0dvb2dsZVZpZGVvKHVybCk7CiAgICAgICAgaWYgKHByb3h5VXJsKSB7CiAgICAgICAgICAgIC8vIEV4Y2x1ZGUgY3JlZGVudGlhbHMgZnJvbSBYTUxIdHRwUmVxdWVzdAogICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoeGhyLCAnd2l0aENyZWRlbnRpYWxzJywgewogICAgICAgICAgICAgICAgc2V0OiAoKSA9PiB7fSwKICAgICAgICAgICAgICAgIGdldDogKCkgPT4gZmFsc2UsCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm4gcHJveHlVcmw7CiAgICAgICAgfQoKICAgICAgICBpZiAodXJsLnBhdGhuYW1lLmluZGV4T2YoJy95b3V0dWJlaS8nKSA9PT0gMCkgewogICAgICAgICAgICAvLyBTdG9yZSBhdXRoIGhlYWRlcnMgaW4gc3RvcmFnZSBmb3IgZnVydGhlciB1c2FnZS4KICAgICAgICAgICAgYXR0YWNoJDQoeGhyLCAnc2V0UmVxdWVzdEhlYWRlcicsIChbaGVhZGVyTmFtZSwgaGVhZGVyVmFsdWVdKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoQ29uZmlnLkdPT0dMRV9BVVRIX0hFQURFUl9OQU1FUy5pbmNsdWRlcyhoZWFkZXJOYW1lKSkgewogICAgICAgICAgICAgICAgICAgIHNldChoZWFkZXJOYW1lLCBoZWFkZXJWYWx1ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKENvbmZpZy5TS0lQX0NPTlRFTlRfV0FSTklOR1MgJiYgbWV0aG9kID09PSAnUE9TVCcgJiYgWycveW91dHViZWkvdjEvcGxheWVyJywgJy95b3V0dWJlaS92MS9uZXh0J10uaW5jbHVkZXModXJsLnBhdGhuYW1lKSkgewogICAgICAgICAgICAvLyBBZGQgY29udGVudCBjaGVjayBmbGFncyB0byBwbGF5ZXIgYW5kIG5leHQgcmVxdWVzdCAodGhpcyB3aWxsIHNraXAgY29udGVudCB3YXJuaW5ncykKICAgICAgICAgICAgYXR0YWNoJDQoeGhyLCAnc2VuZCcsIChhcmdzKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGFyZ3NbMF0gPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgICAgICAgICAgYXJnc1swXSA9IHNldENvbnRlbnRDaGVja09rKGFyZ3NbMF0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiAgSGFuZGxlcyBGZXRjaCByZXF1ZXN0cyBhbmQKICAgICAqIC0gUmV3cml0ZSBHb29nbGV2aWRlbyBVUkxzIHRvIFByb3h5IFVSTHMgKGlmIG5lY2Vzc2FyeSkKICAgICAqIC0gU3RvcmUgYXV0aCBoZWFkZXJzIGZvciB0aGUgYXV0aGVudGljYXRpb24gb2YgZnVydGhlciB1bmxvY2sgcmVxdWVzdHMuCiAgICAgKiAtIEFkZCAiY29udGVudCBjaGVjayBvayIgZmxhZ3MgdG8gcmVxdWVzdCBib2R5cwogICAgICovCiAgICBmdW5jdGlvbiBoYW5kbGVGZXRjaFJlcXVlc3QodXJsLCByZXF1ZXN0T3B0aW9ucykgewogICAgICAgIGxldCBuZXdHb29nbGVWaWRlb1VybCA9IHVubG9ja0dvb2dsZVZpZGVvKHVybCk7CiAgICAgICAgaWYgKG5ld0dvb2dsZVZpZGVvVXJsKSB7CiAgICAgICAgICAgIC8vIEV4Y2x1ZGUgY3JlZGVudGlhbHMgZnJvbSBGZXRjaCBSZXF1ZXN0CiAgICAgICAgICAgIGlmIChyZXF1ZXN0T3B0aW9ucy5jcmVkZW50aWFscykgewogICAgICAgICAgICAgICAgcmVxdWVzdE9wdGlvbnMuY3JlZGVudGlhbHMgPSAnb21pdCc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG5ld0dvb2dsZVZpZGVvVXJsOwogICAgICAgIH0KCiAgICAgICAgaWYgKHVybC5wYXRobmFtZS5pbmRleE9mKCcveW91dHViZWkvJykgPT09IDAgJiYgaXNPYmplY3QocmVxdWVzdE9wdGlvbnMuaGVhZGVycykpIHsKICAgICAgICAgICAgLy8gU3RvcmUgYXV0aCBoZWFkZXJzIGluIGF1dGhTdG9yYWdlIGZvciBmdXJ0aGVyIHVzYWdlLgogICAgICAgICAgICBmb3IgKGxldCBoZWFkZXJOYW1lIGluIHJlcXVlc3RPcHRpb25zLmhlYWRlcnMpIHsKICAgICAgICAgICAgICAgIGlmIChDb25maWcuR09PR0xFX0FVVEhfSEVBREVSX05BTUVTLmluY2x1ZGVzKGhlYWRlck5hbWUpKSB7CiAgICAgICAgICAgICAgICAgICAgc2V0KGhlYWRlck5hbWUsIHJlcXVlc3RPcHRpb25zLmhlYWRlcnNbaGVhZGVyTmFtZV0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoQ29uZmlnLlNLSVBfQ09OVEVOVF9XQVJOSU5HUyAmJiBbJy95b3V0dWJlaS92MS9wbGF5ZXInLCAnL3lvdXR1YmVpL3YxL25leHQnXS5pbmNsdWRlcyh1cmwucGF0aG5hbWUpKSB7CiAgICAgICAgICAgIC8vIEFkZCBjb250ZW50IGNoZWNrIGZsYWdzIHRvIHBsYXllciBhbmQgbmV4dCByZXF1ZXN0ICh0aGlzIHdpbGwgc2tpcCBjb250ZW50IHdhcm5pbmdzKQogICAgICAgICAgICByZXF1ZXN0T3B0aW9ucy5ib2R5ID0gc2V0Q29udGVudENoZWNrT2socmVxdWVzdE9wdGlvbnMuYm9keSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogSWYgdGhlIGFjY291bnQgcHJveHkgd2FzIHVzZWQgdG8gcmV0cmlldmUgdGhlIHZpZGVvIGluZm8sIHRoZSBmb2xsb3dpbmcgYXBwbGllczoKICAgICAqIHNvbWUgdmlkZW8gZmlsZXMgKG1vc3RseSBtdXNpYyB2aWRlb3MpIGNhbiBvbmx5IGJlIGFjY2Vzc2VkIGZyb20gSVBzIGluIHRoZSBzYW1lIGNvdW50cnkgYXMgdGhlIGlubmVydHViZSBhcGkgcmVxdWVzdCAoL3lvdXR1YmVpL3YxL3BsYXllcikgd2FzIG1hZGUuCiAgICAgKiB0byBnZXQgYXJvdW5kIHRoaXMsIHRoZSBnb29nbGV2aWRlbyBVUkwgd2lsbCBiZSByZXBsYWNlZCB3aXRoIGEgd2ViLXByb3h5IFVSTCBpbiB0aGUgc2FtZSBjb3VudHJ5IChVUykuCiAgICAgKiB0aGlzIGlzIG9ubHkgcmVxdWlyZWQgaWYgdGhlICJnY3I9W2NvdW50cnljb2RlXSIgZmxhZyBpcyBzZXQgaW4gdGhlIGdvb2dsZXZpZGVvLXVybC4uLgogICAgICogQHJldHVybnMgVGhlIHJld2l0dGVuIHVybCAoaWYgYSBwcm94eSBpcyByZXF1aXJlZCkKICAgICAqLwogICAgZnVuY3Rpb24gdW5sb2NrR29vZ2xlVmlkZW8odXJsKSB7CiAgICAgICAgaWYgKENvbmZpZy5WSURFT19QUk9YWV9TRVJWRVJfSE9TVCAmJiBpc0dvb2dsZVZpZGVvVXJsKHVybCkpIHsKICAgICAgICAgICAgaWYgKGlzR29vZ2xlVmlkZW9VbmxvY2tSZXF1aXJlZCh1cmwsIGdldExhc3RQcm94aWVkR29vZ2xlVmlkZW9JZCgpKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHByb3h5LmdldEdvb2dsZVZpZGVvVXJsKHVybCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIGBjb250ZW50Q2hlY2tPa2AgYW5kIGByYWN5Q2hlY2tPa2AgdG8gdGhlIGdpdmVuIGpzb24gZGF0YSAoaWYgdGhlIGRhdGEgY29udGFpbnMgYSB2aWRlbyBpZCkKICAgICAqIEByZXR1cm5zIHtzdHJpbmd9IFRoZSBtb2RpZmllZCBqc29uCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNldENvbnRlbnRDaGVja09rKGJvZHlKc29uKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgbGV0IHBhcnNlZEJvZHkgPSBKU09OLnBhcnNlKGJvZHlKc29uKTsKICAgICAgICAgICAgaWYgKHBhcnNlZEJvZHkudmlkZW9JZCkgewogICAgICAgICAgICAgICAgcGFyc2VkQm9keS5jb250ZW50Q2hlY2tPayA9IHRydWU7CiAgICAgICAgICAgICAgICBwYXJzZWRCb2R5LnJhY3lDaGVja09rID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShwYXJzZWRCb2R5KTsKICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2gge30KICAgICAgICByZXR1cm4gYm9keUpzb247CiAgICB9CgogICAgZnVuY3Rpb24gcHJvY2Vzc1RodW1ibmFpbHMocmVzcG9uc2VPYmplY3QpIHsKICAgICAgICBjb25zdCB0aHVtYm5haWxzID0gZmluZE5lc3RlZE9iamVjdHNCeUF0dHJpYnV0ZU5hbWVzKHJlc3BvbnNlT2JqZWN0LCBbJ3VybCcsICdoZWlnaHQnXSk7CgogICAgICAgIGxldCBibHVycmVkVGh1bWJuYWlsQ291bnQgPSAwOwoKICAgICAgICBmb3IgKGNvbnN0IHRodW1ibmFpbCBvZiB0aHVtYm5haWxzKSB7CiAgICAgICAgICAgIGlmIChpc1RodW1ibmFpbEJsdXJyZWQodGh1bWJuYWlsKSkgewogICAgICAgICAgICAgICAgYmx1cnJlZFRodW1ibmFpbENvdW50Kys7CiAgICAgICAgICAgICAgICB0aHVtYm5haWwudXJsID0gdGh1bWJuYWlsLnVybC5zcGxpdCgnPycpWzBdOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpbmZvKGJsdXJyZWRUaHVtYm5haWxDb3VudCArICcvJyArIHRodW1ibmFpbHMubGVuZ3RoICsgJyB0aHVtYm5haWxzIGRldGVjdGVkIGFzIGJsdXJyZWQuJyk7CiAgICB9CgogICAgZnVuY3Rpb24gaXNUaHVtYm5haWxCbHVycmVkKHRodW1ibmFpbCkgewogICAgICAgIGNvbnN0IGhhc1NRUFBhcmFtID0gdGh1bWJuYWlsLnVybC5pbmRleE9mKCc/c3FwPScpICE9PSAtMTsKCiAgICAgICAgaWYgKCFoYXNTUVBQYXJhbSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBjb25zdCBTUVBMZW5ndGggPSBuZXcgVVJMKHRodW1ibmFpbC51cmwpLnNlYXJjaFBhcmFtcy5nZXQoJ3NxcCcpLmxlbmd0aDsKICAgICAgICBjb25zdCBpc0JsdXJyZWQgPSBDb25maWcuQkxVUlJFRF9USFVNQk5BSUxfU1FQX0xFTkdUSFMuaW5jbHVkZXMoU1FQTGVuZ3RoKTsKCiAgICAgICAgcmV0dXJuIGlzQmx1cnJlZDsKICAgIH0KCiAgICB0cnkgewogICAgICAgIGF0dGFjaCQzKHByb2Nlc3NZdERhdGEpOwogICAgICAgIGF0dGFjaCQyKHByb2Nlc3NZdERhdGEpOwogICAgICAgIGF0dGFjaChoYW5kbGVYaHJPcGVuKTsKICAgICAgICBhdHRhY2gkMShoYW5kbGVGZXRjaFJlcXVlc3QpOwogICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgZXJyb3IoZXJyLCAnRXJyb3Igd2hpbGUgYXR0YWNoaW5nIGRhdGEgaW50ZXJjZXB0b3JzJyk7CiAgICB9CgogICAgZnVuY3Rpb24gcHJvY2Vzc1l0RGF0YSh5dERhdGEpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBQbGF5ZXIgVW5sb2NrICMxOiBJbml0aWFsIHBhZ2UgZGF0YSBzdHJ1Y3R1cmUgYW5kIHJlc3BvbnNlIGZyb20gYC95b3V0dWJlaS92MS9wbGF5ZXJgIFhIUiByZXF1ZXN0CiAgICAgICAgICAgIGlmIChpc1BsYXllck9iamVjdCh5dERhdGEpICYmIGlzQWdlUmVzdHJpY3RlZCh5dERhdGEucGxheWFiaWxpdHlTdGF0dXMpKSB7CiAgICAgICAgICAgICAgICB1bmxvY2tSZXNwb25zZSQxKHl0RGF0YSk7CiAgICAgICAgICAgIH0gLy8gUGxheWVyIFVubG9jayAjMjogRW1iZWRkZWQgUGxheWVyIGluaXRhbCBkYXRhIHN0cnVjdHVyZQogICAgICAgICAgICBlbHNlIGlmIChpc0VtYmVkZGVkUGxheWVyT2JqZWN0KHl0RGF0YSkgJiYgaXNBZ2VSZXN0cmljdGVkKHl0RGF0YS5wcmV2aWV3UGxheWFiaWxpdHlTdGF0dXMpKSB7CiAgICAgICAgICAgICAgICB1bmxvY2tSZXNwb25zZSQxKHl0RGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgZXJyb3IoZXJyLCAnVmlkZW8gdW5sb2NrIGZhaWxlZCcpOwogICAgICAgIH0KCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gVW5sb2NrIHNpZGViYXIgd2F0Y2ggbmV4dCBmZWVkIChzaWRlYmFyKSBhbmQgdmlkZW8gZGVzY3JpcHRpb24KICAgICAgICAgICAgaWYgKGlzV2F0Y2hOZXh0T2JqZWN0KHl0RGF0YSkgJiYgaXNXYXRjaE5leHRTaWRlYmFyRW1wdHkoeXREYXRhKSkgewogICAgICAgICAgICAgICAgdW5sb2NrUmVzcG9uc2UoeXREYXRhKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gTW9iaWxlIHZlcnNpb24KICAgICAgICAgICAgaWYgKGlzV2F0Y2hOZXh0T2JqZWN0KHl0RGF0YS5yZXNwb25zZSkgJiYgaXNXYXRjaE5leHRTaWRlYmFyRW1wdHkoeXREYXRhLnJlc3BvbnNlKSkgewogICAgICAgICAgICAgICAgdW5sb2NrUmVzcG9uc2UoeXREYXRhLnJlc3BvbnNlKTsKICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICBlcnJvcihlcnIsICdTaWRlYmFyIHVubG9jayBmYWlsZWQnKTsKICAgICAgICB9CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIFVubG9jayBibHVycnkgdmlkZW8gdGh1bWJuYWlscyBpbiBzZWFyY2ggcmVzdWx0cwogICAgICAgICAgICBpZiAoaXNTZWFyY2hSZXN1bHQoeXREYXRhKSkgewogICAgICAgICAgICAgICAgcHJvY2Vzc1RodW1ibmFpbHMoeXREYXRhKTsKICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICBlcnJvcihlcnIsICdUaHVtYm5haWwgdW5sb2NrIGZhaWxlZCcpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHl0RGF0YTsKICAgIH0KfSkoKTsK"},{"name":"Bypass Paywalls","options":{"check_for_updates":true,"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_powerful_this":null,"sandbox":null,"noframes":null,"unwrap":null,"run_at":null,"tab_types":null,"override":{"use_includes":[],"orig_includes":[],"merge_includes":true,"use_matches":[],"orig_matches":["*://*.adweek.com/*","*://*.ad.nl/*","*://*.americanbanker.com/*","*://*.ambito.com/*","*://*.baltimoresun.com/*","*://*.barrons.com/*","*://*.bloombergquint.com/*","*://*.bloomberg.com/*","*://*.bndestem.nl/*","*://*.bostonglobe.com/*","*://*.bd.nl/*","*://*.brisbanetimes.com.au/*","*://*.businessinsider.com/*","*://*.caixinglobal.com/*","*://*.centralwesterndaily.com.au/*","*://*.acs.org/*","*://*.chicagotribune.com/*","*://*.corriere.it/*","*://*.chicagobusiness.com/*","*://*.dailypress.com/*","*://*.gelderlander.nl/*","*://*.groene.nl/*","*://*.destentor.nl/*","*://*.speld.nl/*","*://*.tijd.be/*","*://*.volkskrant.nl/*","*://*.demorgen.be/*","*://*.denverpost.com/*","*://*.df.cl/*","*://*.editorialedomani.it/*","*://*.dynamed.com/*","*://*.ed.nl/*","*://*.elmercurio.com/*","*://*.elpais.com/*","*://*.elperiodico.com/*","*://*.elu24.ee/*","*://*.britannica.com/*","*://*.estadao.com.br/*","*://*.examiner.com.au/*","*://*.expansion.com/*","*://*.fnlondon.com/*","*://*.financialpost.com/*","*://*.ft.com/*","*://*.firstthings.com/*","*://*.foreignpolicy.com/*","*://*.fortune.com/*","*://*.genomeweb.com/*","*://*.glassdoor.com/*","*://*.globes.co.il/*","*://*.grubstreet.com/*","*://*.haaretz.co.il/*","*://*.haaretz.com/*","*://*.handelsblatt.com/*","*://*.harpers.org/*","*://*.courant.com/*","*://*.hbr.org/*","*://*.heraldsun.com.au/*","*://*.fd.nl/*","*://*.historyextra.com/*","*://*.humo.be/*","*://*.ilmanifesto.it/*","*://*.inc.com/*","*://*.interest.co.nz/*","*://*.investorschronicle.co.uk/*","*://*.lecho.be/*","*://*.labusinessjournal.com/*","*://*.lanacion.com.ar/*","*://*.repubblica.it/*","*://*.lastampa.it/*","*://*.latercera.com/*","*://*.lavoixdunord.fr/*","*://*.ledevoir.com/*","*://*.leparisien.fr/*","*://*.lesechos.fr/*","*://*.loebclassics.com/*","*://*.lrb.co.uk/*","*://*.latimes.com/*","*://*.mit.edu/*","*://*.technologyreview.com/*","*://*.medium.com/*","*://*.medscape.com/*","*://*.mexiconewsdaily.com/*","*://*.mv-voice.com/*","*://*.nationalgeographic.com/*","*://*.nydailynews.com/*","*://*.nrc.nl/*","*://*.ntnews.com.au/*","*://*.nationalpost.com/*","*://*.nzz.ch/*","*://*.nymag.com/*","*://*.nzherald.co.nz/*","*://*.ocregister.com/*","*://*.orlandosentinel.com/*","*://*.pzc.nl/*","*://*.paloaltoonline.com/*","*://*.parool.nl/*","*://*.postimees.ee/*","*://*.qz.com/*","*://*.quora.com/*","*://*.gelocal.it/*","*://*.republic.ru/*","*://*.reuters.com/*","*://*.sandiegouniontribune.com/*","*://*.sfchronicle.com/*","*://*.scientificamerican.com/*","*://*.seekingalpha.com/*","*://*.slate.com/*","*://*.sofrep.com/*","*://*.statista.com/*","*://*.startribune.com/*","*://*.stuff.co.nz/*","*://*.sun-sentinel.com/*","*://*.techinasia.com/*","*://*.telegraaf.nl/*","*://*.adelaidenow.com.au/*","*://*.theadvocate.com.au/*","*://*.theage.com.au/*","*://*.the-american-interest.com/*","*://*.theathletic.com/*","*://*.theathletic.co.uk/*","*://*.theatlantic.com/*","*://*.afr.com/*","*://*.theaustralian.com.au/*","*://*.bizjournals.com/*","*://*.canberratimes.com.au/*","*://*.thecourier.com.au/*","*://*.couriermail.com.au/*","*://*.thecut.com/*","*://*.dailytelegraph.com.au/*","*://*.thediplomat.com/*","*://*.economist.com/*","*://*.theglobeandmail.com/*","*://*.theherald.com.au/*","*://*.thehindu.com/*","*://*.irishtimes.com/*","*://*.kansascity.com/*","*://*.mercurynews.com/*","*://*.themercury.com.au/*","*://*.mcall.com/*","*://*.thenation.com/*","*://*.thenational.scot/*","*://*.newstatesman.com/*","*://*.nytimes.com/*","*://*.newyorker.com/*","*://*.news-gazette.com/*","*://*.theolivepress.es/*","*://*.inquirer.com/*","*://*.thesaturdaypaper.com.au/*","*://*.seattletimes.com/*","*://*.spectator.com.au/*","*://*.spectator.co.uk/*","*://*.smh.com.au/*","*://*.telegraph.co.uk/*","*://*.thestar.com/*","*://*.wsj.com/*","*://*.washingtonpost.com/*","*://*.thewrap.com/*","*://*.themarker.com/*","*://*.the-tls.co.uk/*","*://*.towardsdatascience.com/*","*://*.trouw.nl/*","*://*.tubantia.nl/*","*://*.vanityfair.com/*","*://*.vn.nl/*","*://*.vulture.com/*","*://*.journalnow.com/*","*://*.wired.com/*","*://*.worldpoliticsreview.com/*","*://*.zeit.de/*"],"merge_matches":true,"use_excludes":[],"orig_excludes":[],"merge_excludes":true,"use_connects":[],"orig_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-end","orig_noframes":null},"user_modified":null},"storage":{"ts":1700733540004,"data":{}},"enabled":true,"position":2,"file_url":"https://github.com/LegeBeker/bypass-paywalls-tampermonkey/raw/master/bypass-paywalls-tampermonkey.user.js","uuid":"e2111df3-fd9e-4fcf-8bc9-6b64f6cb4e46","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICBCeXBhc3MgUGF5d2FsbHMKLy8gQGRlc2NyaXB0aW9uICBBIHdheSB0byBieXBhc3MgcGF5d2FsbHMgZm9yIHBvcHVsYXIgbmV3cyBzaXRlcwovLyBAYXV0aG9yICAgICAgIExlZ2VCZWtlciAoaHR0cHM6Ly9naXRodWIuY29tL0xlZ2VCZWtlciksIChGb3JrIGZyb20gaHR0cHM6Ly9naXRodWIuY29tL2lhbWFkYW1kZXYvYnlwYXNzLXBheXdhbGxzLWNocm9tZSkKLy8gQG5hbWVzcGFjZSAgICBodHRwczovL2dpdGh1Yi5jb20vTGVnZUJla2VyL2J5cGFzcy1wYXl3YWxscy10YW1wZXJtb25rZXkvCi8vIEBzdXBwb3J0VVJMICAgaHR0cHM6Ly9naXRodWIuY29tL0xlZ2VCZWtlci9ieXBhc3MtcGF5d2FsbHMtdGFtcGVybW9ua2V5L2lzc3VlcwovLyBAdXBkYXRlVVJMICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9MZWdlQmVrZXIvYnlwYXNzLXBheXdhbGxzLXRhbXBlcm1vbmtleS9yYXcvbWFzdGVyL2J5cGFzcy1wYXl3YWxscy10YW1wZXJtb25rZXkudXNlci5qcwovLyBAZG93bmxvYWRVUkwgIGh0dHBzOi8vZ2l0aHViLmNvbS9MZWdlQmVrZXIvYnlwYXNzLXBheXdhbGxzLXRhbXBlcm1vbmtleS9yYXcvbWFzdGVyL2J5cGFzcy1wYXl3YWxscy10YW1wZXJtb25rZXkudXNlci5qcwovLyBAaWNvbiAgICAgICAgIGRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBSUFBQUFDQUNBUUFBQUJwTjZsQUFBQUFCR2RCVFVFQUFMR1BDL3hoQlFBQUFDQmpTRkpOQUFCNkpnQUFnSVFBQVBvQUFBQ0E2QUFBZFRBQUFPcGdBQUE2bUFBQUYzQ2N1bEU4QUFBQUFtSkxSMFFBLzRlUHpMOEFBQUFKY0VoWmN3QUFDeE1BQUFzVEFRQ2FuQmdBQUFBSGRFbE5SUWZrQmhBUExBTTFQQ3dpQUFBQlowbEVRVlI0MnUzYVBVb0RVUmlHMGJzQlU2VzJVS0xyTVFvV3JrSVkzWXU5SU5oYUJsZGlkQk5HckpMWFFoUzlNWVU0Z3VNOVR6a3pDZHlUK2ZsSVVvb2tTWklrU1ZKVi9ua0FBQUFBQUFCQXl3QzlpdzFzcmdFQUFBQUFBQUFBYkY3Z2QvZjNQWm45OXZzQkFBQUFBQUFBQVBvRCtQRmdNdlJCQ0FBQUFBQUFBQURRRzBEemd4QUFBQUFBQUFEZyt3Q1RJQUFBQUFBQUFPRC9BWDRaQWdBQUFBQUFBUDRRd05BQ0FBQUFBQUFBQUJpRUFBQUFBQUFBQUFBR0lRQUFtZ2RZVkZ1MlBoMCtxdll1QnI3OGVqMlBKZmZWcG9OUEx6aXM5ajRNSEtCZXo3emt0dDZVOGZ2aDQ4eXJ2VGVEWHY3NmVtWWw1MnVQem5tbUdXV1V3N1d6SXprZDhNbi8xWHE2a3YyczBtckxURW9wdVdvVzRQTDE1TmpOVTVQTFgyVG43ZnFZTm5nWnJITDg4Ulp4MWhqQktsMTlsenhxNkVKNHpzbFhENHJ0WEdUWndHZC9uZDNOVDh1OWRKbmxibTFBL2crM3ZMdk0wbVZTSkVtU0pFbVNKRWxTbzcwQXFnQUpBRE9ZbGZRQUFBQWxkRVZZZEdSaGRHVTZZM0psWVhSbEFESXdNakF0TURZdE1UWlVNVFU2TkRNNk5UY3JNREE2TURBVC9tVklBQUFBSlhSRldIUmtZWFJsT20xdlpHbG1lUUF5TURJd0xUQTJMVEUyVkRFMU9qUXpPalUzS3pBd09qQXdZcVBkOUFBQUFBQkpSVTVFcmtKZ2dnPT0KLy8gQHJ1bi1hdCAgICAgICBkb2N1bWVudC1lbmQKLy8gQHZlcnNpb24gICAgICAwLjEuMgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLmFkd2Vlay5jb20vKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLmFkLm5sLyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi5hbWVyaWNhbmJhbmtlci5jb20vKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLmFtYml0by5jb20vKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLmJhbHRpbW9yZXN1bi5jb20vKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLmJhcnJvbnMuY29tLyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi5ibG9vbWJlcmdxdWludC5jb20vKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLmJsb29tYmVyZy5jb20vKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLmJuZGVzdGVtLm5sLyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi5ib3N0b25nbG9iZS5jb20vKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLmJkLm5sLyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi5icmlzYmFuZXRpbWVzLmNvbS5hdS8qCi8vIEBtYXRjaCAgICAgICAgKjovLyouYnVzaW5lc3NpbnNpZGVyLmNvbS8qCi8vIEBtYXRjaCAgICAgICAgKjovLyouY2FpeGluZ2xvYmFsLmNvbS8qCi8vIEBtYXRjaCAgICAgICAgKjovLyouY2VudHJhbHdlc3Rlcm5kYWlseS5jb20uYXUvKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLmFjcy5vcmcvKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLmNoaWNhZ290cmlidW5lLmNvbS8qCi8vIEBtYXRjaCAgICAgICAgKjovLyouY29ycmllcmUuaXQvKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLmNoaWNhZ29idXNpbmVzcy5jb20vKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLmRhaWx5cHJlc3MuY29tLyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi5nZWxkZXJsYW5kZXIubmwvKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLmdyb2VuZS5ubC8qCi8vIEBtYXRjaCAgICAgICAgKjovLyouZGVzdGVudG9yLm5sLyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi5zcGVsZC5ubC8qCi8vIEBtYXRjaCAgICAgICAgKjovLyoudGlqZC5iZS8qCi8vIEBtYXRjaCAgICAgICAgKjovLyoudm9sa3NrcmFudC5ubC8qCi8vIEBtYXRjaCAgICAgICAgKjovLyouZGVtb3JnZW4uYmUvKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLmRlbnZlcnBvc3QuY29tLyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi5kZi5jbC8qCi8vIEBtYXRjaCAgICAgICAgKjovLyouZWRpdG9yaWFsZWRvbWFuaS5pdC8qCi8vIEBtYXRjaCAgICAgICAgKjovLyouZHluYW1lZC5jb20vKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLmVkLm5sLyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi5lbG1lcmN1cmlvLmNvbS8qCi8vIEBtYXRjaCAgICAgICAgKjovLyouZWxwYWlzLmNvbS8qCi8vIEBtYXRjaCAgICAgICAgKjovLyouZWxwZXJpb2RpY28uY29tLyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi5lbHUyNC5lZS8qCi8vIEBtYXRjaCAgICAgICAgKjovLyouYnJpdGFubmljYS5jb20vKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLmVzdGFkYW8uY29tLmJyLyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi5leGFtaW5lci5jb20uYXUvKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLmV4cGFuc2lvbi5jb20vKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLmZubG9uZG9uLmNvbS8qCi8vIEBtYXRjaCAgICAgICAgKjovLyouZmluYW5jaWFscG9zdC5jb20vKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLmZ0LmNvbS8qCi8vIEBtYXRjaCAgICAgICAgKjovLyouZmlyc3R0aGluZ3MuY29tLyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi5mb3JlaWducG9saWN5LmNvbS8qCi8vIEBtYXRjaCAgICAgICAgKjovLyouZm9ydHVuZS5jb20vKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLmdlbm9tZXdlYi5jb20vKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLmdsYXNzZG9vci5jb20vKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLmdsb2Jlcy5jby5pbC8qCi8vIEBtYXRjaCAgICAgICAgKjovLyouZ3J1YnN0cmVldC5jb20vKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLmhhYXJldHouY28uaWwvKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLmhhYXJldHouY29tLyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi5oYW5kZWxzYmxhdHQuY29tLyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi5oYXJwZXJzLm9yZy8qCi8vIEBtYXRjaCAgICAgICAgKjovLyouY291cmFudC5jb20vKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLmhici5vcmcvKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLmhlcmFsZHN1bi5jb20uYXUvKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLmZkLm5sLyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi5oaXN0b3J5ZXh0cmEuY29tLyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi5odW1vLmJlLyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi5pbG1hbmlmZXN0by5pdC8qCi8vIEBtYXRjaCAgICAgICAgKjovLyouaW5jLmNvbS8qCi8vIEBtYXRjaCAgICAgICAgKjovLyouaW50ZXJlc3QuY28ubnovKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLmludmVzdG9yc2Nocm9uaWNsZS5jby51ay8qCi8vIEBtYXRjaCAgICAgICAgKjovLyoubGVjaG8uYmUvKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLmxhYnVzaW5lc3Nqb3VybmFsLmNvbS8qCi8vIEBtYXRjaCAgICAgICAgKjovLyoubGFuYWNpb24uY29tLmFyLyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi5yZXB1YmJsaWNhLml0LyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi5sYXN0YW1wYS5pdC8qCi8vIEBtYXRjaCAgICAgICAgKjovLyoubGF0ZXJjZXJhLmNvbS8qCi8vIEBtYXRjaCAgICAgICAgKjovLyoubGF2b2l4ZHVub3JkLmZyLyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi5sZWRldm9pci5jb20vKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLmxlcGFyaXNpZW4uZnIvKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLmxlc2VjaG9zLmZyLyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi5sb2ViY2xhc3NpY3MuY29tLyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi5scmIuY28udWsvKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLmxhdGltZXMuY29tLyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi5taXQuZWR1LyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi50ZWNobm9sb2d5cmV2aWV3LmNvbS8qCi8vIEBtYXRjaCAgICAgICAgKjovLyoubWVkaXVtLmNvbS8qCi8vIEBtYXRjaCAgICAgICAgKjovLyoubWVkc2NhcGUuY29tLyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi5tZXhpY29uZXdzZGFpbHkuY29tLyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi5tdi12b2ljZS5jb20vKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLm5hdGlvbmFsZ2VvZ3JhcGhpYy5jb20vKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLm55ZGFpbHluZXdzLmNvbS8qCi8vIEBtYXRjaCAgICAgICAgKjovLyoubnJjLm5sLyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi5udG5ld3MuY29tLmF1LyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi5uYXRpb25hbHBvc3QuY29tLyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi5uenouY2gvKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLm55bWFnLmNvbS8qCi8vIEBtYXRjaCAgICAgICAgKjovLyoubnpoZXJhbGQuY28ubnovKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLm9jcmVnaXN0ZXIuY29tLyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi5vcmxhbmRvc2VudGluZWwuY29tLyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi5wemMubmwvKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLnBhbG9hbHRvb25saW5lLmNvbS8qCi8vIEBtYXRjaCAgICAgICAgKjovLyoucGFyb29sLm5sLyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi5wb3N0aW1lZXMuZWUvKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLnF6LmNvbS8qCi8vIEBtYXRjaCAgICAgICAgKjovLyoucXVvcmEuY29tLyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi5nZWxvY2FsLml0LyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi5yZXB1YmxpYy5ydS8qCi8vIEBtYXRjaCAgICAgICAgKjovLyoucmV1dGVycy5jb20vKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLnNhbmRpZWdvdW5pb250cmlidW5lLmNvbS8qCi8vIEBtYXRjaCAgICAgICAgKjovLyouc2ZjaHJvbmljbGUuY29tLyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi5zY2llbnRpZmljYW1lcmljYW4uY29tLyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi5zZWVraW5nYWxwaGEuY29tLyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi5zbGF0ZS5jb20vKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLnNvZnJlcC5jb20vKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLnN0YXRpc3RhLmNvbS8qCi8vIEBtYXRjaCAgICAgICAgKjovLyouc3RhcnRyaWJ1bmUuY29tLyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi5zdHVmZi5jby5uei8qCi8vIEBtYXRjaCAgICAgICAgKjovLyouc3VuLXNlbnRpbmVsLmNvbS8qCi8vIEBtYXRjaCAgICAgICAgKjovLyoudGVjaGluYXNpYS5jb20vKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLnRlbGVncmFhZi5ubC8qCi8vIEBtYXRjaCAgICAgICAgKjovLyouYWRlbGFpZGVub3cuY29tLmF1LyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi50aGVhZHZvY2F0ZS5jb20uYXUvKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLnRoZWFnZS5jb20uYXUvKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLnRoZS1hbWVyaWNhbi1pbnRlcmVzdC5jb20vKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLnRoZWF0aGxldGljLmNvbS8qCi8vIEBtYXRjaCAgICAgICAgKjovLyoudGhlYXRobGV0aWMuY28udWsvKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLnRoZWF0bGFudGljLmNvbS8qCi8vIEBtYXRjaCAgICAgICAgKjovLyouYWZyLmNvbS8qCi8vIEBtYXRjaCAgICAgICAgKjovLyoudGhlYXVzdHJhbGlhbi5jb20uYXUvKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLmJpempvdXJuYWxzLmNvbS8qCi8vIEBtYXRjaCAgICAgICAgKjovLyouY2FuYmVycmF0aW1lcy5jb20uYXUvKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLnRoZWNvdXJpZXIuY29tLmF1LyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi5jb3VyaWVybWFpbC5jb20uYXUvKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLnRoZWN1dC5jb20vKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLmRhaWx5dGVsZWdyYXBoLmNvbS5hdS8qCi8vIEBtYXRjaCAgICAgICAgKjovLyoudGhlZGlwbG9tYXQuY29tLyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi5lY29ub21pc3QuY29tLyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi50aGVnbG9iZWFuZG1haWwuY29tLyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi50aGVoZXJhbGQuY29tLmF1LyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi50aGVoaW5kdS5jb20vKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLmlyaXNodGltZXMuY29tLyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi5rYW5zYXNjaXR5LmNvbS8qCi8vIEBtYXRjaCAgICAgICAgKjovLyoubWVyY3VyeW5ld3MuY29tLyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi50aGVtZXJjdXJ5LmNvbS5hdS8qCi8vIEBtYXRjaCAgICAgICAgKjovLyoubWNhbGwuY29tLyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi50aGVuYXRpb24uY29tLyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi50aGVuYXRpb25hbC5zY290LyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi5uZXdzdGF0ZXNtYW4uY29tLyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi5ueXRpbWVzLmNvbS8qCi8vIEBtYXRjaCAgICAgICAgKjovLyoubmV3eW9ya2VyLmNvbS8qCi8vIEBtYXRjaCAgICAgICAgKjovLyoubmV3cy1nYXpldHRlLmNvbS8qCi8vIEBtYXRjaCAgICAgICAgKjovLyoudGhlb2xpdmVwcmVzcy5lcy8qCi8vIEBtYXRjaCAgICAgICAgKjovLyouaW5xdWlyZXIuY29tLyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi50aGVzYXR1cmRheXBhcGVyLmNvbS5hdS8qCi8vIEBtYXRjaCAgICAgICAgKjovLyouc2VhdHRsZXRpbWVzLmNvbS8qCi8vIEBtYXRjaCAgICAgICAgKjovLyouc3BlY3RhdG9yLmNvbS5hdS8qCi8vIEBtYXRjaCAgICAgICAgKjovLyouc3BlY3RhdG9yLmNvLnVrLyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi5zbWguY29tLmF1LyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi50ZWxlZ3JhcGguY28udWsvKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLnRoZXN0YXIuY29tLyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi53c2ouY29tLyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi53YXNoaW5ndG9ucG9zdC5jb20vKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLnRoZXdyYXAuY29tLyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi50aGVtYXJrZXIuY29tLyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi50aGUtdGxzLmNvLnVrLyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi50b3dhcmRzZGF0YXNjaWVuY2UuY29tLyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi50cm91dy5ubC8qCi8vIEBtYXRjaCAgICAgICAgKjovLyoudHViYW50aWEubmwvKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLnZhbml0eWZhaXIuY29tLyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi52bi5ubC8qCi8vIEBtYXRjaCAgICAgICAgKjovLyoudnVsdHVyZS5jb20vKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLmpvdXJuYWxub3cuY29tLyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi53aXJlZC5jb20vKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLndvcmxkcG9saXRpY3NyZXZpZXcuY29tLyoKLy8gQG1hdGNoICAgICAgICAqOi8vKi56ZWl0LmRlLyoKLy8gPT0vVXNlclNjcmlwdD09CgooZnVuY3Rpb24gKCkgewogICAgJ3VzZSBzdHJpY3QnOwoKICAgIGlmICghbWF0Y2hEb21haW4oWydzZWVraW5nYWxwaGEuY29tJywgJ3NmY2hyb25pY2xlLmNvbScsICdjZW4uYWNzLm9yZycsICdlbG11bmRvLmVzJywgJ3NjbXAuY29tJywgJ255dGltZXMuY29tJ10pKSB7CiAgICAgICAgd2luZG93LmxvY2FsU3RvcmFnZS5jbGVhcigpOwogICAgfQoKICAgIGlmIChtYXRjaERvbWFpbignZWxtZXJjdXJpby5jb20nKSkgewogICAgICAgIGlmICh3aW5kb3cubG9jYXRpb24uaHJlZi50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKCcvaW52ZXJzaW9uZXMvJykpIHsKICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsICgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IHBheXdhbGwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjbW9kYWxfbGltaXRfYXJ0aWN1bG9zJyk7CiAgICAgICAgICAgICAgICBjb25zdCBib2R5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYm9keScpOwogICAgICAgICAgICAgICAgcmVtb3ZlRE9NRWxlbWVudChwYXl3YWxsKTsKICAgICAgICAgICAgICAgIGlmIChib2R5Lmhhc0F0dHJpYnV0ZSgnY2xhc3MnKSkgeyBib2R5LnJlbW92ZUF0dHJpYnV0ZSgnY2xhc3MnKTsgfQogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9IGVsc2UgaWYgKG1hdGNoRG9tYWluKCdlc3RhZGFvLmNvbS5icicpKSB7CiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGNvbnN0IHBheXdhbGwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjcGF5d2FsbC13cmFwcGVyLWlmcmFtZS1lc3RhZGFvJyk7CiAgICAgICAgICAgIGNvbnN0IGJvZHkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdodG1sJyk7CgogICAgICAgICAgICByZW1vdmVET01FbGVtZW50KHBheXdhbGwpOwogICAgICAgICAgICBib2R5LnJlbW92ZUF0dHJpYnV0ZSgnc3R5bGUnKTsKICAgICAgICB9LCAzMDApOyAvLyBEZWxheSAoaW4gbWlsbGlzZWNvbmRzKQogICAgfSBlbHNlIGlmIChtYXRjaERvbWFpbigncmVwLnJlcHViYmxpY2EuaXQnKSkgewogICAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaWYgKHdpbmRvdy5sb2NhdGlvbi5ocmVmLmluY2x1ZGVzKCcvcHdhLycpKSB7CiAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmLnJlcGxhY2UoJy9wd2EvJywgJy93cy9kZXRhaWwvJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCA1MDApOwogICAgICAgIGlmICh3aW5kb3cubG9jYXRpb24uaHJlZi5pbmNsdWRlcygnL3dzL2RldGFpbC8nKSkgewogICAgICAgICAgICBjb25zdCBwYXl3YWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBheXdhbGwnKTsKICAgICAgICAgICAgaWYgKHBheXdhbGwpIHsKICAgICAgICAgICAgICAgIGFtcFVuaGlkZVN1YnNjcmlwdGlvbnNTZWN0aW9uKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKG1hdGNoRG9tYWluKCdhbWVyaWNhbmJhbmtlci5jb20nKSkgewogICAgICAgIGNvbnN0IGlubGluZUdhdGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuaW5saW5lLWdhdGUnKTsKICAgICAgICBpZiAoaW5saW5lR2F0ZSkgewogICAgICAgICAgICBpbmxpbmVHYXRlLmNsYXNzTGlzdC5yZW1vdmUoJ2lubGluZS1nYXRlJyk7CiAgICAgICAgICAgIGNvbnN0IGlubGluZUdhdGVkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmlubGluZS1nYXRlZCcpOwogICAgICAgICAgICBmb3IgKGNvbnN0IGVsZW0gb2YgaW5saW5lR2F0ZWQpIHsgZWxlbS5jbGFzc0xpc3QucmVtb3ZlKCdpbmxpbmUtZ2F0ZWQnKTsgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAobWF0Y2hEb21haW4oJ3RlbGVncmFhZi5ubCcpKSB7CiAgICAgICAgaWYgKHdpbmRvdy5sb2NhdGlvbi5ocmVmLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vd3d3LnRlbGVncmFhZi5ubC9lcnJvcj9yZWY9LycpKSB7CiAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gd2luZG93LmxvY2F0aW9uLmhyZWYuc3BsaXQoJyYnKVswXS5yZXBsYWNlKCdlcnJvcj9yZWY9LycsICcnKTsKICAgICAgICB9CiAgICAgICAgY29uc3QgYXJ0aWNsZVdyYXBwZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuQXJ0aWNsZVBhZ2VXcmFwcGVyX191aWQnKTsKICAgICAgICBjb25zdCBzcG90WEJhbm5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5BcnRpY2xlQm9keUJsb2Nrc19faW5saW5lQXJ0aWNsZVNwb3RYQmFubmVyJyk7CiAgICAgICAgY29uc3QgcGF5d2FsbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5Qb3B1cEJhY2tkcm9wX19ibG9jaycpOwogICAgICAgIHJlbW92ZURPTUVsZW1lbnQoc3BvdFhCYW5uZXIsIHBheXdhbGwpOwogICAgICAgIGNvbnN0IHByZW1pdW0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuUHJlbWl1bUxhYmVsV2l0aExpbmVfX2JvZHknKTsKICAgICAgICBjb25zdCBhcnRpY2xlSWQgPSBhcnRpY2xlV3JhcHBlciA/IGFydGljbGVXcmFwcGVyLmlubmVyVGV4dCA6ICcxMjMnOwogICAgICAgIGNvbnN0IGFydGljbGVCb2R5RG9uZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNhcnRpY2xlQm9keScgKyBhcnRpY2xlSWQpOwogICAgICAgIGlmIChwcmVtaXVtICYmICFhcnRpY2xlQm9keURvbmUpIHsKICAgICAgICAgICAgY29uc3QgYXJ0aWNsZUJvZHlPbGQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbaWRePWFydGljbGVCb2R5XScpOwogICAgICAgICAgICByZW1vdmVET01FbGVtZW50KGFydGljbGVCb2R5T2xkKTsKICAgICAgICAgICAgY29uc3QganNvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ3NjcmlwdFt0eXBlPSJhcHBsaWNhdGlvbi9sZCtqc29uIl1bZGF0YS1yZWFjdC1oZWxtZXQ9InRydWUiXScpOwogICAgICAgICAgICBpZiAoanNvbikgewogICAgICAgICAgICAgICAgY29uc3QganNvblRleHQgPSBKU09OLnBhcnNlKGpzb24udGV4dCkuYXJ0aWNsZUJvZHk7CiAgICAgICAgICAgICAgICBjb25zdCBhcnRpY2xlQm9keSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ3NlY3Rpb24uVGV4dEFydGljbGVQYWdlX19ib2R5VGV4dCcpOwogICAgICAgICAgICAgICAgaWYgKGFydGljbGVCb2R5KSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGl2TWFpbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgICAgICAgICAgICAgIGRpdk1haW4uc2V0QXR0cmlidXRlKCdpZCcsICdhcnRpY2xlQm9keScgKyBhcnRpY2xlSWQpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRpdkVsZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICAgICAgICAgICAgICBkaXZFbGVtLnNldEF0dHJpYnV0ZSgnZGF0YS1lbGVtZW50JywgJ2FydGljbGVCb2R5QmxvY2tzJyk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGV4dEFycmF5ID0ganNvblRleHQuc3BsaXQoJ1xuXG4nKTsKICAgICAgICAgICAgICAgICAgICB0ZXh0QXJyYXkuZm9yRWFjaChwVGV4dCA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHBEaXYuc2V0QXR0cmlidXRlKCdjbGFzcycsICdBcnRpY2xlQm9keUJsb2Nrc19fcGFyYWdyYXBoIEFydGljbGVCb2R5QmxvY2tzX19wYXJhZ3JhcGgtLW5pZXV3cycpOwogICAgICAgICAgICAgICAgICAgICAgICBwRGl2LmlubmVyVGV4dCA9IHBUZXh0OwogICAgICAgICAgICAgICAgICAgICAgICBkaXZFbGVtLmFwcGVuZENoaWxkKHBEaXYpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGRpdk1haW4uYXBwZW5kQ2hpbGQoZGl2RWxlbSk7CiAgICAgICAgICAgICAgICAgICAgYXJ0aWNsZUJvZHkuYXBwZW5kQ2hpbGQoZGl2TWFpbik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKG1hdGNoRG9tYWluKCducmMubmwnKSkgewogICAgICAgIGNvbnN0IHBheXdhbGwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucGF5d2FsbC0tdG9wYmFubmVyJyk7CiAgICAgICAgcmVtb3ZlRE9NRWxlbWVudChwYXl3YWxsKTsKICAgIH0gZWxzZSBpZiAobWF0Y2hEb21haW4oJ3dhc2hpbmd0b25wb3N0LmNvbScpKSB7CiAgICAgICAgY29uc3QgbGVhZGVyYm9hcmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjbGVhZGVyYm9hcmQtd3JhcHBlcicpOwogICAgICAgIGNvbnN0IGFkdmVydHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdkaXZbZGF0YS1xYT0iYXJ0aWNsZS1ib2R5LWFkIl0nKTsKICAgICAgICBjb25zdCBzb2Z0d2FsbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tpZF49InNvZnR3YWxsIl0nKTsKICAgICAgICByZW1vdmVET01FbGVtZW50KGxlYWRlcmJvYXJkLCBzb2Z0d2FsbCwgLi4uYWR2ZXJ0cyk7CiAgICAgICAgaWYgKHdpbmRvdy5sb2NhdGlvbi5ocmVmLmluY2x1ZGVzKCcvZ2Rwci1jb25zZW50LycpKSB7CiAgICAgICAgICAgIGNvbnN0IGZyZWVCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZ2Rwci1jb25zZW50LWNvbnRhaW5lciAuY29udGludWUtYnRuLmJ1dHRvbi5mcmVlJyk7CiAgICAgICAgICAgIGlmIChmcmVlQnV0dG9uKSB7IGZyZWVCdXR0b24uY2xpY2soKTsgfQogICAgICAgICAgICB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBjb25zdCBnZHByY2hlY2tib3ggPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZ2Rwci1jb25zZW50LWNvbnRhaW5lciAuY29uc2VudC1wYWdlOm5vdCguaGlkZSkgI2FncmVlJyk7CiAgICAgICAgICAgICAgICBpZiAoZ2RwcmNoZWNrYm94KSB7CiAgICAgICAgICAgICAgICAgICAgZ2RwcmNoZWNrYm94LmNoZWNrZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGdkcHJjaGVja2JveC5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgnY2hhbmdlJykpOwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5nZHByLWNvbnNlbnQtY29udGFpbmVyIC5jb25zZW50LXBhZ2U6bm90KC5oaWRlKSAuY29udGludWUtYnRuLmJ1dHRvbi5hY2NlcHQtY29uc2VudCcpLmNsaWNrKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIDMwMCk7IC8vIERlbGF5IChpbiBtaWxsaXNlY29uZHMpCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29uc3QgdXJsID0gd2luZG93LmxvY2F0aW9uLmhyZWY7CiAgICAgICAgICAgIGZ1bmN0aW9uIG1haW4oZWxlbWVudCkgewogICAgICAgICAgICAgICAgcmVtb3ZlRE9NRWxlbWVudChlbGVtZW50KTsKICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gdXJsLnNwbGl0KCc/JylbMF0gKyAnP291dHB1dFR5cGU9YW1wJzsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIXVybC5pbmNsdWRlcygnb3V0cHV0VHlwZT1hbXAnKSkgewogICAgICAgICAgICAgICAgd2FpdERPTUVsZW1lbnQoJ2RpdltpZF49InBheXdhbGwtIl0nLCAnRElWJywgbWFpbiwgZmFsc2UpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29uc3Qgc3Vic2NyaXB0aW9uc1NlY3Rpb25zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnW3N1YnNjcmlwdGlvbnMtc2VjdGlvbj0iY29udGVudCJdJyk7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHN1YnNjcmlwdGlvbnNTZWN0aW9uIG9mIHN1YnNjcmlwdGlvbnNTZWN0aW9ucykgeyBzdWJzY3JpcHRpb25zU2VjdGlvbi5yZW1vdmVBdHRyaWJ1dGUoJ3N1YnNjcmlwdGlvbnMtc2VjdGlvbicpOyB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKG1hdGNoRG9tYWluKCd3c2ouY29tJykgJiYgIW1hdGNoRG9tYWluKCdjbi53c2ouY29tJykpIHsKICAgICAgICBpZiAod2luZG93LmxvY2F0aW9uLmhyZWYuaW5jbHVkZXMoJy9hcnRpY2xlcy8nKSkgewogICAgICAgICAgICBjb25zdCBjbG9zZUJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2Rpdi5jbG9zZS1idG5bcm9sZT0iYnV0dG9uIl0nKTsKICAgICAgICAgICAgaWYgKGNsb3NlQnV0dG9uKSB7IGNsb3NlQnV0dG9uLmNsaWNrKCk7IH0KICAgICAgICB9CiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsICgpID0+IHsKICAgICAgICAgICAgY29uc3QgdXJsID0gd2luZG93LmxvY2F0aW9uLmhyZWY7CiAgICAgICAgICAgIGNvbnN0IHNuaXBwZXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc25pcHBldC1wcm9tb3Rpb24nKTsKICAgICAgICAgICAgY29uc3Qgd3NqUHJvID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignbWV0YVtuYW1lPSJwYWdlLnNpdGUiXVtjb250ZW50PSJ3c2pwcm8iXScpOwogICAgICAgICAgICBpZiAoc25pcHBldCB8fCB3c2pQcm8pIHsKICAgICAgICAgICAgICAgIGlmICghd2luZG93LmxvY2F0aW9uLmhhc2gpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodXJsLmluY2x1ZGVzKCc/JykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSB1cmwucmVwbGFjZSgnPycsICcjcmVmcmVzaGVkPycpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7IHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gdXJsICsgJyNyZWZyZXNoZWQnOyB9CiAgICAgICAgICAgICAgICB9IGVsc2UgeyB3aW5kb3cubG9jYXRpb24uaHJlZiA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmLnJlcGxhY2UoJ3dzai5jb20nLCAnd3NqLmNvbS9hbXAnKS5yZXBsYWNlKCcjcmVmcmVzaGVkJywgJycpOyB9CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0gZWxzZSBpZiAobWF0Y2hEb21haW4oJ3Nsb2FucmV2aWV3Lm1pdC5lZHUnKSkgewogICAgICAgIGNvbnN0IHJlYWRNb3JlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmJ0bi1yZWFkLW1vcmUnKTsKICAgICAgICBpZiAocmVhZE1vcmUpIHsKICAgICAgICAgICAgcmVhZE1vcmUuY2xpY2soKTsKICAgICAgICB9CiAgICB9IGVsc2UgaWYgKG1hdGNoRG9tYWluKCdtZXhpY29uZXdzZGFpbHkuY29tJykpIHsKICAgICAgICB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGNvbnN0IHBvcHVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignZGl2LnBpZ2Vvbi13aWRnZXQtcHJvbXB0Jyk7CiAgICAgICAgICAgIGNvbnN0IGNwcm9PdmVybGF5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNwcm8tb3ZlcmxheScpOwogICAgICAgICAgICByZW1vdmVET01FbGVtZW50KHBvcHVwLCBjcHJvT3ZlcmxheSk7CiAgICAgICAgfSwgNTAwKTsgLy8gRGVsYXkgKGluIG1pbGxpc2Vjb25kcykKICAgIH0gZWxzZSBpZiAobWF0Y2hEb21haW4oJ3RoZS1hbWVyaWNhbi1pbnRlcmVzdC5jb20nKSkgewogICAgICAgIGNvbnN0IGNvdW50ZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYXJ0aWNsZS1jb3VudGVyJyk7CiAgICAgICAgcmVtb3ZlRE9NRWxlbWVudChjb3VudGVyKTsKICAgIH0gZWxzZSBpZiAobWF0Y2hEb21haW4oJ256aGVyYWxkLmNvLm56JykpIHsKICAgICAgICBjb25zdCBhcnRpY2xlQ29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5hcnRpY2xlX19jb250ZW50Jyk7CiAgICAgICAgaWYgKGFydGljbGVDb250ZW50KSB7CiAgICAgICAgICAgIGNvbnN0IGFydGljbGVPZmZlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5hcnRpY2xlLW9mZmVyJyk7CiAgICAgICAgICAgIGlmIChhcnRpY2xlT2ZmZXIpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGNzc1NlbGVjdG9yID0gYXJ0aWNsZUNvbnRlbnQucXVlcnlTZWxlY3RvckFsbCgncCcpWzVdLmdldEF0dHJpYnV0ZSgnY2xhc3MnKTsKICAgICAgICAgICAgICAgIGNvbnN0IGhpZGRlbk5vdFBhcnMgPSBhcnRpY2xlQ29udGVudC5xdWVyeVNlbGVjdG9yQWxsKCcuJyArIGNzc1NlbGVjdG9yICsgJzpub3QocCknKTsKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgaGlkZGVuTm90UGFyIG9mIGhpZGRlbk5vdFBhcnMpIHsKICAgICAgICAgICAgICAgICAgICBoaWRkZW5Ob3RQYXIuY2xhc3NMaXN0LnJlbW92ZShjc3NTZWxlY3Rvcik7CiAgICAgICAgICAgICAgICAgICAgaGlkZGVuTm90UGFyLnJlbW92ZUF0dHJpYnV0ZSgnc3R5bGUnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvbnN0IGhpZGRlblBhcnMgPSBhcnRpY2xlQ29udGVudC5xdWVyeVNlbGVjdG9yQWxsKCdwLicgKyBjc3NTZWxlY3Rvcik7CiAgICAgICAgICAgICAgICBjb25zdCBwYXJzZXIgPSBuZXcgRE9NUGFyc2VyKCk7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGhpZGRlblBhciBvZiBoaWRkZW5QYXJzKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcGFySHRtbCA9IHBhcnNlci5wYXJzZUZyb21TdHJpbmcoJzxkaXYgc3R5bGU9Im1hcmdpbjogMTBweCAwcHg7IGZvbnQtc2l6ZTogMTdweCI+JyArIGhpZGRlblBhci5pbm5lckhUTUwgKyAnPC9kaXY+JywgJ3RleHQvaHRtbCcpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhckRvbSA9IHBhckh0bWwucXVlcnlTZWxlY3RvcignZGl2Jyk7CiAgICAgICAgICAgICAgICAgICAgYXJ0aWNsZUNvbnRlbnQuaW5zZXJ0QmVmb3JlKHBhckRvbSwgaGlkZGVuUGFyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvbnN0IGZpcnN0U3BhbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ3AgPiBzcGFuJyk7CiAgICAgICAgICAgICAgICBpZiAoZmlyc3RTcGFuKSB7IGZpcnN0U3Bhbi5yZW1vdmVBdHRyaWJ1dGUoJ2NsYXNzJyk7IH0KICAgICAgICAgICAgICAgIHJlbW92ZURPTUVsZW1lbnQoYXJ0aWNsZU9mZmVyKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjb25zdCBwcmVtaXVtVG9hc3RlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNwcmVtaXVtLXRvYXN0ZXInKTsKICAgICAgICByZW1vdmVET01FbGVtZW50KHByZW1pdW1Ub2FzdGVyKTsKICAgIH0gZWxzZSBpZiAobWF0Y2hEb21haW4oJ2ludGVyZXN0LmNvLm56JykpIHsKICAgICAgICBjb25zdCB3cmFwcGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BwLWFibG9jay1iYW5uZXItd3JhcHBlcicpOwogICAgICAgIGNvbnN0IG92ZXJsYXkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYmxhY2stb3ZlcmxheScpOwogICAgICAgIHJlbW92ZURPTUVsZW1lbnQob3ZlcmxheSwgd3JhcHBlcik7CiAgICB9IGVsc2UgaWYgKG1hdGNoRG9tYWluKCdzdHVmZi5jby5ueicpKSB7CiAgICAgICAgY29uc3Qgb3ZlcmxheSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy54MCcpOwogICAgICAgIHJlbW92ZURPTUVsZW1lbnQob3ZlcmxheSk7CiAgICB9IGVsc2UgaWYgKG1hdGNoRG9tYWluKCd0aGVuYXRpb25hbC5zY290JykpIHsKICAgICAgICBjb25zdCBvdmVybGF5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnRlbXBsYXRlLWNvbnRhaW5lcicpOwogICAgICAgIHJlbW92ZURPTUVsZW1lbnQob3ZlcmxheSk7CiAgICB9IGVsc2UgaWYgKG1hdGNoRG9tYWluKCd0aGVzdGFyLmNvbScpKSB7CiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGNvbnN0IHBheXdhbGwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYmFzaWMtcGF5d2FsbC1uZXcnKTsKICAgICAgICAgICAgcmVtb3ZlRE9NRWxlbWVudChwYXl3YWxsKTsKICAgICAgICAgICAgY29uc3QgdGJjID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnRleHQtYmxvY2stY29udGFpbmVyJyk7CiAgICAgICAgICAgIGZvciAoY29uc3QgZWwgb2YgdGJjKSB7CiAgICAgICAgICAgICAgICBlbC5yZW1vdmVBdHRyaWJ1dGUoJ3N0eWxlJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCAxMDAwKTsgLy8gRGVsYXkgKGluIG1pbGxpc2Vjb25kcykKICAgIH0gZWxzZSBpZiAobWF0Y2hEb21haW4oJ2Fmci5jb20nKSkgewogICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCAoKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IGhpZGRlbkltYWdlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnaW1nJyk7CiAgICAgICAgICAgIGZvciAoY29uc3QgaW1hZ2Ugb2YgaGlkZGVuSW1hZ2UpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHNyYyA9IGltYWdlLnNyYzsKICAgICAgICAgICAgICAgIGlmICgnc3JjOiAnICsgc3JjLmluZGV4T2YoJy5naWYnKSAhPT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRhU3JjID0gaW1hZ2UuZ2V0QXR0cmlidXRlKCdkYXRhLXNyYycpOwogICAgICAgICAgICAgICAgICAgIGlmIChkYXRhU3JjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGltYWdlLnNldEF0dHJpYnV0ZSgnc3JjJywgZGF0YVNyYyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IHBsaXN0YSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2RpdltkYXRhLXBsaXN0YS1wbGFjZW1lbnQ9InVuZGVyQXJ0aWNsZV9Hcm91cCJdJyk7CiAgICAgICAgICAgIHJlbW92ZURPTUVsZW1lbnQocGxpc3RhKTsKICAgICAgICB9KTsKICAgIH0gZWxzZSBpZiAobWF0Y2hEb21haW4oWydwYXJvb2wubmwnLCAndHJvdXcubmwnLCAndm9sa3NrcmFudC5ubCcsICdkZW1vcmdlbi5iZScsICdodW1vLmJlJ10pKSB7CiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsICgpID0+IHsKICAgICAgICAgICAgY29uc3QgdG9wQmFubmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignZGl2W2RhdGEtdGVtcHRhdGlvbi1wb3NpdGlvbj0iUEFHRV9UT1AiXScpOwogICAgICAgICAgICBjb25zdCBwYXl3YWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignZGl2W2RhdGEtdGVtcHRhdGlvbi1wb3NpdGlvbj0iQVJUSUNMRV9CT1RUT00iXScpOwogICAgICAgICAgICBjb25zdCBoaWRkZW5TZWN0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignZGl2W2RhdGEtdGVtcHRhdGlvbi1wb3NpdGlvbj0iQVJUSUNMRV9JTkxJTkUiXScpOwogICAgICAgICAgICBjb25zdCBvdmVybGF5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignZGl2W2RhdGEtdGVtcHRhdGlvbi1wb3NpdGlvbj0iUEFHRV9CT1RUT00iXScpOwogICAgICAgICAgICByZW1vdmVET01FbGVtZW50KHRvcEJhbm5lciwgcGF5d2FsbCwgaGlkZGVuU2VjdGlvbiwgb3ZlcmxheSk7CiAgICAgICAgfSk7CiAgICB9IGVsc2UgaWYgKG1hdGNoRG9tYWluKCdmaXJzdHRoaW5ncy5jb20nKSkgewogICAgICAgIGNvbnN0IHBheXdhbGwgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdwYXl3YWxsJylbMF07CiAgICAgICAgcmVtb3ZlRE9NRWxlbWVudChwYXl3YWxsKTsKICAgIH0gZWxzZSBpZiAobWF0Y2hEb21haW4oJ2Jsb29tYmVyZy5jb20nKSkgewogICAgICAgIGJsb2NrRWxlbWVudCgnI2dyYXBoaWNzLXBheXdhbGwtb3ZlcmxheScsIHRydWUpOwogICAgfSBlbHNlIGlmIChtYXRjaERvbWFpbignYmxvb21iZXJncXVpbnQuY29tJykpIHsKICAgICAgICBjb25zdCBhcnRpY2xlc0xlZnRNb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3BheXdhbGwtbWV0ZXItbW9kdWxlX19zdG9yeS1wYXl3YWxsLWNvbnRhaW5lcl9fMVVnQ0UnKVswXTsKICAgICAgICBjb25zdCBwYXl3YWxsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BheXdhbGxEbXAnKTsKICAgICAgICByZW1vdmVET01FbGVtZW50KGFydGljbGVzTGVmdE1vZGFsLCBwYXl3YWxsKTsKICAgIH0gZWxzZSBpZiAobWF0Y2hEb21haW4oJ21lZGl1bS5jb20nKSB8fCBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdzY3JpcHRbc3JjXj0iaHR0cHM6Ly9jZG4tY2xpZW50Lm1lZGl1bS5jb20vIl0nKSkgewogICAgICAgIGNvbnN0IHBheXdhbGwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdkaXYjcGF5d2FsbC1iYWNrZ3JvdW5kLWNvbG9yJyk7CiAgICAgICAgcmVtb3ZlRE9NRWxlbWVudChwYXl3YWxsKTsKICAgICAgICBpZiAocGF5d2FsbCkgewogICAgICAgICAgICBleHRlbnNpb25BcGkucnVudGltZS5zZW5kTWVzc2FnZSh7IHJlcXVlc3Q6ICdyZWZyZXNoQ3VycmVudFRhYicgfSk7CiAgICAgICAgfQogICAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgY29uc3QgbWV0ZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbaWQqPSJoaWdobGlnaHQtbWV0ZXItIl0nKTsKICAgICAgICAgICAgaWYgKG1ldGVyKSB7CiAgICAgICAgICAgICAgICBtZXRlci5oaWRkZW4gPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfSwgNTAwKTsgLy8gRGVsYXkgKGluIG1pbGxpc2Vjb25kcykKICAgIH0gZWxzZSBpZiAobWF0Y2hEb21haW4oJ3RoZWdsb2JlYW5kbWFpbC5jb20nKSkgewogICAgICAgIGNvbnN0IGFydGljbGVCb2R5U3Vic2NyaWJlZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jLWFydGljbGUtYm9keS0tc3Vic2NyaWJlZCcpOwogICAgICAgIGlmIChhcnRpY2xlQm9keVN1YnNjcmliZWQpIHsKICAgICAgICAgICAgYXJ0aWNsZUJvZHlTdWJzY3JpYmVkLnJlbW92ZUF0dHJpYnV0ZSgnY2xhc3MnKTsKICAgICAgICB9CiAgICB9IGVsc2UgaWYgKG1hdGNoRG9tYWluKFsnZXhhbWluZXIuY29tLmF1JywgJ3RoZWNvdXJpZXIuY29tLmF1JywgJ3RoZWFkdm9jYXRlLmNvbS5hdSddKSkgewogICAgICAgIGNvbnN0IHN1YnNjcmliZVRydW5jYXRlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnN1YnNjcmliZS10cnVuY2F0ZScpOwogICAgICAgIGlmIChzdWJzY3JpYmVUcnVuY2F0ZSkgeyBzdWJzY3JpYmVUcnVuY2F0ZS5jbGFzc0xpc3QucmVtb3ZlKCdzdWJzY3JpYmUtdHJ1bmNhdGUnKTsgfQogICAgICAgIGNvbnN0IHN1YnNjcmliZXJIaWRlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5zdWJzY3JpYmVyLWhpZGVyJyk7CiAgICAgICAgZm9yIChjb25zdCBlbCBvZiBzdWJzY3JpYmVySGlkZXIpIHsKICAgICAgICAgICAgZWwuY2xhc3NMaXN0LnJlbW92ZSgnc3Vic2NyaWJlci1oaWRlcicpOwogICAgICAgIH0KICAgIH0gZWxzZSBpZiAobWF0Y2hEb21haW4oJ2NhbmJlcnJhdGltZXMuY29tLmF1JykpIHsKICAgICAgICBjb25zdCBwYXl3YWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnN1YnNjcmliZS1hcnRpY2xlLm5ld3MtYXJ0aWNsZS1ib2R5LmFydGljbGVfX2JvZHknKTsKICAgICAgICBwYXl3YWxsLmNsYXNzTGlzdC5yZW1vdmUoJ3N1YnNjcmliZS1hcnRpY2xlJyk7CiAgICAgICAgY29uc3Qgc3Vic2NyaWJlID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnc3Vic2NyaWJlci1jb250YWluZXInKVswXTsKICAgICAgICByZW1vdmVET01FbGVtZW50KHN1YnNjcmliZSk7CiAgICAgICAgY29uc3QgY29udGVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3N1YnNjcmliZXItaGlkZXInKTsKICAgICAgICBmb3IgKGNvbnN0IGVsIG9mIGNvbnRlbnQpIHsKICAgICAgICAgICAgZWwuY2xhc3NMaXN0LnJlbW92ZSgnc3Vic2NyaWJlci1oaWRlcicpOwogICAgICAgIH0KICAgIH0gZWxzZSBpZiAobWF0Y2hEb21haW4oJ2xlZGV2b2lyLmNvbScpKSB7CiAgICAgICAgY29uc3QgY291bnRlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5mdWxsLmhpZGRlbi1wcmludC5wb3B1cC1tc2cnKTsKICAgICAgICByZW1vdmVET01FbGVtZW50KGNvdW50ZXIpOwogICAgfSBlbHNlIGlmIChtYXRjaERvbWFpbignZnQuY29tJykpIHsKICAgICAgICBjb25zdCBjb29raWVCYW5uZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuby1iYW5uZXJfX291dGVyJyk7CiAgICAgICAgY29uc3QgcmliYm9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmpzLWFydGljbGUtcmliYm9uJyk7CiAgICAgICAgY29uc3QgYWRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm8tYWRzJyk7CiAgICAgICAgcmVtb3ZlRE9NRWxlbWVudChjb29raWVCYW5uZXIsIGFkcywgcmliYm9uKTsKICAgIH0gZWxzZSBpZiAobWF0Y2hEb21haW4oJ3RoZWhpbmR1LmNvbScpKSB7CiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsICgpID0+IHsKICAgICAgICAgICAgY29uc3QgY291bnRlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyN0ZXN0Jyk7CiAgICAgICAgICAgIGNvbnN0IGNvQmFubmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNvLWJhbm5lcicpOwogICAgICAgICAgICBjb25zdCBzdXBwb3J0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignZGl2LnN1cHBvcnQtamxtJyk7CiAgICAgICAgICAgIHJlbW92ZURPTUVsZW1lbnQoY291bnRlciwgY29CYW5uZXIsIHN1cHBvcnQpOwogICAgICAgIH0pOwogICAgfSBlbHNlIGlmIChtYXRjaERvbWFpbignbnl0aW1lcy5jb20nKSkgewogICAgICAgIGNvbnN0IGJhbm5lcnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdkaXZbZGF0YS10ZXN0aWQ9ImlubGluZS1tZXNzYWdlIl0sIGRpdltpZF49ImFkLSJdLCBkaXYuZXhwYW5kZWQtZG9jaywgZGl2LnB6LWFkLWJveCcpOwogICAgICAgIHJlbW92ZURPTUVsZW1lbnQoLi4uYmFubmVycyk7CiAgICB9IGVsc2UgaWYgKG1hdGNoRG9tYWluKCd0ZWNobm9sb2d5cmV2aWV3LmNvbScpKSB7CiAgICAgICAgd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICBjb25zdCBib2R5T2JzY3VyZWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdib2R5W2NsYXNzKj0iYm9keV9fb2JzY3VyZUNvbnRlbnQiXScpOwogICAgICAgICAgICBpZiAoYm9keU9ic2N1cmVkKSB7IHJlbW92ZUNsYXNzZXNCeVByZWZpeChib2R5T2JzY3VyZWQsICdib2R5X19vYnNjdXJlQ29udGVudCcpOyB9CiAgICAgICAgICAgIGNvbnN0IG92ZXJsYXkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdkaXZbY2xhc3MqPSJvdmVybGF5Rm9vdGVyX193cmFwcGVyIl0nKTsKICAgICAgICAgICAgaWYgKG92ZXJsYXkpIHsgb3ZlcmxheS5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywgJ2Rpc3BsYXk6bm9uZScpOyB9CiAgICAgICAgICAgIGNvbnN0IGNvbnRlbnRCb2R5SGlkZGVuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignZGl2W2NsYXNzKj0iY29udGVudEJvZHlfX2NvbnRlbnRIaWRkZW4iXScpOwogICAgICAgICAgICBpZiAoY29udGVudEJvZHlIaWRkZW4pIHsgcmVtb3ZlQ2xhc3Nlc0J5UHJlZml4KGNvbnRlbnRCb2R5SGlkZGVuLCAnY29udGVudEJvZHlfX2NvbnRlbnRIaWRkZW4nKTsgfQogICAgICAgICAgICBjb25zdCBjb250ZW50Qm9keU92ZXJsYXkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdkaXZbY2xhc3MqPSJjb250ZW50Qm9keV9fb3ZlcmxheSJdJyk7CiAgICAgICAgICAgIGlmIChjb250ZW50Qm9keU92ZXJsYXkpIHsgY29udGVudEJvZHlPdmVybGF5LnJlbW92ZUF0dHJpYnV0ZSgnY2xhc3MnKTsgfQogICAgICAgIH0sIDUwMCk7CiAgICB9IGVsc2UgaWYgKG1hdGNoRG9tYWluKCdsZXBhcmlzaWVuLmZyJykpIHsKICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgdGhpcy5zY3JvbGxMaXN0ZW5lcik7CiAgICAgICAgY29uc3QgcGF5d2FsbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5yZWxhdGl2ZS5waWFuby1wYXl3YWxsLmJlbG93X25hdi5zdGlja3knKTsKICAgICAgICByZW1vdmVET01FbGVtZW50KHBheXdhbGwpOwogICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICBjb25zdCBjb250ZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnY29udGVudCcpOwogICAgICAgICAgICBmb3IgKGNvbnN0IGVsIG9mIGNvbnRlbnQpIHsKICAgICAgICAgICAgICAgIGVsLnJlbW92ZUF0dHJpYnV0ZSgnc3R5bGUnKTsKICAgICAgICAgICAgfQogICAgICAgIH0sIDMwMCk7IC8vIERlbGF5IChpbiBtaWxsaXNlY29uZHMpCiAgICB9IGVsc2UgaWYgKG1hdGNoRG9tYWluKCdjYWl4aW5nbG9iYWwuY29tJykpIHsKICAgICAgICBjb25zdCBwYXlUaXBzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmNvbnMtcGF5LXRpcCcpOwogICAgICAgIGZvciAoY29uc3QgcGF5VGlwIG9mIHBheVRpcHMpIHsKICAgICAgICAgICAgcGF5VGlwLnJlbW92ZUF0dHJpYnV0ZSgnc3R5bGUnKTsKICAgICAgICB9CiAgICAgICAgY29uc3QgYXBwQ29udGVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhcHBDb250ZW50Jyk7CiAgICAgICAgaWYgKGFwcENvbnRlbnQpIHsKICAgICAgICAgICAgY29uc3QgcEhpZGRlbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ3A6bm90KFtzdHlsZT0iZGlzcGxheTpibG9jazsiXScpOwogICAgICAgICAgICBmb3IgKGNvbnN0IGVsIG9mIHBIaWRkZW4pIHsKICAgICAgICAgICAgICAgIGVsLnNldEF0dHJpYnV0ZSgnc3R5bGUnLCAnZGlzcGxheTpibG9jazsnKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAobWF0Y2hEb21haW4oJ2JpempvdXJuYWxzLmNvbScpKSB7CiAgICAgICAgY29uc3Qgc2hlZXRPdmVybGF5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNoZWV0LW92ZXJsYXknKTsKICAgICAgICBjb25zdCBjaHVua1BheXdhbGwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY2h1bmstLXBheXdhbGwnKTsKICAgICAgICByZW1vdmVET01FbGVtZW50KHNoZWV0T3ZlcmxheSwgY2h1bmtQYXl3YWxsKTsKICAgICAgICBjb25zdCBvdmVybGFpZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5pcy1vdmVybGFpZCcpOwogICAgICAgIGZvciAoY29uc3QgZWwgb2Ygb3ZlcmxhaWQpIHsKICAgICAgICAgICAgZWwuY2xhc3NMaXN0LnJlbW92ZSgnaXMtb3ZlcmxhaWQnKTsKICAgICAgICB9CiAgICAgICAgY29uc3QgYm9keUhpZGRlbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5qcy1wcmUtY2h1bmtzX19zdG9yeS1ib2R5Jyk7CiAgICAgICAgYm9keUhpZGRlbi5yZW1vdmVBdHRyaWJ1dGUoJ3N0eWxlJyk7CiAgICB9IGVsc2UgaWYgKG1hdGNoRG9tYWluKCd0aGUtdGxzLmNvLnVrJykpIHsKICAgICAgICBjb25zdCBwYXl3YWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnRscy1zdWJzY3JpcHRpb25zLWJhbm5lcl9fY2xvc2VkLXNraW4nKTsKICAgICAgICByZW1vdmVET01FbGVtZW50KHBheXdhbGwpOwogICAgfSBlbHNlIGlmIChtYXRjaERvbWFpbignY2VuLmFjcy5vcmcnKSkgewogICAgICAgIGNvbnN0IHBheXdhbGwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubWV0ZXJlZEJhcicpOwogICAgICAgIHJlbW92ZURPTUVsZW1lbnQocGF5d2FsbCk7CiAgICB9IGVsc2UgaWYgKG1hdGNoRG9tYWluKCdlbHBlcmlvZGljby5jb20nKSkgewogICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICBjb25zdCB1bmF2YWlsYWJsZUFyZWEgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY2xvc2VkJyk7CiAgICAgICAgICAgIGNvbnN0IGluZm9Cb3ggPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZXAtbWFzUGVyaW9kaWNvLWluZm8nKTsKICAgICAgICAgICAgaWYgKHVuYXZhaWxhYmxlQXJlYSkgewogICAgICAgICAgICAgICAgdW5hdmFpbGFibGVBcmVhLmNsYXNzTGlzdC5yZW1vdmUoJ2Nsb3NlZCcpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChpbmZvQm94KSB7CiAgICAgICAgICAgICAgICBpbmZvQm94LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoaW5mb0JveCk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCAxMDAwKTsKICAgIH0gZWxzZSBpZiAobWF0Y2hEb21haW4oJ3RlY2hpbmFzaWEuY29tJykpIHsKICAgICAgICBjb25zdCBwYXl3YWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBheXdhbGwtY29udGVudCcpOwogICAgICAgIGlmIChwYXl3YWxsKSB7CiAgICAgICAgICAgIHBheXdhbGwuY2xhc3NMaXN0LnJlbW92ZSgncGF5d2FsbC1jb250ZW50Jyk7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHNwbGFzaFN1YnNjcmliZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zcGxhc2gtc3Vic2NyaWJlJyk7CiAgICAgICAgY29uc3QgcGF5d2FsbEhhcmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucGF5d2FsbC1oYXJkJyk7CiAgICAgICAgcmVtb3ZlRE9NRWxlbWVudChzcGxhc2hTdWJzY3JpYmUsIHBheXdhbGxIYXJkKTsKICAgIH0gZWxzZSBpZiAobWF0Y2hEb21haW4oJ3RoZXdyYXAuY29tJykpIHsKICAgICAgICBjb25zdCBlbWJlZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5lbWJlZCcpOwogICAgICAgIGlmIChlbWJlZCkgewogICAgICAgICAgICAvLyBEaXNwbGF5IGZlYXR1cmUgdmlkZW8KICAgICAgICAgICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmZlYXR1cmVkLWltYWdlLWNvbnRhaW5lcicpOwogICAgICAgICAgICByZW1vdmVET01FbGVtZW50KGNvbnRhaW5lcik7CiAgICAgICAgICAgIGVtYmVkLmNsYXNzTGlzdC5yZW1vdmUoJ2Qtbm9uZScpOwogICAgICAgIH0KICAgIH0gZWxzZSBpZiAobWF0Y2hEb21haW4oJ2hici5vcmcnKSkgewogICAgICAgIGNvbnN0IGJhbm5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wZXJzaXN0ZW50LWJhbm5lcicpOwogICAgICAgIHJlbW92ZURPTUVsZW1lbnQoYmFubmVyKTsKICAgIH0gZWxzZSBpZiAobWF0Y2hEb21haW4oJ3NwZWN0YXRvci5jby51aycpKSB7CiAgICAgICAgY29uc3QgYmFubmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3N1YnNjcmliZS1yaWJib24nKTsKICAgICAgICByZW1vdmVET01FbGVtZW50KGJhbm5lcik7CiAgICB9IGVsc2UgaWYgKG1hdGNoRG9tYWluKCdiYXJyb25zLmNvbScpKSB7CiAgICAgICAgY29uc3QgdXJsID0gd2luZG93LmxvY2F0aW9uLmhyZWY7CiAgICAgICAgaWYgKCF1cmwuaW5jbHVkZXMoJ2JhcnJvbnMuY29tL2FtcC8nKSkgewogICAgICAgICAgICBjb25zdCBib2R5Q29udGludW91cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2JvZHkuaXMtY29udGludW91cycpOwogICAgICAgICAgICBjb25zdCBzbmlwcGV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignbWV0YVtjb250ZW50PSJzbmlwcGV0Il0nKTsKICAgICAgICAgICAgaWYgKGJvZHlDb250aW51b3VzICYmIHNuaXBwZXQpIHsKICAgICAgICAgICAgICAgIHJlbW92ZURPTUVsZW1lbnQoc25pcHBldCk7CiAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IHVybC5yZXBsYWNlKCdiYXJyb25zLmNvbScsICdiYXJyb25zLmNvbS9hbXAnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBzaWduaW5MaW5rcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2EucHJpbWFyeS1idXR0b24tLWxpbmtbaHJlZio9InRhcmdldD0iXScpOwogICAgICAgICAgICBmb3IgKGNvbnN0IHNpZ25pbkxpbmsgb2Ygc2lnbmluTGlua3MpIHsKICAgICAgICAgICAgICAgIHNpZ25pbkxpbmsuaHJlZiA9IGRlY29kZVVSSUNvbXBvbmVudChzaWduaW5MaW5rLmhyZWYuc3BsaXQoJ3RhcmdldD0nKVsxXSkuc3BsaXQoJz8nKVswXTsKICAgICAgICAgICAgICAgIHNpZ25pbkxpbmsudGV4dCA9ICdDbGljayc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgYmFycm9uc0FkcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5iYXJyb25zLWJvZHktYWQtcGxhY2VtZW50Jyk7CiAgICAgICAgICAgIHJlbW92ZURPTUVsZW1lbnQoLi4uYmFycm9uc0Fkcyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29uc3QgcHJldmlldyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ3NlY3Rpb25bc3Vic2NyaXB0aW9ucy1zZWN0aW9uPSJjb250ZW50LW5vdC1ncmFudGVkIl0nKTsKICAgICAgICAgICAgcmVtb3ZlRE9NRWxlbWVudChwcmV2aWV3KTsKICAgICAgICAgICAgY29uc3Qgc3Vic2NyU2VjdGlvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ3NlY3Rpb25bc3Vic2NyaXB0aW9ucy1zZWN0aW9uPSJjb250ZW50Il0nKTsKICAgICAgICAgICAgaWYgKHN1YnNjclNlY3Rpb24pIHsKICAgICAgICAgICAgICAgIHN1YnNjclNlY3Rpb24ucmVtb3ZlQXR0cmlidXRlKCdzdWJzY3JpcHRpb25zLXNlY3Rpb24nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZW1vdmVET01FbGVtZW50KGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5sb2dpbi1zZWN0aW9uLWNvbnRhaW5lcicpKTsKICAgIH0gZWxzZSBpZiAobWF0Y2hEb21haW4oJ256ei5jaCcpKSB7CiAgICAgICAgY29uc3QgcGF5d2FsbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5keW5hbWljLXJlZ3dhbGwnKTsKICAgICAgICByZW1vdmVET01FbGVtZW50KHBheXdhbGwpOwogICAgfSBlbHNlIGlmIChtYXRjaERvbWFpbignaXJpc2h0aW1lcy5jb20nKSkgewogICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCAoKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHN0dWJBcnRpY2xlTXNnID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignZGl2LnN0dWItYXJ0aWNsZS1tc2cnKTsKICAgICAgICAgICAgY29uc3QgdXJsID0gd2luZG93LmxvY2F0aW9uLmhyZWY7CiAgICAgICAgICAgIGlmICh1cmwuaW5jbHVkZXMoJ21vZGU9c2FtcGxlJykgfHwgc3R1YkFydGljbGVNc2cpIHsgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBuZXcgVVJMKHVybCkucGF0aG5hbWUgKyAnP21vZGU9YW1wJzsgfQogICAgICAgIH0pOwogICAgfSBlbHNlIGlmIChtYXRjaERvbWFpbigndGhlc2F0dXJkYXlwYXBlci5jb20uYXUnKSkgewogICAgICAgIGNvbnN0IHBheXdhbGwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdkaXYucGF5d2FsbC1oYXJkLWFsd2F5cy1zaG93Jyk7CiAgICAgICAgcmVtb3ZlRE9NRWxlbWVudChwYXl3YWxsKTsKICAgIH0gZWxzZSBpZiAobWF0Y2hEb21haW4oJ2xlc2VjaG9zLmZyJykgJiYgd2luZG93LmxvY2F0aW9uLmhyZWYubWF0Y2goLy1cZHs2LH0vKSkgewogICAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgY29uc3QgYWJvQmFubmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW2NsYXNzXj0icGd4ZjNiIl0nKTsKICAgICAgICAgICAgY29uc3QgYWRCbG9ja3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdbY2xhc3MqPSJqenh2a2QiJyk7CiAgICAgICAgICAgIGZvciAoY29uc3QgYWRCbG9jayBvZiBhZEJsb2NrcykgeyBhZEJsb2NrLnNldEF0dHJpYnV0ZSgnc3R5bGUnLCAnZGlzcGxheTpub25lJyk7IH0KICAgICAgICAgICAgaWYgKGFib0Jhbm5lcikgewogICAgICAgICAgICAgICAgcmVtb3ZlRE9NRWxlbWVudChhYm9CYW5uZXIpOwogICAgICAgICAgICAgICAgY29uc3QgdXJsID0gd2luZG93LmxvY2F0aW9uLmhyZWY7CiAgICAgICAgICAgICAgICBjb25zdCBodG1sID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50Lm91dGVySFRNTDsKICAgICAgICAgICAgICAgIGxldCBzdGF0ZTsKICAgICAgICAgICAgICAgIGNvbnN0IHNwbGl0MSA9IGh0bWwuc3BsaXQoJ3dpbmRvdy5fX1BSRUxPQURFRF9TVEFURV9fPScpWzFdOwogICAgICAgICAgICAgICAgY29uc3Qgc3BsaXQyID0gc3BsaXQxLnNwbGl0KCc8L3NjcmlwdD4nKVswXS50cmltKCk7CiAgICAgICAgICAgICAgICBpZiAoc3BsaXQyLmluY2x1ZGVzKCc7IHdpbmRvdy5fX0RBVEFfXz0nKSkgeyBzdGF0ZSA9IHNwbGl0Mi5zcGxpdCgnOyB3aW5kb3cuX19EQVRBX189JylbMF0udHJpbSgpOyB9IGVsc2UgeyBzdGF0ZSA9IHNwbGl0Mi5zdWJzdHIoMCwgc3BsaXQyLmxlbmd0aCAtIDEpOyB9CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBKU09OLnBhcnNlKHN0YXRlKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBhcnRpY2xlID0gZGF0YS5hcnRpY2xlLmRhdGEuc3RyaXBlc1swXS5tYWluQ29udGVudFswXS5kYXRhLmRlc2NyaXB0aW9uOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHVybExvYWRlZCA9IGRhdGEuYXJ0aWNsZS5kYXRhLnBhdGg7CiAgICAgICAgICAgICAgICAgICAgaWYgKCF1cmwuaW5jbHVkZXModXJsTG9hZGVkKSkgeyB3aW5kb3cubG9jYXRpb24ucmVsb2FkKHRydWUpOyB9CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcGF5d2FsbE5vZGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9zdC1wYXl3YWxsJyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHBheXdhbGxOb2RlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbnRlbnROb2RlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhcnNlciA9IG5ldyBET01QYXJzZXIoKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYXJ0aWNsZUh0bWwgPSBwYXJzZXIucGFyc2VGcm9tU3RyaW5nKCc8ZGl2PicgKyBhcnRpY2xlICsgJzwvZGl2PicsICd0ZXh0L2h0bWwnKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYXJ0aWNsZVBhciA9IGFydGljbGVIdG1sLnF1ZXJ5U2VsZWN0b3IoJ2RpdicpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXJ0aWNsZVBhcikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudE5vZGUuYXBwZW5kQ2hpbGQoYXJ0aWNsZVBhcik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50Tm9kZS5jbGFzc05hbWUgPSBwYXl3YWxsTm9kZS5jbGFzc05hbWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXl3YWxsTm9kZS5wYXJlbnROb2RlLmluc2VydEJlZm9yZShjb250ZW50Tm9kZSwgcGF5d2FsbE5vZGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZlRE9NRWxlbWVudChwYXl3YWxsTm9kZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwYXl3YWxsTGFzdENoaWxkTm9kZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3N0LXBheXdhbGwgID4gOmxhc3QtY2hpbGQnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXl3YWxsTGFzdENoaWxkTm9kZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBheXdhbGxMYXN0Q2hpbGROb2RlLnNldEF0dHJpYnV0ZSgnc3R5bGUnLCAnaGVpZ2h0OiBhdXRvICFpbXBvcnRhbnQ7IG92ZXJmbG93OiBoaWRkZW4gIWltcG9ydGFudDsgbWF4LWhlaWdodDogbm9uZSAhaW1wb3J0YW50OycpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0eWxlRWxlbSA9IGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3R5bGUnKSk7CiAgICAgICAgICAgICAgICAgICAgc3R5bGVFbGVtLmlubmVySFRNTCA9ICcucG9zdC1wYXl3YWxsOjphZnRlciB7aGVpZ2h0OiBhdXRvICFpbXBvcnRhbnQ7fSc7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkKHRydWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSwgNTAwKTsgLy8gRGVsYXkgKGluIG1pbGxpc2Vjb25kcykKICAgIH0gZWxzZSBpZiAobWF0Y2hEb21haW4oJ3N0YXJ0cmlidW5lLmNvbScpKSB7CiAgICAgICAgLy8gcmVtb3ZlIGFjdGl2ZSBjbGFzcyBmcm9tIGFsbCBlbGVtZW50cwogICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2Rpdi5SZWFjdE1vZGFsUG9ydGFsJykuZm9yRWFjaChmdW5jdGlvbiAoZWwpIHsKICAgICAgICAgICAgcmVtb3ZlRE9NRWxlbWVudChlbCk7CiAgICAgICAgfSk7CiAgICAgICAgLy8gRW5hYmxlIFNjcm9sbC4gUmV2ZWFsIEhpZGRsZW4gUGFyYWdyYXBoCiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2JvZHknKVswXS5yZW1vdmVBdHRyaWJ1dGUoJ2NsYXNzJyk7CiAgICB9IGVsc2UgaWYgKG1hdGNoRG9tYWluKCdzZWF0dGxldGltZXMuY29tJykpIHsKICAgICAgICB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIC8vIHJlbW92ZSBtb2RhbCBjbGFzcyBmcm9tIGFsbCBlbGVtZW50cwogICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdkaXYubW9kYWwnKS5mb3JFYWNoKGZ1bmN0aW9uIChlbCkgewogICAgICAgICAgICAgICAgcmVtb3ZlRE9NRWxlbWVudChlbCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAvLyBSZW1vdmUgQmx1cnJlZCBTdHlsZSBmcm9tIGFsbCBtYXRjaGluZyBEaXZzCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb250YWluZXInKS5yZW1vdmVBdHRyaWJ1dGUoJ3N0eWxlJyk7CiAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2RpdltzdHlsZX49ImZpbHRlciJdJykuZm9yRWFjaChmdW5jdGlvbiAoZWwpIHsKICAgICAgICAgICAgICAgIGVsLnJlbW92ZUF0dHJpYnV0ZSgnc3R5bGUnKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGRvY3VtZW50CiAgICAgICAgICAgICAgICAucXVlcnlTZWxlY3RvckFsbCgnZGl2W2NsYXNzfj0iTmV3c2xldHRlclNpZ251cFNwbGFzaCJdJykKICAgICAgICAgICAgICAgIC5mb3JFYWNoKGZ1bmN0aW9uIChlbCkgewogICAgICAgICAgICAgICAgICAgIGVsLnJlbW92ZUF0dHJpYnV0ZSgnY2xhc3MnKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgIH0sIDEwMDApOyAvLyBEZWxheSAoaW4gbWlsbGlzZWNvbmRzKQogICAgfSBlbHNlIGlmIChtYXRjaERvbWFpbigndGhlYXRsYW50aWMuY29tJykpIHsKICAgICAgICAvLyBSZW1vdmUgYWxsIG51ZGdlIGVsZW1lbnRzCiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnZGl2W2NsYXNzKj0iYy1udWRnZSJdJykuZm9yRWFjaChmdW5jdGlvbiAoZWwpIHsKICAgICAgICAgICAgcmVtb3ZlRE9NRWxlbWVudChlbCk7CiAgICAgICAgfSk7CiAgICAgICAgLy8gUmVtb3ZlIGFsbCBGYW5jeUJveCBhZHMKICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdkaXZbY2xhc3MqPSJmYW5jeWJveCJdJykuZm9yRWFjaChmdW5jdGlvbiAoZWwpIHsKICAgICAgICAgICAgcmVtb3ZlRE9NRWxlbWVudChlbCk7CiAgICAgICAgfSk7CiAgICB9IGVsc2UgaWYgKG1hdGNoRG9tYWluKFsndGhlYXRobGV0aWMuY29tJywgJ3RoZWF0aGxldGljLmNvLnVrJ10pKSB7CiAgICAgICAgd2luZG93LnNldEludGVydmFsKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgY29uc3QgcGF5d2FsbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNzbGlkZXVwLXBheXdhbGwnKTsKICAgICAgICAgICAgY29uc3QgZGFya2VuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2Rhcmtlbi1vdmVybGF5Jyk7CiAgICAgICAgICAgIGlmIChwYXl3YWxsICYmIGRhcmtlbikgewogICAgICAgICAgICAgICAgcmVtb3ZlRE9NRWxlbWVudChwYXl3YWxsKTsKICAgICAgICAgICAgICAgIHJlbW92ZURPTUVsZW1lbnQoZGFya2VuKTsKICAgICAgICAgICAgICAgIHdpbmRvdy5jbGVhckludGVydmFsKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCAxMDApOwoKICAgICAgICBjb25zdCBzdHlsZUVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzdHlsZScpOwoKICAgICAgICBjb25zdCBjc3NSdWxlcyA9IGAKICAgICAgICAgICAgICAgIC5ub3Njcm9sbCB7CiAgICAgICAgICAgICAgICAgb3ZlcmZsb3c6IGF1dG8gIWltcG9ydGFudDsKICAgICAgICAgICAgICAgICBoZWlnaHQ6IGF1dG8gIWltcG9ydGFudDsKICAgICAgICAgICAgICAgICB3aWR0aDogYXV0byAhaW1wb3J0YW50OwogICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBzdGF0aWMgIWltcG9ydGFudDsKICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIGA7CgogICAgICAgIHN0eWxlRWxlbWVudC5pbm5lckhUTUwgPSBjc3NSdWxlczsKICAgICAgICBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKHN0eWxlRWxlbWVudCk7CgogICAgICAgIGlmICghd2luZG93LmxvY2F0aW9uLmhyZWYuaW5jbHVkZXMoJz9hbXAnKSkgewogICAgICAgICAgICBjb25zdCBwYXl3YWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnZGl2I3BheXdhbGwtY29udGFpbmVyLCBkaXZbc3Vic2NyaXB0aW9ucy1hY3Rpb249InN1YnNjcmliZSJdLCBhLmhlYWRsaW5lLXBheXdhbGwnKTsKICAgICAgICAgICAgY29uc3QgYW1waHRtbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2xpbmtbcmVsPSJhbXBodG1sIl0nKTsKICAgICAgICAgICAgaWYgKHBheXdhbGwubGVuZ3RoICYmIGFtcGh0bWwpIHsKICAgICAgICAgICAgICAgIHJlbW92ZURPTUVsZW1lbnQoLi4ucGF5d2FsbCk7CiAgICAgICAgICAgICAgICB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBhbXBodG1sLmhyZWY7CiAgICAgICAgICAgICAgICB9LCA1MDApOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYW1wVW5oaWRlU3Vic2NyaXB0aW9uc1NlY3Rpb24oKTsKICAgICAgICAgICAgY29uc3Qgc3Vic2NyaXB0aW9uc0FjdGlvbnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdbc3Vic2NyaXB0aW9ucy1hY3Rpb25zXScpOwogICAgICAgICAgICByZW1vdmVET01FbGVtZW50KC4uLnN1YnNjcmlwdGlvbnNBY3Rpb25zKTsKICAgICAgICB9CiAgICB9IGVsc2UgaWYgKG1hdGNoRG9tYWluKCduZXd5b3JrZXIuY29tJykpIHsKICAgICAgICBibG9ja0VsZW1lbnQoJy5wYXl3YWxsLWJhcicsIHRydWUpOwogICAgICAgIGJsb2NrRWxlbWVudCgnLnBheXdhbGwtbW9kYWwnKTsKICAgIH0gZWxzZSBpZiAobWF0Y2hEb21haW4oJ3Zhbml0eWZhaXIuY29tJykpIHsKICAgICAgICBjb25zdCBwYXl3YWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBheXdhbGwtYmFyJyk7CiAgICAgICAgcmVtb3ZlRE9NRWxlbWVudChwYXl3YWxsKTsKICAgIH0gZWxzZSBpZiAobWF0Y2hEb21haW4oWydwb3N0aW1lZXMuZWUnLCAnZWx1MjQuZWUnXSkpIHsKICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgLy8gUmVtb3ZlICdhZGJsb2NrZXItZGV0ZWN0ZWQnIGZvb3RlciBub3RpZmljYXRpb24KICAgICAgICAgICAgY29uc3QgYWRibG9ja05vdGlmID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmFkLWJsb2NrLW5vdGlmaWNhdGlvbi1vdmVybGF5Jyk7CiAgICAgICAgICAgIHJlbW92ZURPTUVsZW1lbnQoYWRibG9ja05vdGlmKTsKICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVBdHRyaWJ1dGUoJ3N0eWxlJyk7CiAgICAgICAgfSwgODAwKTsgLy8gRGVsYXkgKGluIG1pbGxpc2Vjb25kcykKICAgIH0gZWxzZSBpZiAobWF0Y2hEb21haW4oJ3RoZW9saXZlcHJlc3MuZXMnKSkgewogICAgICAgIGNvbnN0IG1vZGFsQmFja2Ryb3AgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWwtYmFja2Ryb3AnKTsKICAgICAgICBjb25zdCBwYXl3YWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmV2LW9wZW4tbW9kYWwtcGF5d2FsbC1SRVFVSVJFX0xPR0lOX1dJVEhfRU5USVRMRU1FTlQnKTsKICAgICAgICByZW1vdmVET01FbGVtZW50KG1vZGFsQmFja2Ryb3AsIHBheXdhbGwpOwoKICAgICAgICBmb3IgKGNvbnN0IGNsYXp6IG9mIFsnZXYtbW9kYWxzJywgJ21vZGFsLW9wZW4nXSkgewogICAgICAgICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5yZW1vdmUoY2xhenopOwogICAgICAgIH0KICAgIH0gZWxzZSBpZiAobWF0Y2hEb21haW4oJ3RoZW1hcmtlci5jb20nKSkgewogICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICBjb25zdCBwYXl3YWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW2RhdGEtdGVzdD0iYm90dG9tU3RyaXAiXScpOwogICAgICAgICAgICBjb25zdCBub3RpZmljYXRpb25zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3B3U3Vic2NyaWJlUG9wdXAnKTsKICAgICAgICAgICAgY29uc3QgYmFubmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3RoZW1hcmtlclxcLmNvbVxcLmJpbGxib2FyZFxcLmRlc2t0b3AnKTsKICAgICAgICAgICAgY29uc3QgbmV3c0Jhbm5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyN0aGVtYXJrZXJcXC5jb21cXC5uZXdzXFwuYmFubmVyJyk7CiAgICAgICAgICAgIGNvbnN0IG1pZEJhbm5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyN0aGVtYXJrZXJcXC5jb20uaGVhZGxpbmVcXC5iYW5uZXJcXC5kZXNrdG9wJyk7CiAgICAgICAgICAgIGNvbnN0IGZpbmFuY2VCYW5uZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjdGhlbWFya2VyXFwuY29tXFwuZmluYW5jZVxcLmJhbm5lcicpOwogICAgICAgICAgICBjb25zdCB0b3BTdHJpcCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLXRlc3Q9InRvcFN0cmlwIl0nKTsKICAgICAgICAgICAgY29uc3Qgb3RoZXJCYW5uZXJzID0gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1hdWR0YXJnZXRdJykpOwogICAgICAgICAgICByZW1vdmVET01FbGVtZW50KHBheXdhbGwsIG5vdGlmaWNhdGlvbnMsIGJhbm5lciwgdG9wU3RyaXAsIG1pZEJhbm5lciwgbmV3c0Jhbm5lciwgZmluYW5jZUJhbm5lciwgLi4ub3RoZXJCYW5uZXJzKTsKICAgICAgICB9LCA1MDApOwogICAgfSBlbHNlIGlmIChtYXRjaERvbWFpbignaGFhcmV0ei5jby5pbCcpKSB7CiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGNvbnN0IG5vdGlmaWNhdGlvbnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjcHdTdWJzY3JpYmVQb3B1cCcpOwogICAgICAgICAgICBjb25zdCBwYXl3YWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW2RhdGEtdGVzdD0iYm90dG9tU3RyaXAiXScpOwogICAgICAgICAgICBjb25zdCBiYW5uZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjaGFhcmV0elxcLmNvXFwuaWxcXC5iaWxsYm9hcmRcXC5kZXNrdG9wJyk7CiAgICAgICAgICAgIGNvbnN0IGVkaXRvcnNCYW5uZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjaGFhcmV0elxcLmNvXFwuaWxcXC5lZGl0b3JzXFwuYmFubmVyJyk7CiAgICAgICAgICAgIGNvbnN0IGhlYWRsaW5lc0Jhbm5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNoYWFyZXR6XFwuY29cXC5pbFxcLmhlYWRsaW5lXFwuYm94XFwuZGVza3RvcCcpOwogICAgICAgICAgICBjb25zdCB0b3BTdHJpcCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLXRlc3Q9InRvcFN0cmlwIl0nKTsKICAgICAgICAgICAgY29uc3Qgb3RoZXJCYW5uZXJzID0gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1hdWR0YXJnZXRdJykpOwogICAgICAgICAgICByZW1vdmVET01FbGVtZW50KHBheXdhbGwsIG5vdGlmaWNhdGlvbnMsIGJhbm5lciwgZWRpdG9yc0Jhbm5lciwgdG9wU3RyaXAsIGhlYWRsaW5lc0Jhbm5lciwgLi4ub3RoZXJCYW5uZXJzKTsKICAgICAgICB9LCA1MDApOwogICAgfSBlbHNlIGlmIChtYXRjaERvbWFpbignc3VlZGRldXRzY2hlLmRlJykpIHsKICAgICAgICBjb25zdCB1cmwgPSB3aW5kb3cubG9jYXRpb24uaHJlZjsKICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgKCkgPT4gewogICAgICAgICAgICBjb25zdCBvZmZlclBhZ2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdkaXYub2ZmZXItcGFnZScpOwogICAgICAgICAgICBpZiAodXJsLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vd3d3LnN1ZWRkZXV0c2NoZS5kZScpICYmICh1cmwuaW5jbHVkZXMoJ3JlZHVjZWQ9dHJ1ZScpIHx8IG9mZmVyUGFnZSkpIHsgd2luZG93LmxvY2F0aW9uLmhyZWYgPSB1cmwuc3BsaXQoJz8nKVswXS5yZXBsYWNlKCd3d3cuJywgJ2FtcGh0bWwuJyk7IH0gZWxzZSBpZiAodXJsLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vc3otbWFnYXppbi5zdWVkZGV1dHNjaGUuZGUnKSkgewogICAgICAgICAgICAgICAgaWYgKHVybC5pbmNsdWRlcygncmVkdWNlZD10cnVlJykgfHwgb2ZmZXJQYWdlKSB7IHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gbmV3IFVSTCh1cmwpLnBhdGhuYW1lICsgJyFhbXAnOyB9CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmICh1cmwuaW5jbHVkZXMoJyFhbXAnKSkgewogICAgICAgICAgICAgICAgY29uc3QgcGFyYWdyYXBoUmVkdWNlZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wYXJhZ3JhcGgtLXJlZHVjZWQnKTsKICAgICAgICAgICAgICAgIGlmIChwYXJhZ3JhcGhSZWR1Y2VkKSB7IHBhcmFncmFwaFJlZHVjZWQuY2xhc3NMaXN0LnJlbW92ZSgncGFyYWdyYXBoLS1yZWR1Y2VkJyk7IH0KICAgICAgICAgICAgICAgIGNvbnN0IHBhcmFncmFwaEhpZGRlbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5wYXJhZ3JhcGgtLWhpZGRlbicpOwogICAgICAgICAgICAgICAgZm9yIChjb25zdCBwYXJIaWRkZW4gb2YgcGFyYWdyYXBoSGlkZGVuKSB7IHBhckhpZGRlbi5jbGFzc0xpc3QucmVtb3ZlKCdwYXJhZ3JhcGgtLWhpZGRlbicpOyB9CiAgICAgICAgICAgICAgICBjb25zdCBwYXJhZ3JhcGhEeW5hbWljID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBhcmFncmFwaC0tZHluYW1pYycpOwogICAgICAgICAgICAgICAgaWYgKHBhcmFncmFwaER5bmFtaWMpIHsgcGFyYWdyYXBoRHluYW1pYy5jbGFzc0xpc3QucmVtb3ZlKCdwYXJhZ3JhcGgtLWR5bmFtaWMnKTsgfQogICAgICAgICAgICAgICAgY29uc3QgYW1wT2ZmZXJwYWdlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmFtcC1vZmZlcnBhZ2UnKTsKICAgICAgICAgICAgICAgIHJlbW92ZURPTUVsZW1lbnQoYW1wT2ZmZXJwYWdlKTsKICAgICAgICAgICAgfQogICAgICAgIH0sIDUwMCk7IC8vIERlbGF5IChpbiBtaWxsaXNlY29uZHMpCiAgICB9IGVsc2UgaWYgKG1hdGNoRG9tYWluKCdhZHdlZWsuY29tJykpIHsKICAgICAgICBjb25zdCBib2R5U2luZ2xlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYm9keS5zaW5nbGUnKTsKICAgICAgICBjb25zdCBhbXBIdG1sID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignbGlua1tyZWw9ImFtcGh0bWwiXScpOwogICAgICAgIGlmIChib2R5U2luZ2xlICYmIGFtcEh0bWwpIHsKICAgICAgICAgICAgYm9keVNpbmdsZS5jbGFzc0xpc3QucmVtb3ZlKCdzaW5nbGUnKTsKICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBhbXBIdG1sLmhyZWY7CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChtYXRjaERvbWFpbignZ2Vsb2NhbC5pdCcpKSB7CiAgICAgICAgaWYgKCF3aW5kb3cubG9jYXRpb24uaHJlZi5pbmNsdWRlcygnL2FtcC8nKSkgewogICAgICAgICAgICBjb25zdCBwYXl3YWxsQWRhZ2lvID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBheXdhbGwtYWRhZ2lvJyk7CiAgICAgICAgICAgIHJlbW92ZURPTUVsZW1lbnQocGF5d2FsbEFkYWdpbyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29uc3QgcGF5d2FsbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2RpdlthbXAtYWNjZXNzPSJzaG93Q29udGVudCJdJyk7CiAgICAgICAgICAgIGlmIChwYXl3YWxsKSB7IHBheXdhbGwucmVtb3ZlQXR0cmlidXRlKCdhbXAtYWNjZXNzLWhpZGUnKTsgfQogICAgICAgICAgICBjb25zdCBhbXBBZHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdhbXAtYWQnKTsKICAgICAgICAgICAgcmVtb3ZlRE9NRWxlbWVudCguLi5hbXBBZHMpOwogICAgICAgIH0KICAgIH0gZWxzZSBpZiAobWF0Y2hEb21haW4oJ2VsbXVuZG8uZXMnKSkgewogICAgICAgIGNvbnN0IHByZW1pdW0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudWUtYy1hcnRpY2xlX19wcmVtaXVtJyk7CiAgICAgICAgY29uc3QgdXJsID0gd2luZG93LmxvY2F0aW9uLmhyZWY7CiAgICAgICAgaWYgKCF1cmwuaW5jbHVkZXMoJy9hbXAuJyArICdlbG11bmRvLmVzJyArICcvJykpIHsKICAgICAgICAgICAgaWYgKHByZW1pdW0pIHsKICAgICAgICAgICAgICAgIHJlbW92ZURPTUVsZW1lbnQocHJlbWl1bSk7CiAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmLnJlcGxhY2UoJy93d3cuJywgJy9hbXAuJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb25zdCBwYXl3YWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignZGl2W2FtcC1hY2Nlc3M9ImF1dGhvcml6ZWQhPXRydWUiXScpOwogICAgICAgICAgICBpZiAocGF5d2FsbCkgewogICAgICAgICAgICAgICAgcmVtb3ZlRE9NRWxlbWVudChwYXl3YWxsKTsKICAgICAgICAgICAgICAgIGNvbnN0IGRpdkhpZGRlbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2RpdlthbXAtYWNjZXNzPSJhdXRob3JpemVkPXRydWUiXScpOwogICAgICAgICAgICAgICAgaWYgKGRpdkhpZGRlbikgewogICAgICAgICAgICAgICAgICAgIGRpdkhpZGRlbi5yZW1vdmVBdHRyaWJ1dGUoJ2FtcC1hY2Nlc3MtaGlkZScpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGFkdmVydGlzaW5nID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmFkdmVydGlzaW5nLCBhbXAtZW1iZWQnKTsKICAgICAgICAgICAgcmVtb3ZlRE9NRWxlbWVudCguLi5hZHZlcnRpc2luZyk7CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChtYXRjaERvbWFpbignc3BlbGQubmwnKSkgewogICAgICAgIGNvbnN0IHBheXdhbGxQb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jLXBheXdhbGwtbm90aWNlJyk7CiAgICAgICAgcmVtb3ZlRE9NRWxlbWVudChwYXl3YWxsUG9wdXApOwogICAgfSBlbHNlIGlmIChtYXRjaERvbWFpbignbGFzdGFtcGEuaXQnKSkgewogICAgICAgIGNvbnN0IHVybCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmOwogICAgICAgIGlmICghdXJsLmluY2x1ZGVzKCcvYW1wLycpKSB7CiAgICAgICAgICAgIGNvbnN0IHByZW1pdW0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucGF5d2FsbC1hZGFnaW8nKTsKICAgICAgICAgICAgcmVtb3ZlRE9NRWxlbWVudChwcmVtaXVtKTsKICAgICAgICAgICAgd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgaWYgKHByZW1pdW0pIHsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IHVybC5zcGxpdCgnPycpWzBdICsgJy9hbXAvJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvbnN0IGFydGljbGVCb2R5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignZGl2I2FydGljbGUtYm9keVtzdHlsZV0nKTsKICAgICAgICAgICAgICAgIGlmIChhcnRpY2xlQm9keSkgewogICAgICAgICAgICAgICAgICAgIGFydGljbGVCb2R5LnJlbW92ZUF0dHJpYnV0ZSgnc3R5bGUnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgNTAwKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb25zdCBwYXl3YWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignZGl2W2lkXj0icGF5d2FsbC1iYW5uZXIiXScpOwogICAgICAgICAgICByZW1vdmVET01FbGVtZW50KHBheXdhbGwpOwogICAgICAgICAgICBjb25zdCBzdWJzY3JpcHRpb25TZWN0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW3N1YnNjcmlwdGlvbnMtc2VjdGlvbj0iY29udGVudCJdJyk7CiAgICAgICAgICAgIGlmIChzdWJzY3JpcHRpb25TZWN0aW9uKSB7CiAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb25TZWN0aW9uLnJlbW92ZUF0dHJpYnV0ZSgnc3Vic2NyaXB0aW9ucy1zZWN0aW9uJyk7CiAgICAgICAgICAgICAgICBjb25zdCBwcmV2aWV3ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignZGl2W3N1YnNjcmlwdGlvbnMtc2VjdGlvbj0iY29udGVudC1ub3QtZ3JhbnRlZCJdJyk7CiAgICAgICAgICAgICAgICByZW1vdmVET01FbGVtZW50KHByZXZpZXcpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGFtcEFkcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2FtcC1hZCwgYW1wLWVtYmVkJyk7CiAgICAgICAgICAgIHJlbW92ZURPTUVsZW1lbnQoLi4uYW1wQWRzKTsKICAgICAgICB9CiAgICB9IGVsc2UgaWYgKG1hdGNoRG9tYWluKCd0aW1lLmNvbScpKSB7CiAgICAgICAgY29uc3QgYm9keSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2JvZHknKTsKICAgICAgICBpZiAoYm9keSkgewogICAgICAgICAgICBib2R5LnNldEF0dHJpYnV0ZSgnc3R5bGUnLCAncG9zaXRpb246cmVsYXRpdmUgIWltcG9ydGFudDsnKTsKICAgICAgICB9CiAgICB9IGVsc2UgaWYgKG1hdGNoRG9tYWluKCdleHBhbnNpb24uY29tJykpIHsKICAgICAgICBjb25zdCBwcmVtaXVtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnVlLWMtYXJ0aWNsZV9fcHJlbWl1bScpOwogICAgICAgIGNvbnN0IHVybCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmOwogICAgICAgIGlmICghdXJsLmluY2x1ZGVzKCcvYW1wLicgKyAnZXhwYW5zaW9uLmNvbScgKyAnLycpKSB7CiAgICAgICAgICAgIGlmIChwcmVtaXVtKSB7CiAgICAgICAgICAgICAgICByZW1vdmVET01FbGVtZW50KHByZW1pdW0pOwogICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSB3aW5kb3cubG9jYXRpb24uaHJlZi5yZXBsYWNlKCcvd3d3LicsICcvYW1wLicpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29uc3QgcGF5d2FsbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2RpdlthbXAtYWNjZXNzPSJhdXRob3JpemVkIT10cnVlIl0nKTsKICAgICAgICAgICAgaWYgKHBheXdhbGwpIHsKICAgICAgICAgICAgICAgIHJlbW92ZURPTUVsZW1lbnQocGF5d2FsbCk7CiAgICAgICAgICAgICAgICBjb25zdCBkaXZIaWRkZW4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdkaXZbYW1wLWFjY2Vzcz0iYXV0aG9yaXplZD10cnVlIl0nKTsKICAgICAgICAgICAgICAgIGlmIChkaXZIaWRkZW4pIHsKICAgICAgICAgICAgICAgICAgICBkaXZIaWRkZW4ucmVtb3ZlQXR0cmlidXRlKCdhbXAtYWNjZXNzLWhpZGUnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBhZHZlcnRpc2luZyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5hZHZlcnRpc2luZywgYW1wLWVtYmVkJyk7CiAgICAgICAgICAgIHJlbW92ZURPTUVsZW1lbnQoLi4uYWR2ZXJ0aXNpbmcpOwogICAgICAgIH0KICAgIH0gZWxzZSBpZiAobWF0Y2hEb21haW4oJ2NoaWNhZ29idXNpbmVzcy5jb20nKSkgewogICAgICAgIGNvbnN0IGJvZHkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdib2R5W2NsYXNzXScpOwogICAgICAgIGlmIChib2R5KSB7CiAgICAgICAgICAgIGJvZHkucmVtb3ZlQXR0cmlidXRlKCdjbGFzcycpOwogICAgICAgIH0KICAgIH0gZWxzZSBpZiAobWF0Y2hEb21haW4oJ2xhdGltZXMuY29tJykpIHsKICAgICAgICBjb25zdCBwYXl3YWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignbWV0ZXJpbmctbW9kYWwnKTsKICAgICAgICBjb25zdCBpbmNvZ25pdG9XYWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignbWV0ZXJpbmctdG9wcGFuZWwnKTsKICAgICAgICBpZiAocGF5d2FsbCkgewogICAgICAgICAgICByZW1vdmVET01FbGVtZW50KHBheXdhbGwpOwogICAgICAgIH0gZWxzZSBpZiAoaW5jb2duaXRvV2FsbCkgewogICAgICAgICAgICByZW1vdmVET01FbGVtZW50KGluY29nbml0b1dhbGwpOwogICAgICAgIH0KICAgICAgICBpZiAocGF5d2FsbCB8fCBpbmNvZ25pdG9XYWxsKSB7CiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQXR0cmlidXRlKCdzdHlsZScpOwogICAgICAgIH0KICAgIH0gZWxzZSBpZiAobWF0Y2hEb21haW4oJ2ZvcmVpZ25wb2xpY3kuY29tJykpIHsKICAgICAgICBjb25zdCBjb250ZW50VW5nYXRlZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2Rpdi5jb250ZW50LXVuZ2F0ZWQnKTsKICAgICAgICByZW1vdmVET01FbGVtZW50KGNvbnRlbnRVbmdhdGVkKTsKICAgICAgICBjb25zdCBjb250ZW50R2F0ZWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdkaXYuY29udGVudC1nYXRlZCcpOwogICAgICAgIGlmIChjb250ZW50R2F0ZWQpIHsKICAgICAgICAgICAgY29udGVudEdhdGVkLmNsYXNzTGlzdC5yZW1vdmUoJ2NvbnRlbnQtZ2F0ZWQnKTsKICAgICAgICB9CiAgICB9IGVsc2UgaWYgKG1hdGNoRG9tYWluKCdib3N0b25nbG9iZS5jb20nKSkgewogICAgICAgIC8vIFJlbW92ZSB0aGUgcG9ydGlvbiBjb3ZlcmluZyB0aGUgcGF5d2FsbAogICAgICAgIGNvbnN0IHBheXdhbGwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdkaXYubWV0ZXItcGF5d2FsbCcpOwogICAgICAgIGlmIChwYXl3YWxsKSB7CiAgICAgICAgICAgIHJlbW92ZURPTUVsZW1lbnQocGF5d2FsbCk7CiAgICAgICAgfQogICAgICAgIC8vIFJlLWVuYWJsZSBzY3JvbGxpbmcKICAgICAgICBjb25zdCBib2R5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYm9keScpOwogICAgICAgIGlmIChib2R5KSB7CiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQXR0cmlidXRlKCdzdHlsZScpOwogICAgICAgIH0KICAgICAgICAvLyBDbGljayB0aGUgYnV0dG9uIHRvIHJldmVhbCB0aGUgcmVzdCBvZiB0aGUgYXJ0aWNsZQogICAgICAgIGNvbnN0IGJ1dHRvbkRpdiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tpZD0iY29udGludWVfYnV0dG9uIl0nKTsKICAgICAgICBpZiAoYnV0dG9uRGl2KSB7CiAgICAgICAgICAgIGNvbnN0IGJ1dHRvbiA9IGJ1dHRvbkRpdi5xdWVyeVNlbGVjdG9yKCdidXR0b24nKTsKICAgICAgICAgICAgaWYgKGJ1dHRvbikgewogICAgICAgICAgICAgICAgYnV0dG9uLmNsaWNrKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKG1hdGNoRG9tYWluKCduYXRpb25hbGdlb2dyYXBoaWMuY29tJykpIHsKICAgICAgICAvLyBwcmV2ZW50IG1vZGFsIGZyb20gc2hvd2luZyB1cCwgdGhlbiByZW1vdmUgc2Nyb2xsLWxvY2tpbmcsIGFuZCBhcnRpY2xlIGJsdXIKICAgICAgICBuZXcgd2luZG93Lk11dGF0aW9uT2JzZXJ2ZXIoZnVuY3Rpb24gKG11dGF0aW9ucykgewogICAgICAgICAgICBmb3IgKGNvbnN0IG11dGF0aW9uIG9mIG11dGF0aW9ucykgewogICAgICAgICAgICAgICAgZm9yIChjb25zdCBub2RlIG9mIG11dGF0aW9uLmFkZGVkTm9kZXMpIHsKICAgICAgICAgICAgICAgICAgICBpZiAobm9kZSBpbnN0YW5jZW9mIHdpbmRvdy5IVE1MRWxlbWVudCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5tYXRjaGVzKCcjZml0dFBvcnRhbF8wJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZURPTUVsZW1lbnQobm9kZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBib2R5ID0gZG9jdW1lbnQuYm9keTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvZHkucmVtb3ZlQXR0cmlidXRlKCdjbGFzcycpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9keS5yZW1vdmVBdHRyaWJ1dGUoJ3N0eWxlJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBib2R5LnJlbW92ZUF0dHJpYnV0ZSgnb3ZlcmZsb3cnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGJsdXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjbmF0Z2VvLXRlbXBsYXRlMS1mcmFtZS0xLW1vZHVsZS0xID4gZGl2ID4gZGl2ID4gc2VjdGlvbiA+IGFydGljbGUgPiBzZWN0aW9uID4gZGl2LkFydGljbGVfX0NvbnRlbnRfX092ZXJsYXktLWdhdGVkJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYmx1cikgcmVtb3ZlRE9NRWxlbWVudChibHVyKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpc2Nvbm5lY3QoKTsgLy8gU3RvcCB3YXRjaGluZyBmb3IgZWxlbWVudCBiZWluZyBhZGRlZCBhZnRlciBvbmUgcmVtb3ZhbAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSkub2JzZXJ2ZShkb2N1bWVudCwgeyBzdWJ0cmVlOiB0cnVlLCBjaGlsZExpc3Q6IHRydWUgfSk7CiAgICB9IGVsc2UgaWYgKG1hdGNoRG9tYWluKCdoYnJjaGluYS5vcmcnKSkgewogICAgICAgIGNvbnN0IGhpZGRlbkRpdiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2RpdiN0aGVfY29udGVudCcpOwogICAgICAgIGlmIChoaWRkZW5EaXYpIHsKICAgICAgICAgICAgaGlkZGVuRGl2LnJlbW92ZUF0dHJpYnV0ZSgnc3R5bGUnKTsKICAgICAgICB9CiAgICB9IGVsc2UgaWYgKG1hdGNoRG9tYWluKCdzY21wLmNvbScpKSB7CiAgICAgICAgaWYgKHdpbmRvdy5sb2NhdGlvbi5ocmVmLmluY2x1ZGVzKCcvYW1wLicpKSB7CiAgICAgICAgICAgIGNvbnN0IGRpdkhpZGRlbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2Rpdi5hcnRpY2xlLWJvZHlbYW1wLWFjY2Vzc11bYW1wLWFjY2Vzcy1oaWRlXScpOwogICAgICAgICAgICBmb3IgKGNvbnN0IGVsZW0gb2YgZGl2SGlkZGVuKSB7CiAgICAgICAgICAgICAgICBlbGVtLnJlbW92ZUF0dHJpYnV0ZSgnYW1wLWFjY2Vzcy1oaWRlJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgZGVmYXVsdE1ldGVycyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2Rpdi5kZWZhdWx0LW1ldGVyLCBkaXYjYXJjaGl2ZS1hcnRpY2xlLW1ldGVyJyk7CiAgICAgICAgICAgIGNvbnN0IGFkcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2FtcC1hZCwgZGl2LmFkLWJhbm5lciwgZGl2LmFkdmVydC1mbHktY2FycGV0LWNvbnRhaW5lciwgZGl2LmlubGluZS1hZHZlcnQnKTsKICAgICAgICAgICAgcmVtb3ZlRE9NRWxlbWVudCguLi5kZWZhdWx0TWV0ZXJzLCAuLi5hZHMpOwogICAgICAgIH0KICAgIH0gZWxzZSBpZiAobWF0Y2hEb21haW4oJ2ZvcnR1bmUuY29tJykpIHsKICAgICAgICBjb25zdCBwYXl3YWxsZWRBcnRpY2xlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBheXdhbGwucGF5d2FsbEFjdGl2ZScpOwogICAgICAgIGlmIChwYXl3YWxsZWRBcnRpY2xlKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgY2xhenogb2YgWydwYXl3YWxsJywgJ3BheXdhbGxBY3RpdmUnXSkgewogICAgICAgICAgICAgICAgcGF5d2FsbGVkQXJ0aWNsZS5jbGFzc0xpc3QucmVtb3ZlKGNsYXp6KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBtYXRjaERvbWFpbihkb21haW5zKSB7CiAgICAgICAgY29uc3QgaG9zdG5hbWUgPSB3aW5kb3cubG9jYXRpb24uaG9zdG5hbWU7CiAgICAgICAgaWYgKHR5cGVvZiBkb21haW5zID09PSAnc3RyaW5nJykgeyBkb21haW5zID0gW2RvbWFpbnNdOyB9CiAgICAgICAgcmV0dXJuIGRvbWFpbnMuc29tZShkb21haW4gPT4gaG9zdG5hbWUgPT09IGRvbWFpbiB8fCBob3N0bmFtZS5lbmRzV2l0aCgnLicgKyBkb21haW4pKTsKICAgIH0KCiAgICBmdW5jdGlvbiB3YWl0RE9NRWxlbWVudChzZWxlY3RvciwgdGFnTmFtZSA9ICcnLCBjYWxsYmFjaywgbXVsdGlwbGUgPSBmYWxzZSkgewogICAgICAgIG5ldyB3aW5kb3cuTXV0YXRpb25PYnNlcnZlcihmdW5jdGlvbiAobXV0YXRpb25zKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgbXV0YXRpb24gb2YgbXV0YXRpb25zKSB7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IG5vZGUgb2YgbXV0YXRpb24uYWRkZWROb2RlcykgewogICAgICAgICAgICAgICAgICAgIGlmICghdGFnTmFtZSB8fCAobm9kZS50YWdOYW1lID09PSB0YWdOYW1lKSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5tYXRjaGVzKHNlbGVjdG9yKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sobm9kZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIW11bHRpcGxlKSB7IHRoaXMuZGlzY29ubmVjdCgpOyB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9KS5vYnNlcnZlKGRvY3VtZW50LCB7CiAgICAgICAgICAgIHN1YnRyZWU6IHRydWUsCiAgICAgICAgICAgIGNoaWxkTGlzdDogdHJ1ZQogICAgICAgIH0pOwogICAgfQoKICAgIGZ1bmN0aW9uIHJlbW92ZURPTUVsZW1lbnQoLi4uZWxlbWVudHMpIHsKICAgICAgICBmb3IgKGNvbnN0IGVsZW1lbnQgb2YgZWxlbWVudHMpIHsKICAgICAgICAgICAgaWYgKGVsZW1lbnQpIHsgZWxlbWVudC5yZW1vdmUoKTsgfQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiByZW1vdmVDbGFzc2VzQnlQcmVmaXgoZWwsIHByZWZpeCkgewogICAgICAgIGZvciAoY29uc3QgY2xhenogb2YgZWwuY2xhc3NMaXN0KSB7CiAgICAgICAgICAgIGlmIChjbGF6ei5zdGFydHNXaXRoKHByZWZpeCkpIHsKICAgICAgICAgICAgICAgIGVsLmNsYXNzTGlzdC5yZW1vdmUoY2xhenopOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8vIFByZXZlbnQgZWxlbWVudCBmcm9tIGJlaW5nIGFkZGVkIHRoZSBmaXJzdCB0aW1lIHRvIHRoZSBET00KICAgIGZ1bmN0aW9uIGJsb2NrRWxlbWVudChzZWxlY3RvciwgYmxvY2tBbHdheXMgPSBmYWxzZSkgewogICAgICAgIG5ldyB3aW5kb3cuTXV0YXRpb25PYnNlcnZlcihmdW5jdGlvbiAobXV0YXRpb25zKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgbXV0YXRpb24gb2YgbXV0YXRpb25zKSB7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IG5vZGUgb2YgbXV0YXRpb24uYWRkZWROb2RlcykgewogICAgICAgICAgICAgICAgICAgIGlmIChub2RlIGluc3RhbmNlb2Ygd2luZG93LkhUTUxFbGVtZW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChub2RlLm1hdGNoZXMoc2VsZWN0b3IpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZW1vdmVET01FbGVtZW50KG5vZGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFibG9ja0Fsd2F5cykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGlzY29ubmVjdCgpOyAvLyBTdG9wIHdhdGNoaW5nIGZvciBlbGVtZW50IGJlaW5nIGFkZGVkIGFmdGVyIG9uZSByZW1vdmFsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9KS5vYnNlcnZlKGRvY3VtZW50LCB7IHN1YnRyZWU6IHRydWUsIGNoaWxkTGlzdDogdHJ1ZSB9KTsKICAgIH0KCiAgICBmdW5jdGlvbiBhbXBVbmhpZGVTdWJzY3JpcHRpb25zU2VjdGlvbihhbXBBZHNTZWwgPSAnYW1wLWFkLCAuYWQnKSB7CiAgICAgICAgY29uc3QgcHJldmlldyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tzdWJzY3JpcHRpb25zLXNlY3Rpb249ImNvbnRlbnQtbm90LWdyYW50ZWQiXScpOwogICAgICAgIHJlbW92ZURPTUVsZW1lbnQocHJldmlldyk7CiAgICAgICAgY29uc3Qgc3Vic2NyaXB0aW9uc1NlY3Rpb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdbc3Vic2NyaXB0aW9ucy1zZWN0aW9uPSJjb250ZW50Il0nKTsKICAgICAgICBmb3IgKGNvbnN0IGVsZW0gb2Ygc3Vic2NyaXB0aW9uc1NlY3Rpb24pIHsKICAgICAgICAgICAgZWxlbS5yZW1vdmVBdHRyaWJ1dGUoJ3N1YnNjcmlwdGlvbnMtc2VjdGlvbicpOwogICAgICAgIH0KICAgICAgICBjb25zdCBhbXBBZHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGFtcEFkc1NlbCk7CiAgICAgICAgcmVtb3ZlRE9NRWxlbWVudCguLi5hbXBBZHMpOwogICAgfQoKICAgIGNvbnN0IHJlc3RyaWN0aW9ucyA9IHsKICAgICAgICAnYWR3ZWVrLmNvbSc6IC9eKCg/IVwuYWR3ZWVrXC5jb21cLyguK1wvKT8oYW1wfGFnZW5jeXNweXx0dm5ld3Nlcnx0dnNweSlcLykuKSokLywKICAgICAgICAnYmFycm9ucy5jb20nOiAvLitcLmJhcnJvbnNcLmNvbVwvKGFtcFwvKT9hcnRpY2xlKHMpP1wvLisvLAogICAgICAgICdlY29ub21pc3QuY29tJzogLy4rZWNvbm9taXN0XC5jb21cLy4rXC9cZHsxLDR9XC9cZHsxLDJ9XC9cZHsyfVwvLisvLAogICAgICAgICdzZWVraW5nYWxwaGEuY29tJzogLy4rc2Vla2luZ2FscGhhXC5jb21cL2FydGljbGVcLy4rLywKICAgICAgICAndGVjaGluYXNpYS5jb20nOiAvXC50ZWNoaW5hc2lhXC5jb21cLy4rLywKICAgICAgICAnZnQuY29tJzogLy4rXC5mdC5jb21cL2NvbnRlbnRcLy8sCiAgICAgICAgJ255dGltZXMuY29tJzogL14oKD8hXC90aW1lc21hY2hpbmVcLm55dGltZXNcLmNvbVwvKS4pKiQvCiAgICB9OwoKICAgIC8vIERvbid0IHJlbW92ZSBjb29raWVzIGJlZm9yZSBwYWdlIGxvYWQKICAgIGNvbnN0IGFsbG93Q29va2llcyA9IFsKICAgICAgICAnYnJpc2JhbmV0aW1lcy5jb20uYXUnLAogICAgICAgICdjYW5iZXJyYXRpbWVzLmNvbS5hdScsCiAgICAgICAgJ2Nlbi5hY3Mub3JnJywKICAgICAgICAnZGVtb3JnZW4uYmUnLAogICAgICAgICdkZW52ZXJwb3N0LmNvbScsCiAgICAgICAgJ2V4YW1pbmVyLmNvbS5hdScsCiAgICAgICAgJ2dlbG9jYWwuaXQnLAogICAgICAgICdncnVic3RyZWV0LmNvbScsCiAgICAgICAgJ2hhcnBlcnMub3JnJywKICAgICAgICAnaGJyLm9yZycsCiAgICAgICAgJ2h1bW8uYmUnLAogICAgICAgICdsZXNlY2hvcy5mcicsCiAgICAgICAgJ2xyYi5jby51aycsCiAgICAgICAgJ21lZGl1bS5jb20nLAogICAgICAgICdtZXJjdXJ5bmV3cy5jb20nLAogICAgICAgICduZXdzdGF0ZXNtYW4uY29tJywKICAgICAgICAnbnJjLm5sJywKICAgICAgICAnbnltYWcuY29tJywKICAgICAgICAnb2NyZWdpc3Rlci5jb20nLAogICAgICAgICdwYXJvb2wubmwnLAogICAgICAgICdxei5jb20nLAogICAgICAgICdzY2llbnRpZmljYW1lcmljYW4uY29tJywKICAgICAgICAnc2VhdHRsZXRpbWVzLmNvbScsCiAgICAgICAgJ3NlZWtpbmdhbHBoYS5jb20nLAogICAgICAgICdzb2ZyZXAuY29tJywKICAgICAgICAnc3BlY3RhdG9yLmNvLnVrJywKICAgICAgICAnc3BlbGQubmwnLAogICAgICAgICd0ZWNoaW5hc2lhLmNvbScsCiAgICAgICAgJ3RlbGVncmFhZi5ubCcsCiAgICAgICAgJ3RoZS1hbWVyaWNhbi1pbnRlcmVzdC5jb20nLAogICAgICAgICd0aGVhZHZvY2F0ZS5jb20uYXUnLAogICAgICAgICd0aGVhZ2UuY29tLmF1JywKICAgICAgICAndGhlYXRsYW50aWMuY29tJywKICAgICAgICAndGhlYXVzdHJhbGlhbi5jb20uYXUnLAogICAgICAgICd0aGVjdXQuY29tJywKICAgICAgICAndGhlZGlwbG9tYXQuY29tJywKICAgICAgICAndGhlbWVyY3VyeS5jb20uYXUnLAogICAgICAgICd0b3dhcmRzZGF0YXNjaWVuY2UuY29tJywKICAgICAgICAndHJvdXcubmwnLAogICAgICAgICd2bi5ubCcsCiAgICAgICAgJ3ZvbGtza3JhbnQubmwnLAogICAgICAgICd2dWx0dXJlLmNvbScsCiAgICAgICAgJ256ei5jaCcsCiAgICAgICAgJ3RoZWhpbmR1LmNvbScsCiAgICAgICAgJ2ZpbmFuY2lhbHBvc3QuY29tJywKICAgICAgICAnaGFhcmV0ei5jby5pbCcsCiAgICAgICAgJ2hhYXJldHouY29tJywKICAgICAgICAndGhlbWFya2VyLmNvbScsCiAgICAgICAgJ3N1ZWRkZXV0c2NoZS5kZScsCiAgICAgICAgJ2dlbG9jYWwuaXQnLAogICAgICAgICdlbG11bmRvLmVzJywKICAgICAgICAndGltZS5jb20nLAogICAgICAgICd6ZWl0LmRlJywKICAgICAgICAnZXhwYW5zaW9uLmNvbScsCiAgICAgICAgJ2RhaWx5dGVsZWdyYXBoLmNvbS5hdScsCiAgICAgICAgJ3dhc2hpbmd0b25wb3N0LmNvbScKICAgIF07CgogICAgLy8gUmVtb3ZlcyBjb29raWVzIGFmdGVyIHBhZ2UgbG9hZAogICAgY29uc3QgcmVtb3ZlQ29va2llcyA9IFsKICAgICAgICAnYmxvb21iZXJnLmNvbScsCiAgICAgICAgJ2Jsb29tYmVyZ3F1aW50LmNvbScsCiAgICAgICAgJ2JyaXNiYW5ldGltZXMuY29tLmF1JywKICAgICAgICAnY2FuYmVycmF0aW1lcy5jb20uYXUnLAogICAgICAgICdjZW4uYWNzLm9yZycsCiAgICAgICAgJ2RlbW9yZ2VuLmJlJywKICAgICAgICAnZGVudmVycG9zdC5jb20nLAogICAgICAgICdleGFtaW5lci5jb20uYXUnLAogICAgICAgICdnbG9iZXMuY28uaWwnLAogICAgICAgICdncnVic3RyZWV0LmNvbScsCiAgICAgICAgJ2hhcnBlcnMub3JnJywKICAgICAgICAnaGJyLm9yZycsCiAgICAgICAgJ2h1bW8uYmUnLAogICAgICAgICdsZXNlY2hvcy5mcicsCiAgICAgICAgJ21lcmN1cnluZXdzLmNvbScsCiAgICAgICAgJ25ld3N0YXRlc21hbi5jb20nLAogICAgICAgICducmMubmwnLAogICAgICAgICdueW1hZy5jb20nLAogICAgICAgICdvY3JlZ2lzdGVyLmNvbScsCiAgICAgICAgJ3F6LmNvbScsCiAgICAgICAgJ3NjaWVudGlmaWNhbWVyaWNhbi5jb20nLAogICAgICAgICdzZWF0dGxldGltZXMuY29tJywKICAgICAgICAnc29mcmVwLmNvbScsCiAgICAgICAgJ3NwZWN0YXRvci5jby51aycsCiAgICAgICAgJ3NwZWxkLm5sJywKICAgICAgICAndGVsZWdyYWFmLm5sJywKICAgICAgICAndGhlYWR2b2NhdGUuY29tLmF1JywKICAgICAgICAndGhlYWdlLmNvbS5hdScsCiAgICAgICAgJ3RoZWF0bGFudGljLmNvbScsCiAgICAgICAgJ3RoZWN1dC5jb20nLAogICAgICAgICd0aGVkaXBsb21hdC5jb20nLAogICAgICAgICd0b3dhcmRzZGF0YXNjaWVuY2UuY29tJywKICAgICAgICAndm4ubmwnLAogICAgICAgICd2dWx0dXJlLmNvbScsCiAgICAgICAgJ3dzai5jb20nLAogICAgICAgICdtZWRpdW0uY29tJywKICAgICAgICAnd2FzaGluZ3RvbnBvc3QuY29tJywKICAgICAgICAnamFwYW50aW1lcy5jby5qcCcsCiAgICAgICAgJ255dGltZXMuY29tJwogICAgXTsKCiAgICAvLyBDb250YWlucyByZW1vdmUgY29va2llIHNpdGVzIGFib3ZlIHBsdXMgYW55IGN1c3RvbSBzaXRlcwogICAgbGV0IF9yZW1vdmVDb29raWVzID0gcmVtb3ZlQ29va2llczsKCiAgICAvLyBzZWxlY3Qgc3BlY2lmaWMgY29va2llKHMpIHRvIGhvbGQgZnJvbSByZW1vdmVDb29raWVzIGRvbWFpbnMKICAgIGNvbnN0IHJlbW92ZUNvb2tpZXNTZWxlY3RIb2xkID0gewogICAgICAgICdxei5jb20nOiBbJ2dkcHInXSwKICAgICAgICAnd3NqLmNvbSc6IFsnd3NqcmVnaW9uJ10sCiAgICAgICAgJ3NlYXR0bGV0aW1lcy5jb20nOiBbJ3N0X25ld3NsZXR0ZXJfc3BsYXNoX3NlZW4nXQogICAgfTsKCiAgICAvLyBzZWxlY3Qgb25seSBzcGVjaWZpYyBjb29raWUocykgdG8gZHJvcCBmcm9tIHJlbW92ZUNvb2tpZXMgZG9tYWlucwogICAgY29uc3QgcmVtb3ZlQ29va2llc1NlbGVjdERyb3AgPSB7CiAgICAgICAgJ2FtYml0by5jb20nOiBbJ1RETm90ZXNSZWFkJ10sCiAgICAgICAgJ2RlbW9yZ2VuLmJlJzogWydUSURfSUQnXSwKICAgICAgICAnZmQubmwnOiBbJ3NvY2lhbHJlYWQnXSwKICAgICAgICAnaHVtby5iZSc6IFsnVElEX0lEJ10sCiAgICAgICAgJ25yYy5ubCc6IFsnY291bnRlciddLAogICAgICAgICdzcGVsZC5ubCc6IFsnc3BlbGQtcGF5d2FsbCddCiAgICB9OwoKICAgIC8vIE92ZXJyaWRlIFVzZXItQWdlbnQgd2l0aCBHb29nbGVib3QKICAgIGNvbnN0IHVzZUdvb2dsZUJvdFNpdGVzID0gWwogICAgICAgICdhZGVsYWlkZW5vdy5jb20uYXUnLAogICAgICAgICdiYXJyb25zLmNvbScsCiAgICAgICAgJ2NvdXJpZXJtYWlsLmNvbS5hdScsCiAgICAgICAgJ2ZkLm5sJywKICAgICAgICAnZ2Vub21ld2ViLmNvbScsCiAgICAgICAgJ2hlcmFsZHN1bi5jb20uYXUnLAogICAgICAgICdsYXZvaXhkdW5vcmQuZnInLAogICAgICAgICdudG5ld3MuY29tLmF1JywKICAgICAgICAncXVvcmEuY29tJywKICAgICAgICAnc2Vla2luZ2FscGhhLmNvbScsCiAgICAgICAgJ3RlbGVncmFwaC5jby51aycsCiAgICAgICAgJ3RoZWF1c3RyYWxpYW4uY29tLmF1JywKICAgICAgICAndGhlbWVyY3VyeS5jb20uYXUnLAogICAgICAgICd0aGVuYXRpb25hbC5zY290JywKICAgICAgICAnd3NqLmNvbScsCiAgICAgICAgJ2thbnNhc2NpdHkuY29tJywKICAgICAgICAncmVwdWJsaWMucnUnLAogICAgICAgICduenouY2gnLAogICAgICAgICdkZi5jbCcsCiAgICAgICAgJ2Z0LmNvbScsCiAgICAgICAgJ3dpcmVkLmNvbScsCiAgICAgICAgJ3plaXQuZGUnCiAgICBdOwoKICAgIC8vIE92ZXJyaWRlIFVzZXItQWdlbnQgd2l0aCBCaW5nYm90CiAgICBjb25zdCB1c2VCaW5nQm90ID0gW107CgogICAgY29uc3QgdXNlTXNuQm90ID0gWwogICAgICAgICdoYWFyZXR6LmNvLmlsJywKICAgICAgICAnaGFhcmV0ei5jb20nLAogICAgICAgICd0aGVtYXJrZXIuY29tJwogICAgXTsKCiAgICAvLyBDb250YWlucyBnb29nbGUgYm90IHNpdGVzIGFib3ZlIHBsdXMgYW55IGN1c3RvbSBzaXRlcwogICAgbGV0IF91c2VHb29nbGVCb3RTaXRlcyA9IHVzZUdvb2dsZUJvdFNpdGVzOwoKICAgIGZ1bmN0aW9uIHNldERlZmF1bHRPcHRpb25zKCkgewogICAgICAgIGV4dGVuc2lvbkFwaS5zdG9yYWdlLnN5bmMuc2V0KHsKICAgICAgICAgICAgc2l0ZXM6IGRlZmF1bHRTaXRlcwogICAgICAgIH0sIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZXh0ZW5zaW9uQXBpLnJ1bnRpbWUub3Blbk9wdGlvbnNQYWdlKCk7CiAgICAgICAgfSk7CiAgICB9CgogICAgLy8gQmxvY2sgZXh0ZXJuYWwgc2NyaXB0cwogICAgY29uc3QgYmxvY2tlZFJlZ2V4ZXMgPSB7CiAgICAgICAgJ2Fkd2Vlay5jb20nOiAvLitcLmxpZ2h0Ym94Y2RuXC5jb21cLy4rLywKICAgICAgICAnYWZyLmNvbSc6IC9hZnJcLmNvbVwvYXNzZXRzXC92ZW5kb3JzUmVhY3RSZWR1eF9jbGllbnQuK1wuanMvLAogICAgICAgICdidXNpbmVzc2luc2lkZXIuY29tJzogLyguK1wudGlueXBhc3NcLmNvbVwvLit8Y2RuXC5vbmVzaWduYWxcLmNvbVwvc2Rrc1wvLitcLmpzKS8sCiAgICAgICAgJ2NoaWNhZ290cmlidW5lLmNvbSc6IC8uKzpcL1wvLitcLnRyaWJkc3NcLmNvbVwvLywKICAgICAgICAnZWNvbm9taXN0LmNvbSc6IC8oLitcLnRpbnlwYXNzXC5jb21cLy4rfGVjb25vbWlzdFwuY29tXC9lbmdhc3NldHNcL19uZXh0XC9zdGF0aWNcL2NodW5rc1wvZnJhbWV3b3JrLitcLmpzKS8sCiAgICAgICAgJ2VkaXRvcmlhbGVkb21hbmkuaXQnOiAvKGpzXC5wZWxjcm9cLmNvbVwvLit8ZWRpdG9yaWFsZWRvbWFuaS5pdFwvcGVsY3JvXC5qcykvLAogICAgICAgICdmb3JlaWducG9saWN5LmNvbSc6IC8oY2RuXC5jeGVuc2VcLmNvbVwvfFwudGlueXBhc3NcLmNvbVwvKS8sCiAgICAgICAgJ2ZvcnR1bmUuY29tJzogLy4rXC50aW55cGFzc1wuY29tXC8uKy8sCiAgICAgICAgJ2hhYXJldHouY28uaWwnOiAvaGFhcmV0elwuY29cLmlsXC9odHpcL2pzXC9pbnRlclwuanMvLAogICAgICAgICdoYWFyZXR6LmNvbSc6IC9oYWFyZXR6XC5jb21cL2hkY1wvd2ViXC9qc1wvbWluaWZpZWRcL2hlYWRlci1zY3JpcHRzLWludC5qcy4rLywKICAgICAgICAnaW5xdWlyZXIuY29tJzogLy4rXC50aW55cGFzc1wuY29tXC8uKy8sCiAgICAgICAgJ2xhc3RhbXBhLml0JzogLy4rXC5yZXBzdGF0aWNcLml0XC9taW5pZnlcL3NpdGVzXC9sYXN0YW1wYVwvLitcL2NvbmZpZ1wuY2FjaGVcLnBocFw/bmFtZT1zb2NpYWxfanMvLAogICAgICAgICdscmIuY28udWsnOiAvLitcLnRpbnlwYXNzXC5jb21cLy4rLywKICAgICAgICAnbWVkc2NhcGUuY29tJzogLy4rXC5tZWRzY2FwZXN0YXRpY1wuY29tXC8uKm1lZHNjYXBlLWxpYnJhcnlcLmpzLywKICAgICAgICAnaW50ZXJlc3QuY28ubnonOiAvKC4rXC5wcmVzc3BhdHJvblwuY29tLit8LitpbnRlcmVzdFwuY29cLm56LitwcC1hYmxvY2stYmFubmVyXC5qcykvLAogICAgICAgICdyZXB1YmJsaWNhLml0JzogL3NjcmlwdHNcLnJlcHViYmxpY2FcLml0XC9wd1wvcHdcLmpzLisvLAogICAgICAgICdzcGVjdGF0b3IuY28udWsnOiAvLitcLnRpbnlwYXNzXC5jb21cLy4rLywKICAgICAgICAnc3BlY3RhdG9yLmNvbS5hdSc6IC8uK1wudGlueXBhc3NcLmNvbVwvLisvLAogICAgICAgICd0ZWxlZ3JhcGguY28udWsnOiAvLit0ZWxlZ3JhcGhcLmNvXC51ay4rbWFydGVjaC4rLywKICAgICAgICAndGhlY291cmllci5jb20uYXUnOiAvLitjZG4tYXVcLnBpYW5vXC5pb1wvYXBpXC90aW55cGFzcy4rXC5qcy8sCiAgICAgICAgJ3RoZW5hdGlvbi5jb20nOiAvdGhlbmF0aW9uXC5jb21cLy4rXC9wYXl3YWxsLXNjcmlwdFwucGhwLywKICAgICAgICAndGhlbmF0aW9uYWwuc2NvdCc6IC8oLitcLnRpbnlwYXNzXC5jb21cLy4rfC4rdGhlbmF0aW9uYWxcLnNjb3QuK29tbml0dXJlXC5qc3wuK3RoZW5hdGlvbmFsXC5zY290LityZXNwb25zaXZlLXN5bmMuKykvLAogICAgICAgICd0aGV3cmFwLmNvbSc6IC90aGV3cmFwXC5jb21cLy4rXC93YWxsa2l0XC5qcy8sCiAgICAgICAgJ3dzai5jb20nOiAvY2RuXC5hbXBwcm9qZWN0XC5vcmdcL3ZcZFwvYW1wLWFjY2Vzcy0uK1wuanMvLAogICAgICAgICdoaXN0b3J5ZXh0cmEuY29tJzogLy4rXC5ldm9sb2tcLm5ldFwvLitcL2F1dGhvcml6ZVwvLisvLAogICAgICAgICdiYXJyb25zLmNvbSc6IC9jZG5cLmFtcHByb2plY3RcLm9yZ1wvdlxkXC9hbXAtYWNjZXNzLS4rXC5qcy8sCiAgICAgICAgJ2lyaXNodGltZXMuY29tJzogL2NkblwuYW1wcHJvamVjdFwub3JnXC92XGRcL2FtcC1hY2Nlc3MtLitcLmpzLywKICAgICAgICAnZWxtZXJjdXJpby5jb20nOiAvKG1lcnJlYWRlclwuZW1vbFwuY2xcL2Fzc2V0c1wvanNcL21lclByYW1WMi5qc3xzdGF0aWNtZXJcLmVtb2xcLmNsXC9qc1wvaW52ZXJzaW9uZXNcL1ByYW1Nb2RhbC4rXC5qcykvLAogICAgICAgICdzbG9hbnJldmlldy5taXQuZWR1JzogLyguK1wudGlueXBhc3NcLmNvbVwvLit8LitcLm5ldGRuYS1zc2xcLmNvbVwvd3AtY29udGVudFwvdGhlbWVzXC9zbXJcL2Fzc2V0c1wvanNcL2xpYnNcL3dlbGNvbWUtYWRcLmpzKS8sCiAgICAgICAgJ2xhdGVyY2VyYS5jb20nOiAvLitcLmN4ZW5zZVwuY29tXC8rLywKICAgICAgICAnbGVzZWNob3MuZnInOiAvLitcLnRpbnlwYXNzXC5jb21cLy4rLywKICAgICAgICAndGhlaGluZHUuY29tJzogL2FqYXhcLmNsb3VkZmxhcmVcLmNvbVwvY2RuLWNnaVwvc2NyaXB0c1wvLitcL2Nsb3VkZmxhcmUtc3RhdGljXC9yb2NrZXQtbG9hZGVyXC5taW5cLmpzLywKICAgICAgICAndGVjaG5vbG9neXJldmlldy5jb20nOiAvLitcLmJsdWVjb25pY1wubmV0XC8uKy8sCiAgICAgICAgJ3NwZWN0YXRvci51cyc6IC8oY2RuXC5jeGVuc2VcLmNvbVwvLit8XC50aW55cGFzc1wuY29tXC8uKykvLAogICAgICAgICdnZWxvY2FsLml0JzogLyhcLnJlcHN0YXRpY1wuaXRcL21pbmlmeVwvc2l0ZXNcL2dlbG9jYWxcLy4rXC9jb25maWdcLmNhY2hlKF9cZCk/XC5waHB8Y2RuXC5hbXBwcm9qZWN0XC5vcmdcL3ZcZFwvYW1wLShhY2Nlc3N8YWQpLS4rXC5qcykvLAogICAgICAgICdlbG11bmRvLmVzJzogL2NkblwuYW1wcHJvamVjdFwub3JnXC92XGRcL2FtcC0oYWNjZXNzfGFkfGNvbnNlbnQpLS4rXC5qcy8sCiAgICAgICAgJ3RpbWUuY29tJzogL1wvdGltZVwuY29tXC9kaXN0XC9tZXRlci13YWxsLWNsaWVudC1qc1wuLitcLmpzLywKICAgICAgICAndGhlc3Rhci5jb20nOiAvXC5jb21cL2FwaVwvb3ZlcmxheWRhdGEvLAogICAgICAgICdlbHBhaXMuY29tJzogLyhcLmVwaW1nXC5uZXRcL2pzXC8uK1wvKG5vdGljaWF8dXNlcilcLm1pblwuanN8XC9lbHBhaXNcLmNvbVwvYXJjXC9zdWJzXC9wXC5taW5cLmpzfGNkblwuYW1wcHJvamVjdFwub3JnXC92XGRcL2FtcC0oYWNjZXNzfChzdGlja3ktKT9hZHxjb25zZW50KS0uK1wuanMpLywKICAgICAgICAnZXhwYW5zaW9uLmNvbSc6IC9jZG5cLmFtcHByb2plY3RcLm9yZ1wvdlxkXC9hbXAtKGFjY2Vzc3xhZHxjb25zZW50KS0uK1wuanMvLAogICAgICAgICdjaGljYWdvYnVzaW5lc3MuY29tJzogLyhcLnRpbnlwYXNzXC5jb21cL3xcLmNoaWNhZ29idXNpbmVzc1wuY29tXC8uK1wvanNcL2pzXy4rXC5qcykvLAogICAgICAgICdkYWlseXRlbGVncmFwaC5jb20uYXUnOiAvY2RuXC5hbXBwcm9qZWN0XC5vcmdcL3ZcZFwvYW1wLShhY2Nlc3N8YWR8Y29uc2VudCktLitcLmpzLywKICAgICAgICAndGhlZ2xvYmVhbmRtYWlsLmNvbSc6IC8oXC50aGVnbG9iZWFuZG1haWxcLmNvbVwvcGZcL2Rpc3RcL2VuZ2luZVwvcmVhY3RcLmpzfHNtYXJ0d2FsbFwudGhlZ2xvYmVhbmRtYWlsXC5jb21cLykvLAogICAgICAgICdueXRpbWVzLmNvbSc6IC8oXC5ueXRpbWVzXC5jb21cL21ldGVyXC5qc3xtd2NtXC5ueXRcLmNvbVwvLitcLmpzfGNvb2tpbmdcLm55dGltZXNcLmNvbVwvYXBpXC8uK1wvYWNjZXNzKS8sCiAgICAgICAgJ2xhdGltZXMuY29tJzogLyhtZXRlcmluZ1wucGxhdGZvcm1cLmxhdGltZXNcLmNvbVwvfGNkblwuYW1wcHJvamVjdFwub3JnXC92XGRcL2FtcC0oYWNjZXNzfHN1YnNjcmlwdGlvbnMpLS4rXC5qcykvLAogICAgICAgICd0aGVhdGhsZXRpYy5jb20nOiAvY2RuXC5hbXBwcm9qZWN0XC5vcmdcL3ZcZFwvYW1wLShhY2Nlc3N8c3Vic2NyaXB0aW9ucyktLitcLmpzLywKICAgICAgICAnamFwYW50aW1lcy5jby5qcCc6IC9jZG5cLmN4ZW5zZVwuY29tXC8vLAogICAgICAgICdzY21wLmNvbSc6IC8oXC50aW55cGFzc1wuY29tXC98Y2RuXC5hbXBwcm9qZWN0XC5vcmdcL3ZcZFwvYW1wLWFjY2Vzcy0uK1wuanMpLywKICAgICAgICAnaWxtZXNzYWdnZXJvLml0JzogLyh1dGlsc1wuY2Vkc2RpZ2l0YWxcLml0XC9qc1wvUGF5d2FsbE1ldGVyXC5qcykvLAogICAgICAgICd3YXNoaW5ndG9ucG9zdC5jb20nOiAvXC53YXNoaW5ndG9ucG9zdFwuY29tXC90ZXRyb1wvbWV0ZXJpbmdcL2V2YWx1YXRlLwogICAgfTsKCiAgICBjb25zdCB1c2VyQWdlbnREZXNrdG9wID0gJ01vemlsbGEvNS4wIChjb21wYXRpYmxlOyBHb29nbGVib3QvMi4xOyAraHR0cDovL3d3dy5nb29nbGUuY29tL2JvdC5odG1sKSc7CiAgICBjb25zdCB1c2VyQWdlbnRNb2JpbGUgPSAnQ2hyb21lLzQxLjAuMjI3Mi45NiBNb2JpbGUgU2FmYXJpLzUzNy4zNiAoY29tcGF0aWJsZSA7IEdvb2dsZWJvdC8yLjEgOyAraHR0cDovL3d3dy5nb29nbGUuY29tL2JvdC5odG1sKSc7CiAgICBjb25zdCB1c2VyQWdlbnREZXNrdG9wQmluZ0JvdCA9ICdNb3ppbGxhLzUuMCAoY29tcGF0aWJsZTsgYmluZ2JvdC8yLjA7ICtodHRwOi8vd3d3LmJpbmcuY29tL2Jpbmdib3QuaHRtKSc7CiAgICBjb25zdCB1c2VyQWdlbnRNb2JpbGVCaW5nQm90ID0gJ0Nocm9tZS84MC4wLjM5ODcuOTIgTW9iaWxlIFNhZmFyaS81MzcuMzYgKGNvbXBhdGlibGU7IGJpbmdib3QvMi4wOyAraHR0cDovL3d3dy5iaW5nLmNvbS9iaW5nYm90Lmh0bSknOwogICAgY29uc3QgdXNlckFnZW50TXNuQm90ID0gJ21zbmJvdC8yLjBiICgraHR0cDovL3NlYXJjaC5tc24uY29tL21zbmJvdC5odG0pJzsKCiAgICBsZXQgZW5hYmxlZFNpdGVzID0gW107CgogICAgLy8gR2V0IHRoZSBlbmFibGVkIHNpdGVzCiAgICBleHRlbnNpb25BcGkuc3RvcmFnZS5zeW5jLmdldCh7CiAgICAgICAgc2l0ZXM6IHt9LAogICAgICAgIGN1c3RvbVNpdGVzOiBbXQogICAgfSwgZnVuY3Rpb24gKGl0ZW1zKSB7CiAgICAgICAgZW5hYmxlZFNpdGVzID0gT2JqZWN0LnZhbHVlcyhpdGVtcy5zaXRlcykuY29uY2F0KGl0ZW1zLmN1c3RvbVNpdGVzKTsKCiAgICAgICAgLy8gVXNlIGdvb2dsZWJvdCBVQSBmb3IgY3VzdG9tIHNpdGVzCiAgICAgICAgX3VzZUdvb2dsZUJvdFNpdGVzID0gdXNlR29vZ2xlQm90U2l0ZXMuY29uY2F0KGl0ZW1zLmN1c3RvbVNpdGVzKTsKCiAgICAgICAgLy8gUmVtb3ZlIGNvb2tpZXMgZm9yIGN1c3RvbSBzaXRlcwogICAgICAgIF9yZW1vdmVDb29raWVzID0gcmVtb3ZlQ29va2llcy5jb25jYXQoaXRlbXMuY3VzdG9tU2l0ZXMpOwoKICAgICAgICBpZiAoZXh0ZW5zaW9uQXBpID09PSBjaHJvbWUpIHsKICAgICAgICAgICAgaW5pdEdBKCk7CiAgICAgICAgfQogICAgfSk7CgogICAgLy8gTGlzdGVuIGZvciBjaGFuZ2VzIHRvIG9wdGlvbnMKICAgIGV4dGVuc2lvbkFwaS5zdG9yYWdlLm9uQ2hhbmdlZC5hZGRMaXN0ZW5lcihmdW5jdGlvbiAoY2hhbmdlcywgbmFtZXNwYWNlKSB7CiAgICAgICAgaWYgKGNoYW5nZXMuc2l0ZXMgJiYgY2hhbmdlcy5zaXRlcy5uZXdWYWx1ZSkgewogICAgICAgICAgICBjb25zdCBzaXRlcyA9IGNoYW5nZXMuc2l0ZXMubmV3VmFsdWU7CiAgICAgICAgICAgIGVuYWJsZWRTaXRlcyA9IE9iamVjdC52YWx1ZXMoc2l0ZXMpOwogICAgICAgIH0KICAgIH0pOwoKICAgIC8vIFNldCBhbmQgc2hvdyBkZWZhdWx0IG9wdGlvbnMgb24gaW5zdGFsbAogICAgZXh0ZW5zaW9uQXBpLnJ1bnRpbWUub25JbnN0YWxsZWQuYWRkTGlzdGVuZXIoZnVuY3Rpb24gKGRldGFpbHMpIHsKICAgICAgICBpZiAoZGV0YWlscy5yZWFzb24gPT09ICdpbnN0YWxsJykgewogICAgICAgICAgICBzZXREZWZhdWx0T3B0aW9ucygpOwogICAgICAgIH0gZWxzZSBpZiAoZGV0YWlscy5yZWFzb24gPT09ICd1cGRhdGUnKSB7CiAgICAgICAgICAgIC8vIFVzZXIgdXBkYXRlZCBleHRlbnNpb24KICAgICAgICB9CiAgICB9KTsKCiAgICBleHRlbnNpb25BcGkudGFicy5vblVwZGF0ZWQuYWRkTGlzdGVuZXIoZnVuY3Rpb24gKHRhYklkLCBpbmZvLCB0YWIpIHsKICAgICAgICB1cGRhdGVCYWRnZSh0YWIpOwogICAgfSk7CiAgICBleHRlbnNpb25BcGkudGFicy5vbkFjdGl2YXRlZC5hZGRMaXN0ZW5lcihmdW5jdGlvbiAoYWN0aXZlSW5mbykgewogICAgICAgIGV4dGVuc2lvbkFwaS50YWJzLmdldChhY3RpdmVJbmZvLnRhYklkLCB1cGRhdGVCYWRnZSk7CiAgICB9KTsKCiAgICBmdW5jdGlvbiB1cGRhdGVCYWRnZShhY3RpdmVUYWIpIHsKICAgICAgICBpZiAoZXh0ZW5zaW9uQXBpLnJ1bnRpbWUubGFzdEVycm9yIHx8ICFhY3RpdmVUYWIpIHsgcmV0dXJuOyB9CiAgICAgICAgY29uc3QgYmFkZ2VUZXh0ID0gZ2V0QmFkZ2VUZXh0KGFjdGl2ZVRhYi51cmwpOwogICAgICAgIGV4dGVuc2lvbkFwaS5icm93c2VyQWN0aW9uLnNldEJhZGdlQmFja2dyb3VuZENvbG9yKHsgY29sb3I6ICdibHVlJyB9KTsKICAgICAgICBleHRlbnNpb25BcGkuYnJvd3NlckFjdGlvbi5zZXRCYWRnZVRleHQoeyB0ZXh0OiBiYWRnZVRleHQgfSk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0QmFkZ2VUZXh0KGN1cnJlbnRVcmwpIHsKICAgICAgICByZXR1cm4gY3VycmVudFVybCAmJiBpc1NpdGVFbmFibGVkKHsgdXJsOiBjdXJyZW50VXJsIH0pID8gJ09OJyA6ICcnOwogICAgfQoKICAgIC8vIEFNUCByZWRpcmVjdCBmb3IgZGFpbHl0ZWxlZ3JhcGguY29tLmF1CiAgICBleHRlbnNpb25BcGkud2ViUmVxdWVzdC5vbkJlZm9yZVJlcXVlc3QuYWRkTGlzdGVuZXIoZnVuY3Rpb24gKGRldGFpbHMpIHsKICAgICAgICBpZiAoIWlzU2l0ZUVuYWJsZWQoZGV0YWlscykpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBjb25zdCB1cGRhdGVkVXJsID0gZGVjb2RlVVJJQ29tcG9uZW50KGRldGFpbHMudXJsLnNwbGl0KCcmZGVzdD0nKVsxXS5zcGxpdCgnJicpWzBdKS5yZXBsYWNlKCd3d3cuJywgJ2FtcC4nKTsKICAgICAgICByZXR1cm4geyByZWRpcmVjdFVybDogdXBkYXRlZFVybCB9OwogICAgfSwKICAgICAgICB7IHVybHM6IFsnKjovL3d3dy5kYWlseXRlbGVncmFwaC5jb20uYXUvc3Vic2NyaWJlLyonXSwgdHlwZXM6IFsnbWFpbl9mcmFtZSddIH0sCiAgICAgICAgWydibG9ja2luZyddCiAgICApOwoKICAgIC8vIG55dGltZXMuY29tCiAgICBleHRlbnNpb25BcGkud2ViUmVxdWVzdC5vbkhlYWRlcnNSZWNlaXZlZC5hZGRMaXN0ZW5lcihmdW5jdGlvbiAoZGV0YWlscykgewogICAgICAgIGlmICghaXNTaXRlRW5hYmxlZChkZXRhaWxzKSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGxldCBoZWFkZXJzID0gZGV0YWlscy5yZXNwb25zZUhlYWRlcnM7CiAgICAgICAgaGVhZGVycyA9IGhlYWRlcnMubWFwKGZ1bmN0aW9uIChoZWFkZXIpIHsKICAgICAgICAgICAgaWYgKGhlYWRlci5uYW1lID09PSAneC1mcmFtZS1vcHRpb25zJykgeyBoZWFkZXIudmFsdWUgPSAnU0FNRU9SSUdJTic7IH0KICAgICAgICAgICAgcmV0dXJuIGhlYWRlcjsKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICByZXNwb25zZUhlYWRlcnM6IGhlYWRlcnMKICAgICAgICB9OwogICAgfSwgewogICAgICAgIHVybHM6IFsnKjovLyoubnl0aW1lcy5jb20vKiddCiAgICB9LAogICAgICAgIFsnYmxvY2tpbmcnLCAncmVzcG9uc2VIZWFkZXJzJ10pOwoKICAgIC8vIERpc2FibGUgamF2YXNjcmlwdCBmb3IgdGhlc2Ugc2l0ZXMKICAgIGV4dGVuc2lvbkFwaS53ZWJSZXF1ZXN0Lm9uQmVmb3JlUmVxdWVzdC5hZGRMaXN0ZW5lcihmdW5jdGlvbiAoZGV0YWlscykgewogICAgICAgIGNvbnN0IGhlYWRlclJlZmVyZXIgPSBkZXRhaWxzLm9yaWdpblVybCA/IGRldGFpbHMub3JpZ2luVXJsIDogZGV0YWlscy5pbml0aWF0b3I7CiAgICAgICAgaWYgKCFpc1NpdGVFbmFibGVkKGRldGFpbHMpICYmICghZW5hYmxlZFNpdGVzLmluY2x1ZGVzKCdnZW5lcmFscGF5d2FsbGJ5cGFzcycpIHx8IG1hdGNoVXJsRG9tYWluKCdqYXBhbnRpbWVzLmNvLmpwJywgaGVhZGVyUmVmZXJlcikpKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHsgY2FuY2VsOiB0cnVlIH07CiAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgdXJsczogWwogICAgICAgICAgICAgICAgJyo6Ly8qLm5ld3N0YXRlc21hbi5jb20vKicsCiAgICAgICAgICAgICAgICAnKjovLyoub3V0YnJhaW4uY29tLyonLAogICAgICAgICAgICAgICAgJyo6Ly8qLnBpYW5vLmlvLyonLAogICAgICAgICAgICAgICAgJyo6Ly8qLnBvb29sLmZyLyonLAogICAgICAgICAgICAgICAgJyo6Ly8qLnFpb3RhLmNvbS8qJywKICAgICAgICAgICAgICAgICcqOi8vKi50aW55cGFzcy5jb20vKicKICAgICAgICAgICAgXSwKICAgICAgICAgICAgdHlwZXM6IFsnc2NyaXB0J10KICAgICAgICB9LAogICAgICAgIFsnYmxvY2tpbmcnXQogICAgKTsKCiAgICBjb25zdCBleHRyYUluZm9TcGVjID0gWydibG9ja2luZycsICdyZXF1ZXN0SGVhZGVycyddOwogICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChleHRlbnNpb25BcGkud2ViUmVxdWVzdC5PbkJlZm9yZVNlbmRIZWFkZXJzT3B0aW9ucywgJ0VYVFJBX0hFQURFUlMnKSkgewogICAgICAgIGV4dHJhSW5mb1NwZWMucHVzaCgnZXh0cmFIZWFkZXJzJyk7CiAgICB9CgogICAgZXh0ZW5zaW9uQXBpLndlYlJlcXVlc3Qub25CZWZvcmVTZW5kSGVhZGVycy5hZGRMaXN0ZW5lcihmdW5jdGlvbiAoZGV0YWlscykgewogICAgICAgIGxldCByZXF1ZXN0SGVhZGVycyA9IGRldGFpbHMucmVxdWVzdEhlYWRlcnM7CgogICAgICAgIGxldCBoZWFkZXJSZWZlcmVyID0gJyc7CiAgICAgICAgZm9yIChjb25zdCBuIGluIHJlcXVlc3RIZWFkZXJzKSB7CiAgICAgICAgICAgIGlmIChyZXF1ZXN0SGVhZGVyc1tuXS5uYW1lLnRvTG93ZXJDYXNlKCkgPT09ICdyZWZlcmVyJykgewogICAgICAgICAgICAgICAgaGVhZGVyUmVmZXJlciA9IHJlcXVlc3RIZWFkZXJzW25dLnZhbHVlOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIGNoZWNrIGZvciBibG9ja2VkIHJlZ3VsYXIgZXhwcmVzc2lvbjogZG9tYWluIGVuYWJsZWQsIG1hdGNoIHJlZ2V4LCBibG9jayBvbiBhbiBpbnRlcm5hbCBvciBleHRlcm5hbCByZWdleAogICAgICAgIGNvbnN0IGJsb2NrZWREb21haW5zID0gT2JqZWN0LmtleXMoYmxvY2tlZFJlZ2V4ZXMpOwogICAgICAgIGNvbnN0IGRvbWFpbiA9IG1hdGNoVXJsRG9tYWluKGJsb2NrZWREb21haW5zLCBoZWFkZXJSZWZlcmVyKTsKICAgICAgICBpZiAoZG9tYWluICYmIGRldGFpbHMudXJsLm1hdGNoKGJsb2NrZWRSZWdleGVzW2RvbWFpbl0pICYmIGlzU2l0ZUVuYWJsZWQoeyB1cmw6IGhlYWRlclJlZmVyZXIgfSkpIHsKICAgICAgICAgICAgcmV0dXJuIHsgY2FuY2VsOiB0cnVlIH07CiAgICAgICAgfQoKICAgICAgICBpZiAoIWlzU2l0ZUVuYWJsZWQoZGV0YWlscykgJiYgIW1hdGNoVXJsRG9tYWluKCdjZG4uYW1wcHJvamVjdC5vcmcnLCBkZXRhaWxzLnVybCkpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgdGFiSWQgPSBkZXRhaWxzLnRhYklkOwogICAgICAgIGxldCB1c2VVc2VyQWdlbnRNb2JpbGUgPSBmYWxzZTsKICAgICAgICBsZXQgc2V0UmVmZXJlciA9IGZhbHNlOwoKICAgICAgICAvLyBpZiByZWZlcmVyIGV4aXN0cywgc2V0IGl0IHRvIGdvb2dsZQogICAgICAgIHJlcXVlc3RIZWFkZXJzID0gcmVxdWVzdEhlYWRlcnMubWFwKGZ1bmN0aW9uIChyZXF1ZXN0SGVhZGVyKSB7CiAgICAgICAgICAgIGlmIChyZXF1ZXN0SGVhZGVyLm5hbWUgPT09ICdSZWZlcmVyJykgewogICAgICAgICAgICAgICAgaWYgKGRldGFpbHMudXJsLmluY2x1ZGVzKCdjb29raW5nLm55dGltZXMuY29tL2FwaS92MS91c2Vycy9ib290c3RyYXAnKSkgewogICAgICAgICAgICAgICAgICAgIC8vIHRoaXMgZml4ZXMgaW1hZ2VzIG5vdCBiZWluZyBsb2FkZWQgb24gY29va2luZy5ueXRpbWVzLmNvbSBtYWluIHBhZ2UKICAgICAgICAgICAgICAgICAgICAvLyByZWZlcnJlciBoYXMgdG8gYmUgKm55dGltZXMuY29tIG90aGVyd2lzZSByZXR1cm5zIDQwMwogICAgICAgICAgICAgICAgICAgIHJlcXVlc3RIZWFkZXIudmFsdWUgPSAnaHR0cHM6Ly9jb29raW5nLm55dGltZXMuY29tJzsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobWF0Y2hVcmxEb21haW4oJ2ZkLm5sJywgZGV0YWlscy51cmwpKSB7CiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdEhlYWRlci52YWx1ZSA9ICdodHRwczovL3d3dy5mYWNlYm9vay5jb20vJzsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobWF0Y2hVcmxEb21haW4oJ21lZGl1bS5jb20nLCBkZXRhaWxzLnVybCkpIHsKICAgICAgICAgICAgICAgICAgICByZXF1ZXN0SGVhZGVyLnZhbHVlID0gJ2h0dHBzOi8vdC5jby94P2FtcD0xJzsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdEhlYWRlci52YWx1ZSA9ICdodHRwczovL3d3dy5nb29nbGUuY29tLyc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzZXRSZWZlcmVyID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocmVxdWVzdEhlYWRlci5uYW1lID09PSAnVXNlci1BZ2VudCcpIHsKICAgICAgICAgICAgICAgIHVzZVVzZXJBZ2VudE1vYmlsZSA9IHJlcXVlc3RIZWFkZXIudmFsdWUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcygnbW9iaWxlJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiByZXF1ZXN0SGVhZGVyOwogICAgICAgIH0pOwoKICAgICAgICAvLyBvdGhlcndpc2UgYWRkIGl0CiAgICAgICAgaWYgKCFzZXRSZWZlcmVyKSB7CiAgICAgICAgICAgIGlmIChtYXRjaFVybERvbWFpbignZmQubmwnLCBkZXRhaWxzLnVybCkpIHsKICAgICAgICAgICAgICAgIHJlcXVlc3RIZWFkZXJzLnB1c2goewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICdSZWZlcmVyJywKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogJ2h0dHBzOi8vd3d3LmZhY2Vib29rLmNvbS8nCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIGlmIChtYXRjaFVybERvbWFpbignbWVkaXVtLmNvbScsIGRldGFpbHMudXJsKSkgewogICAgICAgICAgICAgICAgcmVxdWVzdEhlYWRlcnMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogJ1JlZmVyZXInLAogICAgICAgICAgICAgICAgICAgIHZhbHVlOiAnaHR0cHM6Ly90LmNvL3g/YW1wPTEnCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJlcXVlc3RIZWFkZXJzLnB1c2goewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICdSZWZlcmVyJywKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogJ2h0dHBzOi8vd3d3Lmdvb2dsZS5jb20vJwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIG92ZXJyaWRlIFVzZXItQWdlbnQgdG8gdXNlIEdvb2dsZWJvdAogICAgICAgIGNvbnN0IHVzZUdvb2dsZUJvdCA9IF91c2VHb29nbGVCb3RTaXRlcy5zb21lKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgIHJldHVybiB0eXBlb2YgaXRlbSA9PT0gJ3N0cmluZycgJiYgbWF0Y2hVcmxEb21haW4oaXRlbSwgZGV0YWlscy51cmwpOwogICAgICAgIH0pOwoKICAgICAgICBpZiAodXNlR29vZ2xlQm90KSB7CiAgICAgICAgICAgIHJlcXVlc3RIZWFkZXJzLnB1c2goewogICAgICAgICAgICAgICAgbmFtZTogJ1VzZXItQWdlbnQnLAogICAgICAgICAgICAgICAgdmFsdWU6IHVzZVVzZXJBZ2VudE1vYmlsZSA/IHVzZXJBZ2VudE1vYmlsZSA6IHVzZXJBZ2VudERlc2t0b3AKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJlcXVlc3RIZWFkZXJzLnB1c2goewogICAgICAgICAgICAgICAgbmFtZTogJ1gtRm9yd2FyZGVkLUZvcicsCiAgICAgICAgICAgICAgICB2YWx1ZTogJzY2LjI0OS42Ni4xJwogICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIC8vIG92ZXJyaWRlIFVzZXItQWdlbnQgdG8gdXNlIEJpbmdib3QKICAgICAgICBpZiAobWF0Y2hVcmxEb21haW4odXNlQmluZ0JvdCwgZGV0YWlscy51cmwpKSB7CiAgICAgICAgICAgIHJlcXVlc3RIZWFkZXJzLnB1c2goewogICAgICAgICAgICAgICAgbmFtZTogJ1VzZXItQWdlbnQnLAogICAgICAgICAgICAgICAgdmFsdWU6IHVzZVVzZXJBZ2VudE1vYmlsZSA/IHVzZXJBZ2VudE1vYmlsZUJpbmdCb3QgOiB1c2VyQWdlbnREZXNrdG9wQmluZ0JvdAogICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIC8vIG92ZXJyaWRlIFVzZXItQWdlbnQgdG8gdXNlIEdvb2dsZSBBZHNCb3QgTW9iaWxlIFdlYgogICAgICAgIGlmIChtYXRjaFVybERvbWFpbih1c2VNc25Cb3QsIGRldGFpbHMudXJsKSkgewogICAgICAgICAgICByZXF1ZXN0SGVhZGVycy5wdXNoKHsKICAgICAgICAgICAgICAgIG5hbWU6ICdVc2VyLUFnZW50JywKICAgICAgICAgICAgICAgIHZhbHVlOiB1c2VyQWdlbnRNc25Cb3QKICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICAvLyByZW1vdmUgY29va2llcyBiZWZvcmUgcGFnZSBsb2FkCiAgICAgICAgY29uc3QgZW5hYmxlZENvb2tpZXMgPSBhbGxvd0Nvb2tpZXMuc29tZShmdW5jdGlvbiAoc2l0ZSkgewogICAgICAgICAgICByZXR1cm4gbWF0Y2hVcmxEb21haW4oc2l0ZSwgZGV0YWlscy51cmwpOwogICAgICAgIH0pOwogICAgICAgIGlmICghZW5hYmxlZENvb2tpZXMpIHsKICAgICAgICAgICAgcmVxdWVzdEhlYWRlcnMgPSByZXF1ZXN0SGVhZGVycy5tYXAoZnVuY3Rpb24gKHJlcXVlc3RIZWFkZXIpIHsKICAgICAgICAgICAgICAgIGlmIChyZXF1ZXN0SGVhZGVyLm5hbWUgPT09ICdDb29raWUnKSB7CiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdEhlYWRlci52YWx1ZSA9ICcnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHJlcXVlc3RIZWFkZXI7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRhYklkICE9PSAtMSkgewogICAgICAgICAgICBleHRlbnNpb25BcGkudGFicy5nZXQodGFiSWQsIGZ1bmN0aW9uIChjdXJyZW50VGFiKSB7CiAgICAgICAgICAgICAgICAvLyBWYWxpZGF0ZSB1cmwgb2YgY3VycmVudCB0YWIgdG8gYXZvaWQgaW5qZWN0aW5nIHNjcmlwdCB0byB1bnJlbGF0ZWQgc2l0ZXMKICAgICAgICAgICAgICAgIGlmIChjdXJyZW50VGFiICYmIGN1cnJlbnRUYWIudXJsICYmIGlzU2l0ZUVuYWJsZWQoY3VycmVudFRhYikpIHsKICAgICAgICAgICAgICAgICAgICAvLyBydW4gY29udGVudFNjcmlwdCBpbnNpZGUgdGFiCiAgICAgICAgICAgICAgICAgICAgZXh0ZW5zaW9uQXBpLnRhYnMuZXhlY3V0ZVNjcmlwdCh0YWJJZCwgewogICAgICAgICAgICAgICAgICAgICAgICBmaWxlOiAnc3JjL2pzL2NvbnRlbnRTY3JpcHQuanMnLAogICAgICAgICAgICAgICAgICAgICAgICBydW5BdDogJ2RvY3VtZW50X3N0YXJ0JwogICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV4dGVuc2lvbkFwaS5ydW50aW1lLmxhc3RFcnJvciB8fCByZXNbMF0pIHsKCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4geyByZXF1ZXN0SGVhZGVyczogcmVxdWVzdEhlYWRlcnMgfTsKICAgIH0sIHsKICAgICAgICB1cmxzOiBbJzxhbGxfdXJscz4nXQogICAgfSwgZXh0cmFJbmZvU3BlYyk7CgogICAgLy8gcmVtb3ZlIGNvb2tpZXMgYWZ0ZXIgcGFnZSBsb2FkCiAgICBleHRlbnNpb25BcGkud2ViUmVxdWVzdC5vbkNvbXBsZXRlZC5hZGRMaXN0ZW5lcihmdW5jdGlvbiAoZGV0YWlscykgewogICAgICAgIGxldCBkb21haW5Ub1JlbW92ZTsKICAgICAgICBmb3IgKGNvbnN0IGRvbWFpbiBvZiBfcmVtb3ZlQ29va2llcykgewogICAgICAgICAgICBpZiAoZW5hYmxlZFNpdGVzLmluY2x1ZGVzKGRvbWFpbikgJiYgbWF0Y2hVcmxEb21haW4oZG9tYWluLCBkZXRhaWxzLnVybCkpIHsKICAgICAgICAgICAgICAgIGRvbWFpblRvUmVtb3ZlID0gZG9tYWluOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGRvbWFpblRvUmVtb3ZlKSB7CiAgICAgICAgICAgIGV4dGVuc2lvbkFwaS5jb29raWVzLmdldEFsbCh7IGRvbWFpbjogZG9tYWluVG9SZW1vdmUgfSwgZnVuY3Rpb24gKGNvb2tpZXMpIHsKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgY2sgb2YgY29va2llcykgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvb2tpZSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiAoY2suc2VjdXJlID8gJ2h0dHBzOi8vJyA6ICdodHRwOi8vJykgKyBjay5kb21haW4gKyBjay5wYXRoLAogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBjay5uYW1lLAogICAgICAgICAgICAgICAgICAgICAgICBzdG9yZUlkOiBjay5zdG9yZUlkCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAvLyAuZmlyc3RQYXJ0eURvbWFpbiA9IHVuZGVmaW5lZCBvbiBDaHJvbWUgKGRvZXNuJ3Qgc3VwcG9ydCBpdCkKICAgICAgICAgICAgICAgICAgICBpZiAoY2suZmlyc3RQYXJ0eURvbWFpbiAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZS5maXJzdFBhcnR5RG9tYWluID0gY2suZmlyc3RQYXJ0eURvbWFpbjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29va2llRG9tYWluID0gY2suZG9tYWluOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJjRG9tYWluID0gY29va2llRG9tYWluLnJlcGxhY2UoL14oXC4/d3d3XC58XC4pLywgJycpOwogICAgICAgICAgICAgICAgICAgIC8vIGhvbGQgc3BlY2lmaWMgY29va2llKHMpIGZyb20gcmVtb3ZlQ29va2llcyBkb21haW5zCiAgICAgICAgICAgICAgICAgICAgaWYgKChyY0RvbWFpbiBpbiByZW1vdmVDb29raWVzU2VsZWN0SG9sZCkgJiYgcmVtb3ZlQ29va2llc1NlbGVjdEhvbGRbcmNEb21haW5dLmluY2x1ZGVzKGNrLm5hbWUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOyAvLyBkb24ndCByZW1vdmUgc3BlY2lmaWMgY29va2llCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIC8vIGRyb3Agb25seSBzcGVjaWZpYyBjb29raWUocykgZnJvbSByZW1vdmVDb29raWVzIGRvbWFpbnMKICAgICAgICAgICAgICAgICAgICBpZiAoKHJjRG9tYWluIGluIHJlbW92ZUNvb2tpZXNTZWxlY3REcm9wKSAmJiAhKHJlbW92ZUNvb2tpZXNTZWxlY3REcm9wW3JjRG9tYWluXS5pbmNsdWRlcyhjay5uYW1lKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7IC8vIG9ubHkgcmVtb3ZlIHNwZWNpZmljIGNvb2tpZQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBleHRlbnNpb25BcGkuY29va2llcy5yZW1vdmUoY29va2llKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfSwgewogICAgICAgIHVybHM6IFsnPGFsbF91cmxzPiddCiAgICB9KTsKCiAgICAvLyBHb29nbGUgQW5hbHl0aWNzIHRvIGFub255bW91c2x5IHRyYWNrIERBVSAoQ2hyb21lIG9ubHkpCiAgICBmdW5jdGlvbiBpbml0R0EoKSB7CiAgICAgICAgKGZ1bmN0aW9uIChpLCBzLCBvLCBnLCByLCBhLCBtKSB7CiAgICAgICAgICAgIGkuR29vZ2xlQW5hbHl0aWNzT2JqZWN0ID0gcjsKICAgICAgICAgICAgaVtyXSA9IGlbcl0gfHwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgKGlbcl0ucSA9IGlbcl0ucSB8fCBbXSkucHVzaChhcmd1bWVudHMpOwogICAgICAgICAgICB9LCBpW3JdLmwgPSAxICogbmV3IERhdGUoKTsKICAgICAgICAgICAgYSA9IHMuY3JlYXRlRWxlbWVudChvKSwgbSA9IHMuZ2V0RWxlbWVudHNCeVRhZ05hbWUobylbMF07CiAgICAgICAgICAgIGEuYXN5bmMgPSAxOwogICAgICAgICAgICBhLnNyYyA9IGc7CiAgICAgICAgICAgIG0ucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoYSwgbSk7CiAgICAgICAgfSkod2luZG93LCBkb2N1bWVudCwgJ3NjcmlwdCcsICdodHRwczovL3d3dy5nb29nbGUtYW5hbHl0aWNzLmNvbS9hbmFseXRpY3MuanMnLCAnZ2EnKTsKICAgICAgICBnYSgnY3JlYXRlJywgJ1VBLTY5ODI0MTY5LTInLCAnYXV0bycpOwogICAgICAgIGdhKCdzZXQnLCAnY2hlY2tQcm90b2NvbFRhc2snLCBudWxsKTsKICAgICAgICBnYSgnc2V0JywgJ2Fub255bWl6ZUlwJywgdHJ1ZSk7CiAgICAgICAgZ2EoJ3NlbmQnLCAncGFnZXZpZXcnKTsKICAgIH0KCiAgICBmdW5jdGlvbiBpc1NpdGVFbmFibGVkKGRldGFpbHMpIHsKICAgICAgICBjb25zdCBlbmFibGVkU2l0ZSA9IG1hdGNoVXJsRG9tYWluKGVuYWJsZWRTaXRlcywgZGV0YWlscy51cmwpOwogICAgICAgIGlmIChlbmFibGVkU2l0ZSBpbiByZXN0cmljdGlvbnMpIHsKICAgICAgICAgICAgcmV0dXJuIHJlc3RyaWN0aW9uc1tlbmFibGVkU2l0ZV0udGVzdChkZXRhaWxzLnVybCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiAhIWVuYWJsZWRTaXRlOwogICAgfQoKICAgIGZ1bmN0aW9uIG1hdGNoVXJsRG9tYWluKGRvbWFpbnMsIHVybCkgewogICAgICAgIHJldHVybiBtYXRjaERvbWFpbihkb21haW5zLCB1cmxIb3N0KHVybCkpOwogICAgfQoKICAgIGZ1bmN0aW9uIG1hdGNoRG9tYWluKGRvbWFpbnMsIGhvc3RuYW1lKSB7CiAgICAgICAgbGV0IG1hdGNoZWREb21haW4gPSBmYWxzZTsKICAgICAgICBpZiAoIWhvc3RuYW1lKSB7IGhvc3RuYW1lID0gd2luZG93LmxvY2F0aW9uLmhvc3RuYW1lOyB9CiAgICAgICAgaWYgKHR5cGVvZiBkb21haW5zID09PSAnc3RyaW5nJykgeyBkb21haW5zID0gW2RvbWFpbnNdOyB9CiAgICAgICAgZG9tYWlucy5zb21lKGRvbWFpbiA9PiAoaG9zdG5hbWUgPT09IGRvbWFpbiB8fCBob3N0bmFtZS5lbmRzV2l0aCgnLicgKyBkb21haW4pKSAmJiAobWF0Y2hlZERvbWFpbiA9IGRvbWFpbikpOwogICAgICAgIHJldHVybiBtYXRjaGVkRG9tYWluOwogICAgfQoKICAgIGZ1bmN0aW9uIHVybEhvc3QodXJsKSB7CiAgICAgICAgaWYgKHVybCAmJiB1cmwuc3RhcnRzV2l0aCgnaHR0cCcpKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFVSTCh1cmwpLmhvc3RuYW1lOwogICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgdXJsIG5vdCB2YWxpZDogJHt1cmx9IGVycm9yOiAke2V9YCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHVybDsKICAgIH0KfSkoKTsK"},{"name":"Soundcloud Anti Repost","options":{"check_for_updates":true,"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_powerful_this":null,"sandbox":null,"noframes":null,"unwrap":null,"run_at":null,"tab_types":null,"override":{"use_includes":[],"orig_includes":["https://soundcloud.com/feed"],"merge_includes":true,"use_matches":[],"orig_matches":[],"merge_matches":true,"use_excludes":[],"orig_excludes":[],"merge_excludes":true,"use_connects":[],"orig_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-end","orig_noframes":null},"user_modified":null},"storage":{"ts":1700733717748,"data":{}},"enabled":true,"position":3,"file_url":"https://update.greasyfork.org/scripts/370377/Soundcloud%20Anti%20Repost.user.js","uuid":"162c7599-fa74-43e9-86fe-2065462cdb62","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICBTb3VuZGNsb3VkIEFudGkgUmVwb3N0Ci8vIEB2ZXJzaW9uICAgICAgMS4yLjMKLy8gQGF1dGhvciAgICAgICBSZWRjcmFmdGVyCi8vIEBkZXNjcmlwdGlvbiAgUmVtb3ZlIHJlcG9zdHMgZnJvbSBzb3VuZGNsb3VkCi8vIEBsaWNlbnNlICAgICAgTUlUCi8vIEBpbmNsdWRlICAgICAgaHR0cHM6Ly9zb3VuZGNsb3VkLmNvbS9mZWVkCi8vIEBydW4tYXQgICAgICAgZG9jdW1lbnQtZW5kCi8vIEBuYW1lc3BhY2UgICAgaHR0cHM6Ly9naXRodWIuY29tL1JlZGNyYWZ0ZXIvCi8vID09L1VzZXJTY3JpcHQ9PQoKZnVuY3Rpb24gcmVtb3ZlUmVwb3N0cygpIHsKICAgIGZvciAoY29uc3QgaXRlbSBvZiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCIuc291bmRMaXN0X19pdGVtIikpIHsKICAgICAgICBpZiAoaXRlbS5xdWVyeVNlbGVjdG9yKCIuc291bmRDb250ZXh0X19yZXBvc3QiKSkgewogICAgICAgICAgICBpdGVtLnJlbW92ZSgpOwogICAgICAgIH0KICAgIH0KfQoKLy8gU2VhcmNoZXMgZm9yIHRoZSBwbGF5ZXJNYW5hZ2VyIG1vZHVsZQpmdW5jdGlvbiBtb2R1bGUoZSwgdCwgX3JlcXVpcmUpIHsKICAgIGxldCBtb2R1bGVzID0gX3JlcXVpcmUuYzsKCiAgICBmb3IgKGxldCBtb2R1bGVpZCBpbiBtb2R1bGVzKSB7CiAgICAgICAgaWYgKG1vZHVsZXMuaGFzT3duUHJvcGVydHkobW9kdWxlaWQpKSB7CiAgICAgICAgICAgIGxldCBlbCA9IF9yZXF1aXJlKG1vZHVsZWlkKTsKCiAgICAgICAgICAgIGlmICh0eXBlb2YgZWwucGxheUN1cnJlbnQgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgICAgIGluaXQoZWwpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0KCmZ1bmN0aW9uIGluaXQocGxheU1hbmFnZXIpIHsKICAgIC8vIEluamVjdCBhIGZ1bmN0aW9uIHRvIGNoZWNrIGZvciByZXBvc3RzCiAgICBsZXQgb2xkU2V0ID0gcGxheU1hbmFnZXIuc2V0Q3VycmVudEl0ZW07CiAgICBwbGF5TWFuYWdlci5zZXRDdXJyZW50SXRlbSA9IChlKSA9PiB7CiAgICAgICAgbGV0IHIgPSBmYWxzZTsKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBOb3Qgc3VyZSBpZiB0aGlzIHNhZmUKICAgICAgICAgICAgciA9IGUuX3N1Ym1vZGVsc1swXS5fZXZlbnRzWyJjaGFuZ2U6dXNlciJdWzFdLmNvbnRleHQub3B0aW9ucy5hY3Rpb25UeXBlID09PSAicmVwb3N0IjsKICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAvLyBjb25zb2xlLmVycm9yKCJBbiBFeGNlcHRpb24gb2Njb3VyZWQgd2hpbGUgdHJ5aW5nIHRvIGRldGVybWluZSByZXBvc3Qgc3RhdHVzIik7CiAgICAgICAgfQoKICAgICAgICBpZiAocikgewogICAgICAgICAgICBwbGF5TWFuYWdlci5yZW1vdmVJdGVtKGUpOwogICAgICAgICAgICBwbGF5TWFuYWdlci5wbGF5TmV4dCgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG9sZFNldChlKTsKICAgICAgICB9CiAgICB9OwoKfQoKc2V0SW50ZXJ2YWwocmVtb3ZlUmVwb3N0cywgNTAwKTsKCi8vIGluamVjdGlvbiBvdXIgb3duIG1vZHVsZQp1bnNhZmVXaW5kb3cud2VicGFja0pzb25wLnB1c2goW1sxMDAwMDAwXSwgeyAxMDAwMDAwOiBtb2R1bGUgfSwgW1sxMDAwMDAwXV1dKTsK"},{"name":"Youtube HD","options":{"check_for_updates":true,"user_modified":null,"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_powerful_this":null,"sandbox":null,"noframes":null,"unwrap":null,"run_at":null,"tab_types":null,"override":{"use_includes":[],"orig_includes":[],"merge_includes":true,"use_matches":[],"orig_matches":["https://*.youtube.com/*"],"merge_matches":true,"use_excludes":[],"orig_excludes":[],"merge_excludes":true,"use_connects":[],"orig_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-idle","orig_noframes":true}},"storage":{"ts":1700756840547,"data":{"changeResolution":"btrue","preferPremium":"btrue","targetRes":"shd1080","highFramerateTargetRes":"onull","changePlayerSize":"bfalse","useCustomSize":"bfalse","customHeight":"n600","autoTheater":"bfalse","flushBuffer":"btrue","allowCookies":"bfalse","setResolutionEarly":"btrue","enableErrorScreenWorkaround":"btrue","useAPI":"btrue","overwriteStoredSettings":"bfalse","SettingsSaved":"btrue"}},"enabled":true,"position":4,"file_url":"https://update.greasyfork.org/scripts/23661/Youtube%20HD.user.js","uuid":"132520a7-4a7b-49eb-8015-3cb3c03d3909","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICAgWW91dHViZSBIRAovLyBAYXV0aG9yICAgICAgICBhZGlzaWIKLy8gQG5hbWVzcGFjZSAgICAgbmFtZXNwYWNlX2FkaXNpYgovLyBAZGVzY3JpcHRpb24gICBTZWxlY3QgYSB5b3V0dWJlIHJlc29sdXRpb24gYW5kIHJlc2l6ZSB0aGUgcGxheWVyLgovLyBAdmVyc2lvbiAgICAgICAyMDI0LjAxLjE3Ci8vIEBtYXRjaCAgICAgICAgIGh0dHBzOi8vKi55b3V0dWJlLmNvbS8qCi8vIEBub2ZyYW1lcwovLyBAZ3JhbnQgICAgICAgICBHTS5nZXRWYWx1ZQovLyBAZ3JhbnQgICAgICAgICBHTS5zZXRWYWx1ZQovLyBAZG93bmxvYWRVUkwgaHR0cHM6Ly91cGRhdGUuZ3JlYXN5Zm9yay5vcmcvc2NyaXB0cy8yMzY2MS9Zb3V0dWJlJTIwSEQudXNlci5qcwovLyBAdXBkYXRlVVJMIGh0dHBzOi8vdXBkYXRlLmdyZWFzeWZvcmsub3JnL3NjcmlwdHMvMjM2NjEvWW91dHViZSUyMEhELm1ldGEuanMKLy8gPT0vVXNlclNjcmlwdD09CgovLyBUaGUgdmlkZW8gd2lsbCBvbmx5IHJlc2l6ZSB3aGVuIGluIHRoZWF0ZXIgbW9kZSBvbiB0aGUgbWFpbiB5b3V0dWJlIHdlYnNpdGUuCi8vIEJ5IGRlZmF1bHQgb25seSBydW5zIG9uIHlvdXR1YmUgd2Vic2l0ZSwgbm90IHBsYXllcnMgZW1iZWRlZCBvbiBvdGhlciB3ZWJzaXRlcywgYnV0IHRoZXJlIGlzIGV4cGVyaW1lbnRhbCBzdXBwb3J0IGZvciBlbWJlZHMuCi8vIFRvIGVuYWJsZSBleHBlcmltZW50YWwgc3VwcG9ydCBmb3IgZW1iZWRkZWQgcGxheWVycyBvdXRzaWRlIG9mIFlvdVR1YmUgd2Vic2l0ZSwgZG8gdGhlIGZvbGxvd2luZyBzdGVwczoKLy8gICBhZGQgICIgQGluY2x1ZGUgKiAiICB0byB0aGUgc2NyaXB0IG1ldGFkYXRhCi8vICAgcmVtb3ZlICAiIEBub2ZyYW1lcyAiICBmcm9tIHRoZSBzY3JpcHQgbWV0YWRhdGEKCi8vIDIwMjQuMDEuMTcKLy8gRml4IGlzc3VlIHdpdGggdXNlciBzY3JpcHQgbWFuYWdlcnMgdGhhdCBkb24ndCBkZWZpbmUgR00KCi8vIDIwMjQuMDEuMTQKLy8gUGFydGlhbGx5IGZpeCBhdXRvIHRoZWF0ZXIgbW9kZSBhZ2FpbiBhZnRlciBtb3JlIHlvdXR1YmUgY2hhbmdlcwovLyBOb3RlIHRoYXQgaWYgeW91IHdhbnQgdG8gdHVybiB0aGVhdGVyIG1vZGUgYmFjayBvZmYgYWZ0ZXIgdXNpbmcgYXV0byB0aGVhdGVyIHlvdSBoYXZlIHRvIGNsaWNrIHRoZSBidXR0b24gYSBmZXcgdGltZXMuIFRoaXMgaXMgYSBrbm93biBpc3N1ZSB0aGF0IGhhc24ndCBiZWVuIGZpeGVkIHlldC4KCgooZnVuY3Rpb24oKSB7CiAgInVzZSBzdHJpY3QiOwoKICAvLyAtLS0gU0VUVElOR1MgLS0tLS0tLQoKICAvLyBQTEVBU0UgTk9URToKICAvLyBTZXR0aW5ncyB3aWxsIGJlIHNhdmVkIHRoZSBmaXJzdCB0aW1lIHRoZSBzY3JpcHQgaXMgbG9hZGVkIHNvIHRoYXQgeW91ciBjaGFuZ2VzIGFyZW4ndCB1bmRvbmUgYnkgYW4gdXBkYXRlLgogIC8vIElmIHlvdSB3YW50IHRvIG1ha2UgYWRqdXN0bWVudHMsIHBsZWFzZSBzZXQgIm92ZXJ3cml0ZVN0b3JlZFNldHRpbmdzIiB0byB0cnVlLgogIC8vIE90aGVyd2lzZSwgeW91ciBzZXR0aW5ncyBjaGFuZ2VzIHdpbGwgTk9UIGhhdmUgYW4gZWZmZWN0IGJlY2F1c2UgaXQgd2lsbCB1c2VkIHRoZSBzYXZlZCBzZXR0aW5ncy4KICAvLyBBZnRlciB0aGUgc2NyaXB0IGhhcyBuZXh0IGJlZW4gcnVuIGJ5IGxvYWRpbmcgYSB2aWRlbyB3aXRoICJvdmVyd3JpdGVTdG9yZWRTZXR0aW5ncyIgYXMgdHJ1ZSwgeW91ciBzZXR0aW5ncyB3aWxsIGJlIHVwZGF0ZWQuCiAgLy8gVGhlbiBhZnRlciB0aGF0IHlvdSBjYW4gc2V0IGl0IHRvIGZhbHNlIGFnYWluIHRvIHByZXZlbnQgeW91ciBzZXR0aW5ncyBmcm9tIGJlaW5nIGNoYW5nZWQgYnkgYW4gdXBkYXRlLgoKICBsZXQgc2V0dGluZ3MgPSB7CgoJLy8gVGFyZ2V0IFJlc29sdXRpb24gdG8gYWx3YXlzIHNldCB0by4gSWYgbm90IGF2YWlsYWJsZSwgdGhlIG5leHQgYmVzdCByZXNvbHV0aW9uIHdpbGwgYmUgdXNlZC4KCWNoYW5nZVJlc29sdXRpb246IHRydWUsCglwcmVmZXJQcmVtaXVtOiB0cnVlLAoJdGFyZ2V0UmVzOiAiaGQxMDgwIiwKCS8vIENob2ljZXMgZm9yIHRhcmdldFJlcyBhcmUgY3VycmVudGx5OgoJLy8gICAiaGlnaHJlcyIgPj0gKCA4SyAvIDQzMjBwIC8gUVVIRCAgKQoJLy8gICAiaGQyODgwIiAgID0gKCA1SyAvIDI4ODBwIC8gIFVIRCsgKQoJLy8gICAiaGQyMTYwIiAgID0gKCA0SyAvIDIxNjBwIC8gIFVIRCAgKQoJLy8gICAiaGQxNDQwIiAgID0gKCAgICAgIDE0NDBwIC8gIFFIRCAgKQoJLy8gICAiaGQxMDgwIiAgID0gKCAgICAgIDEwODBwIC8gIEZIRCAgKQoJLy8gICAiaGQ3MjAiICAgID0gKCAgICAgICA3MjBwIC8gICBIRCAgKQoJLy8gICAibGFyZ2UiICAgID0gKCAgICAgICA0ODBwICAgICAgICAgKQoJLy8gICAibWVkaXVtIiAgID0gKCAgICAgICAzNjBwICAgICAgICAgKQoJLy8gICAic21hbGwiICAgID0gKCAgICAgICAyNDBwICAgICAgICAgKQoJLy8gICAidGlueSIgICAgID0gKCAgICAgICAxNDRwICAgICAgICAgKQoKCS8vIFRhcmdldCBSZXNvbHV0aW9uIGZvciBoaWdoIGZyYW1lcmF0ZSAoNjAgZnBzKSB2aWRlb3MKCS8vIElmIG51bGwsIGl0IGlzIHRoZSBzYW1lIGFzIHRhcmdldFJlcwoJaGlnaEZyYW1lcmF0ZVRhcmdldFJlczogbnVsbCwKCgkvLyBJZiBjaGFuZ2VQbGF5ZXJTaXplIGlzIHRydWUsIHRoZW4gdGhlIHZpZGVvJ3Mgc2l6ZSB3aWxsIGJlIGNoYW5nZWQgb24gdGhlIHBhZ2UKCS8vICAgaW5zdGVhZCBvZiB1c2luZyB5b3V0dWJlJ3MgZGVmYXVsdCAoaWYgdGhlYXRlciBtb2RlIGlzIGVuYWJsZWQpLgoJLy8gSWYgdXNlQ3VzdG9tU2l6ZSBpcyBmYWxzZSwgdGhlbiB0aGUgcGxheWVyIHdpbGwgYmUgcmVzaXplZCB0byB0cnkgdG8gbWF0Y2ggdGhlIHRhcmdldCByZXNvbHV0aW9uLgoJLy8gICBJZiB0cnVlLCB0aGVuIGl0IHdpbGwgdXNlIHRoZSBjdXN0b21IZWlnaHQgdmFyaWFibGVzICh0aGVhdGVyIG1vZGUgaXMgYWx3YXlzIGZ1bGwgcGFnZSB3aWR0aCkuCgljaGFuZ2VQbGF5ZXJTaXplOiBmYWxzZSwKCXVzZUN1c3RvbVNpemU6IGZhbHNlLAoJY3VzdG9tSGVpZ2h0OiA2MDAsCgoJLy8gSWYgYXV0b1RoZWF0ZXIgaXMgdHJ1ZSwgZWFjaCB2aWRlbyBwYWdlIG9wZW5lZCB3aWxsIGRlZmF1bHQgdG8gdGhlYXRlciBtb2RlLgoJLy8gVGhpcyBtZWFucyB0aGUgdmlkZW8gd2lsbCBhbHdheXMgYmUgcmVzaXplZCBpbW1lZGlhdGVseSBpZiB5b3UgYXJlIGNoYW5naW5nIHRoZSBzaXplLgoJLy8gTk9URTogWW91VHViZSB3aWxsIG5vdCBhbHdheXMgYWxsb3cgdGhlYXRlciBtb2RlIGltbWVkaWF0ZWx5LCB0aGUgcGFnZSBtdXN0IGJlIGZ1bGx5IGxvYWRlZCBiZWZvcmUgdGhlYXRlciBjYW4gYmUgc2V0LgoJYXV0b1RoZWF0ZXI6IGZhbHNlLAoKCS8vIElmIGZsdXNoQnVmZmVyIGlzIGZhbHNlLCB0aGVuIHRoZSBmaXJzdCBzZWNvbmQgb3Igc28gb2YgdGhlIHZpZGVvIG1heSBub3QgYWx3YXlzIGJlIHRoZSBkZXNpcmVkIHJlc29sdXRpb24uCgkvLyAgIElmIHRydWUsIHRoZW4gdGhlIGVudGlyZSB2aWRlbyB3aWxsIGJlIGd1YXJhbnRlZWQgdG8gYmUgdGhlIHRhcmdldCByZXNvbHV0aW9uLCBidXQgdGhlcmUgbWF5IGJlCgkvLyAgIGEgdmVyeSBzbWFsbCBhZGRpdGlvbmFsIGRlbGF5IGJlZm9yZSB0aGUgdmlkZW8gc3RhcnRzIGlmIHRoZSBidWZmZXIgbmVlZHMgdG8gYmUgZmx1c2hlZC4KCWZsdXNoQnVmZmVyOiB0cnVlLAoKCS8vIFNldHRpbmcgY29va2llcyBjYW4gYWxsb3cgc29tZSBvcGVyYXRpb25zIHRvIHBlcmZvcm0gZmFzdGVyIG9yIHdpdGhvdXQgYSBkZWxheSAoZS5nLiB0aGVhdGVyIG1vZGUpCgkvLyBTb21lIHBlb3BsZSBkb24ndCBsaWtlIHNldHRpbmcgY29va2llcywgc28gdGhpcyBpcyBmYWxzZSBieSBkZWZhdWx0ICh3aGljaCBpcyB0aGUgc2FtZSBhcyBvbGQgYmVoYXZpb3IpCglhbGxvd0Nvb2tpZXM6IGZhbHNlLAoKCS8vIFRyaWVzIHRvIHNldCB0aGUgcmVzb2x1dGlvbiBhcyBlYXJseSBhcyBwb3NzaWJsZS4KCS8vIFRoaXMgbWlnaHQgY2F1c2UgaXNzdWVzIG9uIHlvdXR1YmUgcG9seW1lciBsYXlvdXQsIHNvIGRpc2FibGUgaWYgdmlkZW9zIGZhaWwgdG8gbG9hZC4KCS8vIElmIHZpZGVvcyBsb2FkIGZpbmUsIGxlYXZlIGFzIHRydWUgb3IgcmVzb2x1dGlvbiBtYXkgZmFpbCB0byBzZXQuCglzZXRSZXNvbHV0aW9uRWFybHk6IHRydWUsCgoJLy8gRW5hYmxlcyBhIHRlbXBvcmFyeSB3b3JrIGFyb3VuZCBmb3IgYW4gaXNzdWUgd2hlcmUgdXNlcnMgY2FuIGdldCB0aGUgd3JvbmcgeW91dHViZSBlcnJvciBzY3JlZW4KCS8vIChZb3V0dWJlIGhhcyB0d28gb2YgdGhlbSBmb3Igc29tZSByZWFzb24gYW5kIGNoYW5naW5nIHRvIHRoZWF0ZXIgbW9kZSBtb3ZlcyB0aGUgd3Jvbmcgb25lIHRvIHRoZSBmcm9udCkKCS8vIFRyeSBkaXNhYmxpbmcgaWYgeW91IGNhbid0IGludGVyYWN0IHdpdGggdGhlIHZpZGVvIG9yIHlvdSB0aGluayB5b3UgYXJlIG1pc3NpbmcgYW4gZXJyb3IgbWVzc2FnZS4KCWVuYWJsZUVycm9yU2NyZWVuV29ya2Fyb3VuZDogdHJ1ZSwKCgkvLyBVc2UgdGhlIGlmcmFtZSBBUEkgdG8gc2V0IHJlc29sdXRpb24gaWYgcG9zc2libGUuIE90aGVyd2lzZSB1c2VzIHNpbXVsYXRlZCBtb3VzZSBjbGlja3MuCgl1c2VBUEk6IHRydWUsCgoJLy8gT3ZlcndyaXRlIHN0b3JlZCBzZXR0aW5ncyB3aXRoIHRoZSBzZXR0aW5ncyBjb2RlZCBpbnRvIHRoZSBzY3JpcHQsIHRvIGFwcGx5IGNoYW5nZXMuCgkvLyBTZXQgYW5kIGtlZXAgYXMgdHJ1ZSB0byBoYXZlIHNldHRpbmdzIGJlaGF2ZSBsaWtlIGJlZm9yZSwgd2hlcmUgeW91IGNhbiBqdXN0IGVkaXQgdGhlIHNldHRpbmdzIGhlcmUgdG8gY2hhbmdlIHRoZW0uCglvdmVyd3JpdGVTdG9yZWRTZXR0aW5nczogZmFsc2UKCiAgfTsKCiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0KCgoKCiAgLy8gLS0tIEdMT0JBTFMgLS0tLS0tLS0KCgogIGNvbnN0IERFQlVHID0gZmFsc2U7CgogIC8vIFBvc3NpYmxlIHJlc29sdXRpb24gY2hvaWNlcyAoaW4gZGVjcmVhc2luZyBvcmRlciwgaS5lLiBoaWdocmVzIGlzIHRoZSBiZXN0KToKICBjb25zdCByZXNvbHV0aW9ucyA9IFsnaGlnaHJlcycsICdoZDI4ODAnLCAnaGQyMTYwJywgJ2hkMTQ0MCcsICdoZDEwODAnLCAnaGQ3MjAnLCAnbGFyZ2UnLCAnbWVkaXVtJywgJ3NtYWxsJywgJ3RpbnknXTsKICAvLyB5b3V0dWJlIGhhcyB0byBiZSBhdCBsZWFzdCA0ODB4MjcwIGZvciB0aGUgcGxheWVyIFVJCiAgY29uc3QgaGVpZ2h0cyA9IFs0MzIwLCAyODgwLCAyMTYwLCAxNDQwLCAxMDgwLCA3MjAsIDQ4MCwgMzYwLCAyNDAsIDE0NF07CgogIGxldCBkb2MgPSBkb2N1bWVudCwgd2luID0gd2luZG93OwoKICAvLyBJRCBvZiB0aGUgbW9zdCByZWNlbnRseSBwbGF5ZWQgdmlkZW8KICBsZXQgcmVjZW50VmlkZW8gPSAiIjsKCiAgbGV0IGZvdW5kSEZSID0gZmFsc2U7CgogIGxldCBzZXRIZWlnaHQgPSAwOwoKCiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0KCgogIGZ1bmN0aW9uIGRlYnVnTG9nKG1lc3NhZ2UpCiAgewoJaWYgKERFQlVHKQoJewoJICBjb25zb2xlLmxvZygiWVRIRCB8ICIgKyBtZXNzYWdlKTsKCX0KICB9CgoKICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLQoKCiAgLy8gVXNlZCBvbmx5IGZvciBjb21wYXRhYmlsaXR5IHdpdGggd2ViZXh0ZW5zaW9ucyB2ZXJzaW9uIG9mIGdyZWFzZW1vbmtleQogIGZ1bmN0aW9uIHVud3JhcEVsZW1lbnQoZWwpCiAgewoJaWYgKGVsICYmIGVsLndyYXBwZWRKU09iamVjdCkKCXsKCSAgcmV0dXJuIGVsLndyYXBwZWRKU09iamVjdDsKCX0KCXJldHVybiBlbDsKICB9CgoKICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLQoKCiAgLy8gR2V0IHZpZGVvIElEIGZyb20gdGhlIGN1cnJlbnRseSBsb2FkZWQgdmlkZW8gKHdoaWNoIG1pZ2h0IGJlIGRpZmZlcmVudCB0aGFuIGN1cnJlbnRseSBsb2FkZWQgcGFnZSkKICBmdW5jdGlvbiBnZXRWaWRlb0lERnJvbVVSTCh5dFBsYXllcikKICB7Cgljb25zdCBpZE1hdGNoID0gLyg/OnY9KShbXHdcLV0rKS87CglsZXQgaWQgPSAiRVJST1I6IGlkTWF0Y2ggZmFpbGVkOyB5b3V0dWJlIGNoYW5nZWQgc29tZXRoaW5nIjsKCWxldCBtYXRjaGVzID0gaWRNYXRjaC5leGVjKHl0UGxheWVyLmdldFZpZGVvVXJsKCkpOwoJaWYgKG1hdGNoZXMpCgl7CgkgIGlkID0gbWF0Y2hlc1sxXTsKCX0KCglyZXR1cm4gaWQ7CiAgfQoKCiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0KCgogIC8vIEF0dGVtcHQgdG8gc2V0IHRoZSB2aWRlbyByZXNvbHV0aW9uIHRvIGRlc2lyZWQgcXVhbGl0eSBvciB0aGUgbmV4dCBiZXN0IHF1YWxpdHkKICBmdW5jdGlvbiBzZXRSZXNvbHV0aW9uKHl0UGxheWVyLCByZXNvbHV0aW9uTGlzdCkKICB7CglkZWJ1Z0xvZygiU2V0dGluZyBSZXNvbHV0aW9uLi4uIik7CgoJY29uc3QgY3VycmVudFF1YWxpdHkgPSB5dFBsYXllci5nZXRQbGF5YmFja1F1YWxpdHkoKTsKCWxldCByZXMgPSBzZXR0aW5ncy50YXJnZXRSZXM7CgoJaWYgKHNldHRpbmdzLmhpZ2hGcmFtZXJhdGVUYXJnZXRSZXMgJiYgZm91bmRIRlIpCgl7CgkgIHJlcyA9IHNldHRpbmdzLmhpZ2hGcmFtZXJhdGVUYXJnZXRSZXM7Cgl9CgoJbGV0IHNob3VsZFByZW1pdW0gPSBzZXR0aW5ncy5wcmVmZXJQcmVtaXVtICYmIFsuLi55dFBsYXllci5nZXRBdmFpbGFibGVRdWFsaXR5RGF0YSgpXS5zb21lKHEgPT4gcS5xdWFsaXR5ID09IHJlcyAmJiBxLnF1YWxpdHlMYWJlbC5pbmNsdWRlcygiUHJlbWl1bSIpICYmIHEuaXNQbGF5YWJsZSk7CglsZXQgdXNlQnV0dG9ucyA9ICFzZXR0aW5ncy51c2VBUEkgfHwgc2hvdWxkUHJlbWl1bTsKCgkvLyBZb3V0dWJlIGRvZXNuJ3QgcmV0dXJuICJhdXRvIiBmb3IgYXV0bywgc28gc2V0IHRvIG1ha2Ugc3VyZSB0aGF0IGF1dG8gaXMgbm90IHNldCBieSBzZXR0aW5nCgkvLyAgIGV2ZW4gd2hlbiBhbHJlYWR5IGF0IHRhcmdldCByZXMgb3IgYWJvdmUsIGJ1dCBkbyBzbyB3aXRob3V0IHJlbW92aW5nIHRoZSBidWZmZXIgZm9yIHRoaXMgcXVhbGl0eQoJaWYgKHJlc29sdXRpb25MaXN0LmluZGV4T2YocmVzKSA8IHJlc29sdXRpb25MaXN0LmluZGV4T2YoY3VycmVudFF1YWxpdHkpKQoJewoJICBjb25zdCBlbmQgPSByZXNvbHV0aW9uTGlzdC5sZW5ndGggLSAxOwoJICBsZXQgbmV4dEJlc3RJbmRleCA9IE1hdGgubWF4KHJlc29sdXRpb25MaXN0LmluZGV4T2YocmVzKSwgMCk7CgkgIGxldCB5dFJlc29sdXRpb25zID0geXRQbGF5ZXIuZ2V0QXZhaWxhYmxlUXVhbGl0eUxldmVscygpOwoJICBkZWJ1Z0xvZygiQXZhaWxhYmxlIFJlc29sdXRpb25zOiAiICsgeXRSZXNvbHV0aW9ucy5qb2luKCIsICIpKTsKCgkgIHdoaWxlICggKHl0UmVzb2x1dGlvbnMuaW5kZXhPZihyZXNvbHV0aW9uTGlzdFtuZXh0QmVzdEluZGV4XSkgPT09IC0xKSAmJiBuZXh0QmVzdEluZGV4IDwgZW5kICkKCSAgewoJCSsrbmV4dEJlc3RJbmRleDsKCSAgfQoKCSAgaWYgKCF1c2VCdXR0b25zICYmIHNldHRpbmdzLmZsdXNoQnVmZmVyICYmIGN1cnJlbnRRdWFsaXR5ICE9PSByZXNvbHV0aW9uTGlzdFtuZXh0QmVzdEluZGV4XSkKCSAgewoJCWxldCBpZCA9IGdldFZpZGVvSURGcm9tVVJMKHl0UGxheWVyKTsKCQlpZiAoaWQuaW5kZXhPZigiRVJST1IiKSA9PT0gLTEpCgkJewoJCSAgbGV0IHBvcyA9IHl0UGxheWVyLmdldEN1cnJlbnRUaW1lKCk7CgkJICB5dFBsYXllci5sb2FkVmlkZW9CeUlkKGlkLCBwb3MsIHJlc29sdXRpb25MaXN0W25leHRCZXN0SW5kZXhdKTsKCQl9CgoJCWRlYnVnTG9nKCJJRDogIiArIGlkKTsKCSAgfQoKCSAgcmVzID0gcmVzb2x1dGlvbkxpc3RbbmV4dEJlc3RJbmRleF07Cgl9CgoJaWYgKHNldHRpbmdzLnVzZUFQSSkKCXsKCSAgaWYgKHl0UGxheWVyLnNldFBsYXliYWNrUXVhbGl0eVJhbmdlICE9PSB1bmRlZmluZWQpCgkgIHsKCQl5dFBsYXllci5zZXRQbGF5YmFja1F1YWxpdHlSYW5nZShyZXMpOwoJICB9CgkgIHl0UGxheWVyLnNldFBsYXliYWNrUXVhbGl0eShyZXMpOwoJICBkZWJ1Z0xvZygiKEFQSSkgUmVzb2x1dGlvbiBTZXQgVG86ICIgKyByZXMpOwoJfQoJaWYgKHVzZUJ1dHRvbnMpCgl7CgkgIGxldCByZXNMYWJlbCA9IGhlaWdodHNbcmVzb2x1dGlvbkxpc3QuaW5kZXhPZihyZXMpXTsKCSAgaWYgKHNob3VsZFByZW1pdW0pCgkgIHsKCQlyZXNMYWJlbCA9IFsuLi55dFBsYXllci5nZXRBdmFpbGFibGVRdWFsaXR5RGF0YSgpXS5maW5kKHEgPT4gcS5xdWFsaXR5ID09IHJlcyAmJiBxLnF1YWxpdHlMYWJlbC5pbmNsdWRlcygiUHJlbWl1bSIpKS5xdWFsaXR5TGFiZWw7CgkgIH0KCgkgIGxldCBzZXR0aW5nc0J1dHRvbiA9IGRvYy5xdWVyeVNlbGVjdG9yKCIueXRwLXNldHRpbmdzLWJ1dHRvbjpub3QoI1NjYWxlQnRuKSIpWzBdOwoJICB1bndyYXBFbGVtZW50KHNldHRpbmdzQnV0dG9uKS5jbGljaygpOwoKCSAgbGV0IHF1YWxpdHlNZW51QnV0dG9uID0gZG9jdW1lbnQuZXZhbHVhdGUoJy4vLypbY29udGFpbnModGV4dCgpLCJRdWFsaXR5IildL2FuY2VzdG9yLW9yLXNlbGY6OipbQGNsYXNzPSJ5dHAtbWVudWl0ZW0tbGFiZWwiXScsIHl0UGxheWVyLCBudWxsLCBYUGF0aFJlc3VsdC5GSVJTVF9PUkRFUkVEX05PREVfVFlQRSwgbnVsbCkuc2luZ2xlTm9kZVZhbHVlOwoJICB1bndyYXBFbGVtZW50KHF1YWxpdHlNZW51QnV0dG9uKS5jbGljaygpOwoKCSAgbGV0IHF1YWxpdHlCdXR0b24gPSBkb2N1bWVudC5ldmFsdWF0ZSgnLi8vKltjb250YWlucyh0ZXh0KCksIicgKyBoZWlnaHRzW3Jlc29sdXRpb25MaXN0LmluZGV4T2YocmVzKV0gKyAnIikgYW5kIG5vdChAY2xhc3MpXS9hbmNlc3Rvcjo6KltAY2xhc3M9Inl0cC1tZW51aXRlbSJdJywgeXRQbGF5ZXIsIG51bGwsIFhQYXRoUmVzdWx0LkZJUlNUX09SREVSRURfTk9ERV9UWVBFLCBudWxsKS5zaW5nbGVOb2RlVmFsdWU7CgkgIHVud3JhcEVsZW1lbnQocXVhbGl0eUJ1dHRvbikuY2xpY2soKTsKCSAgZGVidWdMb2coIihCdXR0b25zKSBSZXNvbHV0aW9uIFNldCBUbzogIiArIHJlcyk7Cgl9CiAgfQoKCiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0KCgogIC8vIFNldCByZXNvbHV0aW9uLCBidXQgb25seSB3aGVuIEFQSSBpcyByZWFkeSAoaXQgc2hvdWxkIG5vcm1hbGx5IGFscmVhZHkgYmUgcmVhZHkpCiAgZnVuY3Rpb24gc2V0UmVzT25SZWFkeSh5dFBsYXllciwgcmVzb2x1dGlvbkxpc3QpCiAgewoJaWYgKHNldHRpbmdzLnVzZUFQSSAmJiB5dFBsYXllci5nZXRQbGF5YmFja1F1YWxpdHkgPT09IHVuZGVmaW5lZCkKCXsKCSAgd2luLnNldFRpbWVvdXQoc2V0UmVzT25SZWFkeSwgMTAwLCB5dFBsYXllciwgcmVzb2x1dGlvbkxpc3QpOwoJfQoJZWxzZQoJewoJICBsZXQgZnJhbWVyYXRlVXBkYXRlID0gZmFsc2U7CgkgIGlmIChzZXR0aW5ncy5oaWdoRnJhbWVyYXRlVGFyZ2V0UmVzKQoJICB7CgkJbGV0IGZlYXR1cmVzID0geXRQbGF5ZXIuZ2V0VmlkZW9EYXRhKCkudmlkZW9fcXVhbGl0eV9mZWF0dXJlczsKCQlpZiAoZmVhdHVyZXMpCgkJewoJCSAgbGV0IGlzSEZSID0gZmVhdHVyZXMuaW5jbHVkZXMoImhmciIpOwoJCSAgZnJhbWVyYXRlVXBkYXRlID0gaXNIRlIgJiYgIWZvdW5kSEZSOwoJCSAgZm91bmRIRlIgPSBpc0hGUjsKCQl9CgkgIH0KCgkgIGxldCBjdXJWaWQgPSBnZXRWaWRlb0lERnJvbVVSTCh5dFBsYXllcik7CgkgIGlmICgoY3VyVmlkICE9PSByZWNlbnRWaWRlbykgfHwgZnJhbWVyYXRlVXBkYXRlKQoJICB7CgkJcmVjZW50VmlkZW8gPSBjdXJWaWQ7CgkJc2V0UmVzb2x1dGlvbih5dFBsYXllciwgcmVzb2x1dGlvbkxpc3QpOwoKCQlsZXQgc3RvcmVkUXVhbGl0eSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJ5dC1wbGF5ZXItcXVhbGl0eSIpOwoJCWlmICghc3RvcmVkUXVhbGl0eSB8fCBzdG9yZWRRdWFsaXR5LmluZGV4T2Yoc2V0dGluZ3MudGFyZ2V0UmVzKSA9PT0gLTEpCgkJewoJCSAgbGV0IHRjID0gRGF0ZS5ub3coKSwgdGUgPSB0YyArIDI1OTIwMDAwMDA7CgkJICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgieXQtcGxheWVyLXF1YWxpdHkiLCJ7XCJkYXRhXCI6XCIiICsgc2V0dGluZ3MudGFyZ2V0UmVzICsgIlwiLFwiZXhwaXJhdGlvblwiOiIgKyB0ZSArICIsXCJjcmVhdGlvblwiOiIgKyB0YyArICJ9Iik7CgkJfQoJICB9Cgl9CiAgfQoKCiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0KCgogIGZ1bmN0aW9uIHNldFRoZWF0ZXJNb2RlKHl0UGxheWVyKQogIHsKCWRlYnVnTG9nKCJTZXR0aW5nIFRoZWF0ZXIgTW9kZSIpOwoKCWlmICh3aW4ubG9jYXRpb24uaHJlZi5pbmRleE9mKCIvd2F0Y2giKSAhPT0gLTEpCgl7CgkgIGxldCBwYWdlTWFuYWdlciA9IHVud3JhcEVsZW1lbnQoZG9jLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJ5dGQtd2F0Y2gtZmxleHkiKVswXSk7CgoJICBpZiAocGFnZU1hbmFnZXIgJiYgIXBhZ2VNYW5hZ2VyLmhhc0F0dHJpYnV0ZSgidGhlYXRlciIpKQoJICB7CgkJaWYgKHNldHRpbmdzLmVuYWJsZUVycm9yU2NyZWVuV29ya2Fyb3VuZCkKCQl7CgkJICBjb25zdCBzdHlsZUNvbnRlbnQgPSAiI2Vycm9yLXNjcmVlbiB7IHotaW5kZXg6IDQyICFpbXBvcnRhbnQgfSAueXRwLWVycm9yIHsgZGlzcGxheTogbm9uZSAhaW1wb3J0YW50IH0iOwoKCQkgIGxldCBlcnJvclN0eWxlID0gZG9jLmdldEVsZW1lbnRCeUlkKCJ5dGhkRXJyb3JXb3JrYXJvdW5kU3R5bGVTaGVldCIpOwoJCSAgaWYgKCFlcnJvclN0eWxlKQoJCSAgewoJCQllcnJvclN0eWxlID0gZG9jLmNyZWF0ZUVsZW1lbnQoInN0eWxlIik7CgkJCWVycm9yU3R5bGUudHlwZSA9ICJ0ZXh0L2NzcyI7CgkJCWVycm9yU3R5bGUuaWQgPSAieXRoZFN0eWxlU2hlZXQiOwoJCQllcnJvclN0eWxlLmlubmVySFRNTCA9IHN0eWxlQ29udGVudDsKCQkJZG9jLmhlYWQuYXBwZW5kQ2hpbGQoZXJyb3JTdHlsZSk7CgkJICB9CgkJICBlbHNlCgkJICB7CgkJCWVycm9yU3R5bGUuaW5uZXJIVE1MID0gc3R5bGVDb250ZW50OwoJCSAgfQoJCX0KCgkJdHJ5CgkJewoJCQlwYWdlTWFuYWdlci5zZXRUaGVhdGVyTW9kZVJlcXVlc3RlZCh0cnVlKTsKCQkJcGFnZU1hbmFnZXIudXBkYXRlVGhlYXRlck1vZGVTdGF0ZV8odHJ1ZSk7CgkJCXBhZ2VNYW5hZ2VyLm9uVGhlYXRlclJlZHV4VmFsdWVVcGRhdGUodHJ1ZSk7CgkJCXBhZ2VNYW5hZ2VyLnNldFBsYXllclRoZWF0ZXJNb2RlXygpOwoJCQlwYWdlTWFuYWdlci5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgieXQtc2V0LXRoZWF0ZXItbW9kZS1lbmFibGVkIiwgeyBkZXRhaWw6IHtlbmFibGVkOiB0cnVlfSwgYnViYmxlczogdHJ1ZSwgY2FuY2VsYWJsZTogZmFsc2V9ICkpOwoJCX0KCQljYXRjaCB7fQoKCQlsZXQgdGhlYXRlckJ1dHRvbjsKCQlmb3IgKGxldCBpID0gMDsgaSA8IDMgJiYgIXBhZ2VNYW5hZ2VyLnRoZWF0ZXJWYWx1ZTsgKytpKQoJCXsKCQkgIGRlYnVnTG9nKCJDbGlja2luZyB0aGVhdGVyIGJ1dHRvbiB0byBhdHRlbXB0IHRvIG5vdGlmeSByZWR1eCBzdGF0ZSIpOwoJCSAgbGV0IHRoZWF0ZXJCdXR0b24gPSB0aGVhdGVyQnV0dG9uIHx8IHVud3JhcEVsZW1lbnQoZG9jLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoInl0cC1zaXplLWJ1dHRvbiIpWzBdKTsKCQkgIHRoZWF0ZXJCdXR0b24uY2xpY2soKTsKCQl9CgkgIH0KCX0KICB9CgoKICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLQoKCiAgZnVuY3Rpb24gY29tcHV0ZUFuZFNldFBsYXllclNpemUoKQogIHsKCWxldCBoZWlnaHQgPSBzZXR0aW5ncy5jdXN0b21IZWlnaHQ7CglpZiAoIXNldHRpbmdzLnVzZUN1c3RvbVNpemUpCgl7CgkgIC8vIGRvbid0IGluY2x1ZGUgeW91dHViZSBzZWFyY2ggYmFyIGFzIHBhcnQgb2YgdGhlIHNwYWNlIHRoZSB2aWRlbyBjYW4gdHJ5IHRvIGZpdCBpbgoJICBsZXQgaGVpZ2h0T2Zmc2V0RWwgPSBkb2MuZ2V0RWxlbWVudEJ5SWQoIm1hc3RoZWFkIik7CgkgIGxldCBtYXN0aGVhZENvbnRhaW5lckVsID0gZG9jLmdldEVsZW1lbnRCeUlkKCJtYXN0aGVhZC1jb250YWluZXIiKTsKCSAgbGV0IG1hc3RoZWFkSGVpZ2h0ID0gNTAsIG1hc3RoZWFkUGFkZGluZyA9IDE2OwoJICBpZiAoaGVpZ2h0T2Zmc2V0RWwgJiYgbWFzdGhlYWRDb250YWluZXJFbCkKCSAgewoJCW1hc3RoZWFkSGVpZ2h0ID0gcGFyc2VJbnQod2luLmdldENvbXB1dGVkU3R5bGUoaGVpZ2h0T2Zmc2V0RWwpLmhlaWdodCwgMTApOwoJCW1hc3RoZWFkUGFkZGluZyA9IHBhcnNlSW50KHdpbi5nZXRDb21wdXRlZFN0eWxlKG1hc3RoZWFkQ29udGFpbmVyRWwpLnBhZGRpbmdCb3R0b20sIDEwKSAqIDI7CgkgIH0KCgkgIGxldCBpID0gTWF0aC5tYXgocmVzb2x1dGlvbnMuaW5kZXhPZihzZXR0aW5ncy50YXJnZXRSZXMpLCAwKTsKCSAgaGVpZ2h0ID0gTWF0aC5taW4oaGVpZ2h0c1tpXSwgd2luLmlubmVySGVpZ2h0IC0gKG1hc3RoZWFkSGVpZ2h0ICsgbWFzdGhlYWRQYWRkaW5nKSk7CgkgIGhlaWdodCA9IE1hdGgubWF4KGhlaWdodCwgMjcwKTsKCX0KCglyZXNpemVQbGF5ZXIoaGVpZ2h0KTsKICB9CgoKICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLQoKCiAgLy8gcmVzaXplIHRoZSBwbGF5ZXIKICBmdW5jdGlvbiByZXNpemVQbGF5ZXIoaGVpZ2h0KQogIHsKCWRlYnVnTG9nKCJTZXR0aW5nIHZpZGVvIHBsYXllciBzaXplIik7CgoJaWYgKHNldEhlaWdodCA9PT0gaGVpZ2h0KQoJewoJICBkZWJ1Z0xvZygiUGxheWVyIHNpemUgYWxyZWFkeSBzZXQiKTsKCSAgcmV0dXJuOwoJfQoKCWxldCBzdHlsZUNvbnRlbnQgPSAiXAp5dGQtd2F0Y2gtZmxleHlbdGhlYXRlcl06bm90KFtmdWxsc2NyZWVuXSkgI3BsYXllci10aGVhdGVyLWNvbnRhaW5lci5zdHlsZS1zY29wZSwgXAp5dGQtd2F0Y2gtZmxleHlbdGhlYXRlcl06bm90KFtmdWxsc2NyZWVuXSkgI3BsYXllci13aWRlLWNvbnRhaW5lci5zdHlsZS1zY29wZSwgXAp5dGQtd2F0Y2gtZmxleHlbdGhlYXRlcl06bm90KFtmdWxsc2NyZWVuXSkgI2Z1bGwtYmxlZWQtY29udGFpbmVyLnN0eWxlLXNjb3BlIHsgXAptaW4taGVpZ2h0OiAiICsgaGVpZ2h0ICsgInB4ICFpbXBvcnRhbnQ7IG1heC1oZWlnaHQ6IG5vbmUgIWltcG9ydGFudDsgaGVpZ2h0OiAiICsgaGVpZ2h0ICsgInB4ICFpbXBvcnRhbnQgfSI7CgoJbGV0IHl0aGRTdHlsZSA9IGRvYy5nZXRFbGVtZW50QnlJZCgieXRoZFN0eWxlU2hlZXQiKTsKCWlmICgheXRoZFN0eWxlKQoJewoJICB5dGhkU3R5bGUgPSBkb2MuY3JlYXRlRWxlbWVudCgic3R5bGUiKTsKCSAgeXRoZFN0eWxlLnR5cGUgPSAidGV4dC9jc3MiOwoJICB5dGhkU3R5bGUuaWQgPSAieXRoZFN0eWxlU2hlZXQiOwoJICB5dGhkU3R5bGUuaW5uZXJIVE1MID0gc3R5bGVDb250ZW50OwoJICBkb2MuaGVhZC5hcHBlbmRDaGlsZCh5dGhkU3R5bGUpOwoJfQoJZWxzZQoJewoJICB5dGhkU3R5bGUuaW5uZXJIVE1MID0gc3R5bGVDb250ZW50OwoJfQoKCXNldEhlaWdodCA9IGhlaWdodDsKCgl3aW4uZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoInJlc2l6ZSIpKTsKICB9CgoKICAvLyAtLS0gTUFJTiAtLS0tLS0tLS0tLQoKCiAgZnVuY3Rpb24gbWFpbigpCiAgewoJbGV0IHl0UGxheWVyID0gZG9jLmdldEVsZW1lbnRCeUlkKCJtb3ZpZV9wbGF5ZXIiKSB8fCBkb2MuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgiaHRtbDUtdmlkZW8tcGxheWVyIilbMF07CglsZXQgeXRQbGF5ZXJVbndyYXBwZWQgPSB1bndyYXBFbGVtZW50KHl0UGxheWVyKTsKCglpZiAoc2V0dGluZ3MuYXV0b1RoZWF0ZXIgJiYgeXRQbGF5ZXJVbndyYXBwZWQpCgl7CgkgIGlmIChzZXR0aW5ncy5hbGxvd0Nvb2tpZXMgJiYgZG9jLmNvb2tpZS5pbmRleE9mKCJ3aWRlPTEiKSA9PT0gLTEpCgkgIHsKCQlkb2MuY29va2llID0gIndpZGU9MTsgZG9tYWluPS55b3V0dWJlLmNvbSI7CgkgIH0KCgkgIHNldFRoZWF0ZXJNb2RlKHl0UGxheWVyVW53cmFwcGVkKTsKCX0KCglpZiAoc2V0dGluZ3MuY2hhbmdlUGxheWVyU2l6ZSAmJiB3aW4ubG9jYXRpb24uaG9zdC5pbmRleE9mKCJ5b3V0dWJlLmNvbSIpICE9PSAtMSAmJiB3aW4ubG9jYXRpb24uaG9zdC5pbmRleE9mKCJnYW1pbmcuIikgPT09IC0xKQoJewoJICBjb21wdXRlQW5kU2V0UGxheWVyU2l6ZSgpOwoJICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigicmVzaXplIiwgY29tcHV0ZUFuZFNldFBsYXllclNpemUsIHRydWUpOwoJfQoKCWlmIChzZXR0aW5ncy5jaGFuZ2VSZXNvbHV0aW9uICYmIHNldHRpbmdzLnNldFJlc29sdXRpb25FYXJseSAmJiB5dFBsYXllclVud3JhcHBlZCkKCXsKCSAgc2V0UmVzT25SZWFkeSh5dFBsYXllclVud3JhcHBlZCwgcmVzb2x1dGlvbnMpOwoJfQoKCWlmIChzZXR0aW5ncy5jaGFuZ2VSZXNvbHV0aW9uIHx8IHNldHRpbmdzLmF1dG9UaGVhdGVyKQoJewoJICB3aW4uYWRkRXZlbnRMaXN0ZW5lcigibG9hZHN0YXJ0IiwgZnVuY3Rpb24oZSkgewoJCWlmICghKGUudGFyZ2V0IGluc3RhbmNlb2Ygd2luLkhUTUxNZWRpYUVsZW1lbnQpKQoJCXsKCQkgIHJldHVybjsKCQl9CgoJCXl0UGxheWVyID0gZG9jLmdldEVsZW1lbnRCeUlkKCJtb3ZpZV9wbGF5ZXIiKSB8fCBkb2MuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgiaHRtbDUtdmlkZW8tcGxheWVyIilbMF07CgkJeXRQbGF5ZXJVbndyYXBwZWQgPSB1bndyYXBFbGVtZW50KHl0UGxheWVyKTsKCQlpZiAoeXRQbGF5ZXJVbndyYXBwZWQpCgkJewoJCSAgZGVidWdMb2coIkxvYWRlZCBuZXcgdmlkZW8iKTsKCQkgIGlmIChzZXR0aW5ncy5jaGFuZ2VSZXNvbHV0aW9uKQoJCSAgewoJCQlzZXRSZXNPblJlYWR5KHl0UGxheWVyVW53cmFwcGVkLCByZXNvbHV0aW9ucyk7CgkJICB9CgkJICBpZiAoc2V0dGluZ3MuYXV0b1RoZWF0ZXIpCgkJICB7CgkJCXNldFRoZWF0ZXJNb2RlKHl0UGxheWVyVW53cmFwcGVkKTsKCQkgIH0KCQl9CgkgIH0sIHRydWUgKTsKCX0KCgkvLyBUaGlzIHdpbGwgZXZlbnR1YWxseSBiZSBjaGFuZ2VkIHRvIHVzZSB0aGUgIm9uY2UiIG9wdGlvbiwgYnV0IEkgd2FudCB0byBrZWVwIGEgbGFyZ2UgcmFuZ2Ugb2YgYnJvd3NlciBzdXBwb3J0LgoJd2luLnJlbW92ZUV2ZW50TGlzdGVuZXIoInl0LW5hdmlnYXRlLWZpbmlzaCIsIG1haW4sIHRydWUpOwogIH0KCiAgYXN5bmMgZnVuY3Rpb24gYXBwbHlTZXR0aW5ncygpCiAgewoJaWYgKHR5cGVvZiBHTSAhPSAndW5kZWZpbmVkJyAmJiBHTS5nZXRWYWx1ZSAmJiBHTS5zZXRWYWx1ZSkKCXsKCSAgbGV0IHNldHRpbmdzU2F2ZWQgPSBhd2FpdCBHTS5nZXRWYWx1ZSgiU2V0dGluZ3NTYXZlZCIpOwoKCSAgaWYgKHNldHRpbmdzLm92ZXJ3cml0ZVN0b3JlZFNldHRpbmdzIHx8ICFzZXR0aW5nc1NhdmVkKQoJICB7CgkJT2JqZWN0LmVudHJpZXMoc2V0dGluZ3MpLmZvckVhY2goKFtrLHZdKSA9PiBHTS5zZXRWYWx1ZShrLCB2KSk7CgoJCWF3YWl0IEdNLnNldFZhbHVlKCJTZXR0aW5nc1NhdmVkIiwgdHJ1ZSk7CgkgIH0KCSAgZWxzZQoJICB7CgkJYXdhaXQgUHJvbWlzZS5hbGwoCgkJICBPYmplY3Qua2V5cyhzZXR0aW5ncykubWFwKGsgPT4geyBsZXQgbmV3dmFsID0gR00uZ2V0VmFsdWUoayk7IHJldHVybiBuZXd2YWwudGhlbih2ID0+IFtrLHZdKTsgfSkKCQkpLnRoZW4oKGMpID0+IGMuZm9yRWFjaCgoW25rLG52XSkgPT4gewoJCSAgaWYgKHNldHRpbmdzW25rXSAhPT0gbnVsbCAmJiBuayAhPT0gIm92ZXJ3cml0ZVN0b3JlZFNldHRpbmdzIikKCQkgIHsKCQkJc2V0dGluZ3NbbmtdID0gbnY7CgkJICB9CgkJfSkpOwoJICB9CgoJICBkZWJ1Z0xvZyhPYmplY3QuZW50cmllcyhzZXR0aW5ncykubWFwKChbayx2XSkgPT4gayArICIgfCAiICsgdikuam9pbigiLCAiKSk7Cgl9CiAgfQoKICBhcHBseVNldHRpbmdzKCkudGhlbigoKSA9PiB7CgltYWluKCk7CgkvLyBZb3V0dWJlIGRvZXNuJ3QgbG9hZCB0aGUgcGFnZSBpbW1lZGlhdGVseSBpbiBuZXcgdmVyc2lvbiBzbyB5b3UgY2FuIHdhdGNoIGJlZm9yZSB3YWl0aW5nIGZvciBwYWdlIGxvYWQKCS8vIEJ1dCB3ZSBjYW4gb25seSBzZXQgcmVzb2x1dGlvbiB1bnRpbCB0aGUgcGFnZSBmaW5pc2hlcyBsb2FkaW5nCgl3aW4uYWRkRXZlbnRMaXN0ZW5lcigieXQtbmF2aWdhdGUtZmluaXNoIiwgbWFpbiwgdHJ1ZSk7CiAgfSk7Cn0pKCk7"},{"name":"Youtube shorts redirect","options":{"check_for_updates":true,"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_powerful_this":null,"sandbox":null,"noframes":null,"unwrap":null,"run_at":null,"tab_types":null,"override":{"use_includes":[],"orig_includes":[],"merge_includes":true,"use_matches":[],"orig_matches":["*://*.youtube.com/*"],"merge_matches":true,"use_excludes":[],"orig_excludes":[],"merge_excludes":true,"use_connects":[],"orig_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-start","orig_noframes":null},"user_modified":null},"storage":{"ts":1700906230789,"data":{}},"enabled":true,"position":5,"file_url":"https://update.greasyfork.org/scripts/439993/Youtube%20shorts%20redirect.user.js","uuid":"250f8234-2a6c-4222-8b38-c9972a5ee10b","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICBZb3V0dWJlIHNob3J0cyByZWRpcmVjdAovLyBAbmFtZXNwYWNlICAgIGh0dHA6Ly90YW1wZXJtb25rZXkubmV0LwovLyBAdmVyc2lvbiAgICAgIDAuMwovLyBAZGVzY3JpcHRpb24gIFlvdXR1ZWJlIHNob3J0cyA+IHdhdGNoIHJlZGlyZWN0Ci8vIEBhdXRob3IgICAgICAgRnVpbQovLyBAbWF0Y2ggICAgICAgICo6Ly8qLnlvdXR1YmUuY29tLyoKLy8gQGljb24gICAgICAgICBodHRwczovL3d3dy5nb29nbGUuY29tL3MyL2Zhdmljb25zP2RvbWFpbj15b3V0dWJlLmNvbQovLyBAZ3JhbnQgICAgICAgIG5vbmUKLy8gQHJ1bi1hdCAgICAgICBkb2N1bWVudC1zdGFydAovLyBAbGljZW5zZSAgICAgIEdOVSBHUEx2MgovLyBAZG93bmxvYWRVUkwgaHR0cHM6Ly91cGRhdGUuZ3JlYXN5Zm9yay5vcmcvc2NyaXB0cy80Mzk5OTMvWW91dHViZSUyMHNob3J0cyUyMHJlZGlyZWN0LnVzZXIuanMKLy8gQHVwZGF0ZVVSTCBodHRwczovL3VwZGF0ZS5ncmVhc3lmb3JrLm9yZy9zY3JpcHRzLzQzOTk5My9Zb3V0dWJlJTIwc2hvcnRzJTIwcmVkaXJlY3QubWV0YS5qcwovLyA9PS9Vc2VyU2NyaXB0PT0KdmFyIG9sZEhyZWYgPSBkb2N1bWVudC5sb2NhdGlvbi5ocmVmOwppZiAod2luZG93LmxvY2F0aW9uLmhyZWYuaW5kZXhPZigneW91dHViZS5jb20vc2hvcnRzJykgPiAtMSkgewogICAgd2luZG93LmxvY2F0aW9uLnJlcGxhY2Uod2luZG93LmxvY2F0aW9uLnRvU3RyaW5nKCkucmVwbGFjZSgnL3Nob3J0cy8nLCAnL3dhdGNoP3Y9JykpOwp9CndpbmRvdy5vbmxvYWQgPSBmdW5jdGlvbigpIHsKICAgIHZhciBib2R5TGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoImJvZHkiKQogICAgdmFyIG9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoZnVuY3Rpb24obXV0YXRpb25zKSB7CiAgICAgICAgbXV0YXRpb25zLmZvckVhY2goZnVuY3Rpb24obXV0YXRpb24pIHsKICAgICAgICAgICAgaWYgKG9sZEhyZWYgIT0gZG9jdW1lbnQubG9jYXRpb24uaHJlZikgewogICAgICAgICAgICAgICAgb2xkSHJlZiA9IGRvY3VtZW50LmxvY2F0aW9uLmhyZWY7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnbG9jYXRpb24gY2hhbmdlZCEnKTsKICAgICAgICAgICAgICAgIGlmICh3aW5kb3cubG9jYXRpb24uaHJlZi5pbmRleE9mKCd5b3V0dWJlLmNvbS9zaG9ydHMnKSA+IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlcGxhY2Uod2luZG93LmxvY2F0aW9uLnRvU3RyaW5nKCkucmVwbGFjZSgnL3Nob3J0cy8nLCAnL3dhdGNoP3Y9JykpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9KTsKICAgIHZhciBjb25maWcgPSB7CiAgICAgICAgY2hpbGRMaXN0OiB0cnVlLAogICAgICAgIHN1YnRyZWU6IHRydWUKICAgIH07CiAgICBvYnNlcnZlci5vYnNlcnZlKGJvZHlMaXN0LCBjb25maWcpOwp9Ow=="},{"name":"Redirect Twitter To Nitter","options":{"check_for_updates":true,"user_modified":null,"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_powerful_this":null,"sandbox":null,"noframes":null,"unwrap":null,"run_at":null,"tab_types":null,"override":{"use_includes":[],"orig_includes":["*"],"merge_includes":true,"use_matches":[],"orig_matches":[],"merge_matches":true,"use_excludes":[],"orig_excludes":["https://twitter.com/*"],"merge_excludes":true,"use_connects":[],"orig_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-end","orig_noframes":null}},"storage":{"ts":1702319855982,"data":{}},"enabled":true,"position":6,"file_url":"https://update.greasyfork.org/scripts/418162/Redirect%20Twitter%20To%20Nitter.user.js","uuid":"3e0298ed-b6b7-4e6a-9c2c-c1375481e04b","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICBSZWRpcmVjdCBUd2l0dGVyIFRvIE5pdHRlcgovLyBAbmFtZXNwYWNlICAgIGJyYXplbnZvaWQKLy8gQHZlcnNpb24gICAgICAxLjAuMwovLyBAZGVzY3JpcHRpb24gIENvbnZlcnQgdHdpdHRlciBVUkxzIHRvIE5pdHRlciBVUkxzCi8vIEBhdXRob3IgICAgICAgYnJhemVudm9pZAovLyBAaW5jbHVkZSAgICAgICoKLy8gQGV4Y2x1ZGUgICAgICBodHRwczovL3R3aXR0ZXIuY29tLyoKLy8gQHJ1bi1hdCAgICAgICBkb2N1bWVudC1lbmQKLy8gQGRvd25sb2FkVVJMIGh0dHBzOi8vdXBkYXRlLmdyZWFzeWZvcmsub3JnL3NjcmlwdHMvNDE4MTYyL1JlZGlyZWN0JTIwVHdpdHRlciUyMFRvJTIwTml0dGVyLnVzZXIuanMKLy8gQHVwZGF0ZVVSTCBodHRwczovL3VwZGF0ZS5ncmVhc3lmb3JrLm9yZy9zY3JpcHRzLzQxODE2Mi9SZWRpcmVjdCUyMFR3aXR0ZXIlMjBUbyUyME5pdHRlci5tZXRhLmpzCi8vID09L1VzZXJTY3JpcHQ9PQoKY29uc3QgTklUVEVSX1VSTCA9ICduaXR0ZXIubmV0Jwpjb25zdCBUV0lUVEVSX1VSTCA9ICd0d2l0dGVyLmNvbScKCmZ1bmN0aW9uIHJlZGlyZWN0VG9OaXR0ZXIgKCkgewogICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnYVtocmVmKj0iJysgVFdJVFRFUl9VUkwgKyciXScpLmZvckVhY2goKGVsZW1lbnQpID0+IHsKICAgICAgICBlbGVtZW50LmhyZWYgPSBlbGVtZW50LmhyZWYucmVwbGFjZShUV0lUVEVSX1VSTCwgTklUVEVSX1VSTCkKICAgICAgICBlbGVtZW50LnRleHRDb250ZW50ID0gZWxlbWVudC50ZXh0Q29udGVudC5yZXBsYWNlKFRXSVRURVJfVVJMLCBOSVRURVJfVVJMKQogICAgfSkKfQoKKG5ldyBNdXRhdGlvbk9ic2VydmVyKChtdXRhdGlvbnMpID0+IHsKICAgIGxldCBydW5DaGVjayA9IGZhbHNlCiAgICBmb3IgKGxldCBtdXRhdGlvbiBvZiBtdXRhdGlvbnMpIHsKICAgICAgICBpZiAobXV0YXRpb24uYWRkZWROb2Rlcy5sZW5ndGggfHwgbXV0YXRpb24uYXR0cmlidXRlTmFtZSA9PT0gJ2hyZWYnKSB7CiAgICAgICAgICAgIHJ1bkNoZWNrID0gdHJ1ZQogICAgICAgICAgICBicmVhawogICAgICAgIH0KICAgIH0KICAgIGlmIChydW5DaGVjaykgewogICAgICAgIHJlZGlyZWN0VG9OaXR0ZXIoKQogICAgfQp9KSkub2JzZXJ2ZShkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdib2R5JyksIHthdHRyaWJ1dGVGaWx0ZXI6IFsnaHJlZiddLCBjaGlsZExpc3Q6IHRydWUsIHN1YnRyZWU6IHRydWV9KQoKcmVkaXJlY3RUb05pdHRlcigp"},{"name":"Spotify link open in desktop app","options":{"check_for_updates":true,"user_modified":null,"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_powerful_this":null,"sandbox":null,"noframes":null,"unwrap":null,"run_at":null,"tab_types":null,"override":{"use_includes":[],"orig_includes":[],"merge_includes":true,"use_matches":[],"orig_matches":["http://open.spotify.com/*","https://open.spotify.com/*"],"merge_matches":true,"use_excludes":[],"orig_excludes":[],"merge_excludes":true,"use_connects":[],"orig_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-start","orig_noframes":true}},"storage":{"ts":1707211617801,"data":{}},"enabled":false,"position":7,"file_url":"https://update.greasyfork.org/scripts/485688/Spotify%20link%20open%20in%20desktop%20app.user.js","uuid":"0a6dc8b8-61d6-406f-b9cd-e3cd05efbb64","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICBTcG90aWZ5IGxpbmsgb3BlbiBpbiBkZXNrdG9wIGFwcAovLyBAYXV0aG9yICAgICAgIE9yZGluYXJ5RG9nCi8vIEBkZXNjcmlwdGlvbiAgVGhpcyB1c2Vyc2NyaXB0IHJlZGlyZWN0cyBvcGVuLnNwb3RpZnkuY29tIGxpbmtzIHRvIHRoZSBkZXNrdG9wIGFwcCBhbmQgY2xvc2UgU3BvdGlmeSB0YWIgaW4gYnJvd3NlcgovLyBAdmVyc2lvbiAgICAgIDEuMwovLyBAbGljZW5zZSAgICAgIE1JVCBMaWNlbnNlCi8vIEBjb3B5cmlnaHQgICAgQ29weXJpZ2h0IChDKSAyMDE5LCBieSBvcmRpbmFyeWRvZ0Bwcm90b25tYWlsLmNvbQovLyBAbWF0Y2ggICAgICAgIGh0dHA6Ly9vcGVuLnNwb3RpZnkuY29tLyoKLy8gQG1hdGNoICAgICAgICBodHRwczovL29wZW4uc3BvdGlmeS5jb20vKgovLyBAbmFtZXNwYWNlICAgIGh0dHBzOi8vZ3JlYXN5Zm9yay5vcmcvdXNlcnMvMTcyNDMxCi8vIEBydW4tYXQgICAgICAgZG9jdW1lbnQtc3RhcnQKLy8gQG5vZnJhbWVzCi8vIEBkb3dubG9hZFVSTCBodHRwczovL3VwZGF0ZS5ncmVhc3lmb3JrLm9yZy9zY3JpcHRzLzQ4NTY4OC9TcG90aWZ5JTIwbGluayUyMG9wZW4lMjBpbiUyMGRlc2t0b3AlMjBhcHAudXNlci5qcwovLyBAdXBkYXRlVVJMIGh0dHBzOi8vdXBkYXRlLmdyZWFzeWZvcmsub3JnL3NjcmlwdHMvNDg1Njg4L1Nwb3RpZnklMjBsaW5rJTIwb3BlbiUyMGluJTIwZGVza3RvcCUyMGFwcC5tZXRhLmpzCi8vID09L1VzZXJTY3JpcHQ9PQoKKGZ1bmN0aW9uICgpIHsKICAidXNlIHN0cmljdCI7CiAgdmFyIGRhdGEgPSBkb2N1bWVudC5VUkwubWF0Y2goCiAgICAvW1wvXCZdKHRyYWNrfHBsYXlsaXN0fGFsYnVtfGFydGlzdHxzaG93fGVwaXNvZGUpXC8oW15cJlwjXC9cP10rKS9pCiAgKTsKICBjb25zb2xlLmxvZygKICAgICJUaGlzIGlzIGEgIiArIGRhdGFbMV0gKyAiIHdpdGggaWQ6IiArIGRhdGFbMl0gKyAiXG5BdHRlbXB0aW5nIHRvIHJlZGlyZWN0IgogICk7CiAgd2luZG93LmxvY2F0aW9uLnJlcGxhY2UoInNwb3RpZnk6IiArIGRhdGFbMV0gKyAiOiIgKyBkYXRhWzJdKTsKICAKICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgIHdpbmRvdy50b3AuY2xvc2UoKTsKICB9LCAyMDAwKTsKfSkoKTsK"},{"name":"Cleanup YouTube Recommendations in Search and Playlist","options":{"check_for_updates":true,"user_modified":null,"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_powerful_this":null,"sandbox":null,"noframes":null,"unwrap":null,"run_at":null,"tab_types":null,"override":{"use_includes":[],"orig_includes":[],"merge_includes":true,"use_matches":[],"orig_matches":["https://www.youtube.com/*"],"merge_matches":true,"use_excludes":[],"orig_excludes":[],"merge_excludes":true,"use_connects":[],"orig_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-idle","orig_noframes":null}},"storage":{"ts":1708508379516,"data":{}},"enabled":true,"position":8,"file_url":"https://update.greasyfork.org/scripts/436569/Cleanup%20YouTube%20Recommendations%20in%20Search%20and%20Playlist.user.js","uuid":"e266f325-730a-4d9c-972f-c5e445962cdb","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICAgICBDbGVhbnVwIFlvdVR1YmUgUmVjb21tZW5kYXRpb25zIGluIFNlYXJjaCBhbmQgUGxheWxpc3QKLy8gQG5hbWU6ZGUgICAgICAgICBCZXJlaW5pZ2UgWW91VHViZSBFbXBmZWhsdW5nZW4gaW4gZGVyIFN1Y2hlIHVuZCBiZWkgUGxheWxpc3RlbgovLyBAdmVyc2lvbiAgICAgICAgIDEuMS40Ci8vIEBkZXNjcmlwdGlvbiAgICAgRGVsZXRlcyAiUG9wdWxhciB2aWRlb3MgZnJvbSB0b2RheSIsICJVc2VycyBoYXZlIGFsc28gc2VlbiIsICJOZXcgY2hhbm5lbHMgZm9yIHlvdSIsICJGb3IgeW91IiwgIkFscmVhZHkgdmlld2VkIiwgIlJlY29tbWVuZGVkIHBsYXlsaXN0cyIgYW5kICJSZWNvbW1lbmRlZCB2aWRlb3MiIFNlY3Rpb25zIGZyb20gU2VhcmNoIFJlc3VsdHMgYW5kIFBsYXlsaXN0cyBvbiBZb3VUdWJlCi8vIEBkZXNjcmlwdGlvbjpkZSAgRW50ZmVybnQgZGllIEFic2Nobml0dGUgIkJlbGllYnRlIFZpZGVvcyB2b24gaGV1dGUiLCBOdXR6ZXIgaGFiZW4gYXVjaCBnZXNlaGVuIiwgIk5ldWUgS2Fuw6RsZSBmw7xyIGRpY2giLCAiRsO8ciBtaWNoIiwgIlNjaG9uIGFuZ2VzZWhlbiIsICJFbXBmb2hsZW5lIFBsYXlsaXN0cyIgdW5kICJFbXBmb2hsZW5lIFZpZGVvcyIgYXVzIGRlbiBTdWNoZXJnZWJuaXNzZW4gdW5kIGF1cyBQbGF5bGlzdGVuIGF1ZiBZb3VUdWJlCi8vIEBpY29uICAgICAgICAgICAgaHR0cHM6Ly93d3cuZ29vZ2xlLmNvbS9zMi9mYXZpY29ucz9kb21haW49eW91dHViZS5jb20KLy8gQGF1dGhvciAgICAgICAgICBUYWxrTG91bmdlIChodHRwczovL2dpdGh1Yi5jb20vVGFsa0xvdW5nZSkKLy8gQG5hbWVzcGFjZSAgICAgICBodHRwczovL2dpdGh1Yi5jb20vVGFsa0xvdW5nZS9jbGVhbnVwLXlvdXR1YmUtcmVjb21tZW5kYXRpb25zLXNlYXJjaC1wbGF5bGlzdAovLyBAbGljZW5zZSAgICAgICAgIE1JVAovLyBAbWF0Y2ggICAgICAgICAgIGh0dHBzOi8vd3d3LnlvdXR1YmUuY29tLyoKLy8gQGdyYW50ICAgICAgICAgICBub25lCi8vIEBkb3dubG9hZFVSTCBodHRwczovL3VwZGF0ZS5ncmVhc3lmb3JrLm9yZy9zY3JpcHRzLzQzNjU2OS9DbGVhbnVwJTIwWW91VHViZSUyMFJlY29tbWVuZGF0aW9ucyUyMGluJTIwU2VhcmNoJTIwYW5kJTIwUGxheWxpc3QudXNlci5qcwovLyBAdXBkYXRlVVJMIGh0dHBzOi8vdXBkYXRlLmdyZWFzeWZvcmsub3JnL3NjcmlwdHMvNDM2NTY5L0NsZWFudXAlMjBZb3VUdWJlJTIwUmVjb21tZW5kYXRpb25zJTIwaW4lMjBTZWFyY2glMjBhbmQlMjBQbGF5bGlzdC5tZXRhLmpzCi8vID09L1VzZXJTY3JpcHQ9PQoKKGZ1bmN0aW9uICgpIHsKICAgICd1c2Ugc3RyaWN0JzsKCiAgICBmdW5jdGlvbiBjbGVhbnVwKCkgewogICAgICAgIGlmICh3aW5kb3cubG9jYXRpb24uaHJlZi5zdGFydHNXaXRoKCJodHRwczovL3d3dy55b3V0dWJlLmNvbS9wbGF5bGlzdCIpKSB7CiAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ3l0ZC1pdGVtLXNlY3Rpb24tcmVuZGVyZXJbaXMtcGxheWxpc3QtdmlkZW8tY29udGFpbmVyXScpPy5yZW1vdmUoKTsgLy8gUmVjb21tZW5kZWQgdmlkZW9zCiAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ3l0ZC1pdGVtLXNlY3Rpb24tcmVuZGVyZXJbaXMtcGxheWxpc3Qtc2hlbGZdJyk/LnJlbW92ZSgpOyAvLyBSZWNvbW1lbmRlZCBwbGF5bGlzdHMKICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigneXRkLWNvbnRpbnVhdGlvbi1pdGVtLXJlbmRlcmVyOm50aC1jaGlsZCgyKScpPy5yZW1vdmUoKTsgLy8gTG9hZGluZyBjaXJjbGUKICAgICAgICB9CgogICAgICAgIGlmICh3aW5kb3cubG9jYXRpb24uaHJlZi5zdGFydHNXaXRoKCJodHRwczovL3d3dy55b3V0dWJlLmNvbS9yZXN1bHRzIikpIHsKICAgICAgICAgICAgWy4uLmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoInl0ZC1zaGVsZi1yZW5kZXJlciIpXS5mb3JFYWNoKGl0ZW0gPT4gaXRlbS5yZW1vdmUoKSk7IC8vIFNlY3Rpb25zOiBQb3B1bGFyIHZpZGVvcyBmcm9tIHRvZGF5LCBVc2VycyBoYXZlIGFsc28gc2VlbiwgTmV3IGNoYW5uZWxzIGZvciB5b3UsIEZvciB5b3UsIEFscmVhZHkgdmlld2VkCiAgICAgICAgICAgIFsuLi5kb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJ5dGQtaG9yaXpvbnRhbC1jYXJkLWxpc3QtcmVuZGVyZXIiKV0uZm9yRWFjaChpdGVtID0+IGl0ZW0ucmVtb3ZlKCkpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHdpbmRvdy5sb2NhdGlvbi5ocmVmLnN0YXJ0c1dpdGgoImh0dHBzOi8vd3d3LnlvdXR1YmUuY29tL0AiKSAmJiAoIXdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZS5zdWJzdHIoMikuaW5jbHVkZXMoIi8iKSB8fCB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUuZW5kc1dpdGgoIi9mZWF0dXJlZCIpKSkgewogICAgICAgICAgICBbLi4uZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgieXRkLXNoZWxmLXJlbmRlcmVyIildLmZpbHRlcihpdGVtID0+IGl0ZW0ucXVlcnlTZWxlY3RvcigieXQtaG9yaXpvbnRhbC1saXN0LXJlbmRlcmVyIikpLmZpbmQoaXRlbSA9PiAhaXRlbS5xdWVyeVNlbGVjdG9yKCIjcGxheS1idXR0b24iKS5jaGlsZHJlbi5sZW5ndGgpPy5yZW1vdmUoKTsgLy8gRm9yIHlvdQogICAgICAgICAgICBbLi4uZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgieXRkLWl0ZW0tc2VjdGlvbi1yZW5kZXJlciIpXS5maWx0ZXIoaXRlbSA9PiAhaXRlbS5xdWVyeVNlbGVjdG9yKCIjY29udGVudHMiKS5jaGlsZHJlbi5sZW5ndGgpWzBdPy5yZW1vdmUoKTsgLy8gRm9yIHlvdSBCb3JkZXIKICAgICAgICB9CiAgICB9CgogICAgY2xlYW51cCgpOwogICAgc2V0SW50ZXJ2YWwoY2xlYW51cCwgNTAwKTsKfSkoKTs="}]}